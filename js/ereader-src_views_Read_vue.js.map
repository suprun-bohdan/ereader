{"version":3,"file":"ereader-src_views_Read_vue.js?v=e60af6ca0845e02eafad","mappings":"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","sources":["webpack:///ereader/src/views/Read.vue","webpack:///ereader/src/components/EpubViewer.vue","webpack:///ereader/src/components/SelectionToolbar.vue","webpack://ereader/./src/components/SelectionToolbar.vue?0496","webpack://ereader/./src/components/SelectionToolbar.vue?0a93","webpack://ereader/./src/components/EpubViewer.vue?2d87","webpack://ereader/./src/components/EpubViewer.vue?d82e","webpack:///ereader/src/components/PdfViewer.vue","webpack://ereader/./src/components/PdfViewer.vue?2f46","webpack://ereader/./src/components/PdfViewer.vue?c570","webpack://ereader/./src/views/Read.vue?5a79","webpack://ereader/./src/views/Read.vue?038f","webpack:///ereader/src/components/SelectionToolbar.vue?vue&type=style&index=0&id=7caed96a&scoped=true&lang=css","webpack:///ereader/src/components/EpubViewer.vue?vue&type=style&index=0&id=01c9fc31&scoped=true&lang=css","webpack:///ereader/src/components/PdfViewer.vue?vue&type=style&index=0&id=073dca8d&scoped=true&lang=css","webpack:///ereader/src/views/Read.vue?vue&type=style&index=0&id=33b668b8&scoped=true&lang=css"],"sourcesContent":["<template>\n\t<div class=\"ereader-read\">\n\t\t<header v-if=\"!isMobile\" class=\"ereader-read__header\">\n\t\t\t<router-link :to=\"{ name: 'Library' }\" class=\"ereader-read__back\">{{ t('ereader', 'Back to library') }}</router-link>\n\t\t</header>\n\t\t<div class=\"ereader-read__area\">\n\t\t\t<div v-if=\"dictMessage\" class=\"ereader-read__toast\">{{ dictMessage }}</div>\n\t\t\t<div v-if=\"error\" class=\"ereader-read__error\">{{ error }}</div>\n\t\t\t<div v-else-if=\"!isEpub && loadingPdf\" class=\"ereader-read__loading\">{{ t('ereader', 'Loading…') }}</div>\n\t\t\t<EpubViewer v-else-if=\"isEpub\" :url=\"streamUrl\" @add-to-dictionary=\"onAddToDictionary\" />\n\t\t\t<PdfViewer v-else-if=\"pdfBlob\" :blob=\"pdfBlob\" @add-to-dictionary=\"onAddToDictionary\" />\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { getStreamUrl, getStreamBlob } from '../router/api'\nimport { translate as t } from '@nextcloud/l10n'\nimport EpubViewer from '../components/EpubViewer.vue'\nimport PdfViewer from '../components/PdfViewer.vue'\n\nconst MIME_EPUB = 'application/epub+zip'\nconst MOBILE_BREAKPOINT = 768\n\nexport default {\n\tname: 'Read',\n\tcomponents: { EpubViewer, PdfViewer },\n\tprops: {\n\t\tfileId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\terror: '',\n\t\t\tloadingPdf: false,\n\t\t\tpdfBlob: null,\n\t\t\twindowWidth: typeof window !== 'undefined' ? window.innerWidth : 1024,\n\t\t\tdictMessage: '',\n\t\t}\n\t},\n\tcomputed: {\n\t\tstreamUrl() {\n\t\t\treturn getStreamUrl(Number(this.fileId))\n\t\t},\n\t\tisEpub() {\n\t\t\treturn this.$route.query?.mime === MIME_EPUB\n\t\t},\n\t\tisMobile() {\n\t\t\treturn this.windowWidth <= MOBILE_BREAKPOINT\n\t\t},\n\t},\n\tasync mounted() {\n\t\twindow.addEventListener('resize', this.onResize)\n\t\tif (this.isEpub) return\n\t\tthis.loadingPdf = true\n\t\tthis.error = ''\n\t\ttry {\n\t\t\tthis.pdfBlob = await getStreamBlob(Number(this.fileId))\n\t\t} catch (e) {\n\t\t\tthis.error = e.response?.status === 403\n\t\t\t\t? t('ereader', 'Access denied. Please refresh the page and try again.')\n\t\t\t\t: (e.message || t('ereader', 'Failed to load the file.'))\n\t\t} finally {\n\t\t\tthis.loadingPdf = false\n\t\t}\n\t},\n\tbeforeUnmount() {\n\t\twindow.removeEventListener('resize', this.onResize)\n\t\tthis.pdfBlob = null\n\t},\n\tmethods: {\n\t\tt,\n\t\tonResize() {\n\t\t\tthis.windowWidth = window.innerWidth\n\t\t},\n\t},\n}\n</script>\n\n<style scoped>\n.ereader-read {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tmin-height: 0;\n\twidth: 100%;\n\tmax-width: 100vw;\n\tbox-sizing: border-box;\n\toverflow: hidden;\n}\n.ereader-read__header {\n\tflex-shrink: 0;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n.ereader-read__back {\n\tcolor: inherit;\n\ttext-decoration: none;\n\tfont-weight: 500;\n}\n.ereader-read__back:hover {\n\ttext-decoration: underline;\n}\n.ereader-read__area {\n\tflex: 1;\n\tposition: relative;\n\tmin-height: 0;\n\twidth: 100%;\n\toverflow: hidden;\n}\n.ereader-read__error,\n.ereader-read__loading {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n}\n.ereader-read__error {\n\tcolor: var(--ereader-error);\n}\n.ereader-read__toast {\n\tposition: absolute;\n\ttop: 1rem;\n\tleft: 50%;\n\ttransform: translateX(-50%);\n\tz-index: 50;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-primary);\n\tcolor: var(--ereader-primary-text);\n\tborder-radius: var(--ereader-radius-sm);\n\tfont-size: 0.9rem;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n</style>\n","<template>\n\t<div class=\"epub-viewer\" @mouseup=\"onMouseUp\">\n\t\t<div ref=\"viewerEl\" class=\"epub-viewer__area\"></div>\n\t\t<SelectionToolbar\n\t\t\t:visible=\"toolbarVisible\"\n\t\t\t:position=\"toolbarPosition\"\n\t\t\t@add=\"onAddToDictionary\"\n\t\t/>\n\t\t<div v-if=\"loading\" class=\"epub-viewer__loading\">{{ t('ereader', 'Loading…') }}</div>\n\t\t<div v-else-if=\"error\" class=\"epub-viewer__error\">{{ error }}</div>\n\t</div>\n</template>\n\n<script>\nimport { translate as t } from '@nextcloud/l10n'\nimport SelectionToolbar from './SelectionToolbar.vue'\n\nexport default {\n\tname: 'EpubViewer',\n\tcomponents: { SelectionToolbar },\n\tprops: {\n\t\turl: { type: String, required: true },\n\t},\n\temits: ['add-to-dictionary'],\n\tdata() {\n\t\treturn {\n\t\t\tloading: true,\n\t\t\terror: '',\n\t\t\trendition: null,\n\t\t\tbook: null,\n\t\t\ttoolbarVisible: false,\n\t\t\ttoolbarPosition: { top: 0, left: 0 },\n\t\t\tselectedText: '',\n\t\t}\n\t},\n\tasync mounted() {\n\t\ttry {\n\t\t\tconst { default: ePub } = await import('epubjs')\n\t\t\tthis.book = ePub(this.url)\n\t\t\tawait this.book.ready\n\t\t\tthis.rendition = this.book.renderTo(this.$refs.viewerEl, {\n\t\t\t\twidth: '100%',\n\t\t\t\theight: '100%',\n\t\t\t\tspread: 'none',\n\t\t\t})\n\t\t\tawait this.rendition.display()\n\t\t\tthis.loading = false\n\t\t\tthis.$nextTick(() => this.attachSelectionListener())\n\t\t} catch (e) {\n\t\t\tthis.error = e.message || this.t('ereader', 'Failed to load book')\n\t\t\tthis.loading = false\n\t\t}\n\t},\n\tbeforeUnmount() {\n\t\tthis.detachSelectionListener()\n\t\tif (this.rendition) {\n\t\t\tthis.rendition.destroy()\n\t\t}\n\t\tif (this.book) {\n\t\t\tthis.book.destroy()\n\t\t}\n\t},\n\tmethods: {\n\t\tt,\n\t\tattachSelectionListener() {\n\t\t\tconst iframe = this.$refs.viewerEl?.querySelector('iframe')\n\t\t\tconst doc = iframe ? iframe.contentDocument : document\n\t\t\tconst win = iframe ? iframe.contentWindow : window\n\t\t\tif (!doc || !win) return\n\t\t\tthis._selectionDoc = doc\n\t\t\tthis._selectionWin = win\n\t\t\tdoc.addEventListener('mouseup', this.onSelectionMouseUp)\n\t\t},\n\t\tdetachSelectionListener() {\n\t\t\tif (this._selectionDoc) {\n\t\t\t\tthis._selectionDoc.removeEventListener('mouseup', this.onSelectionMouseUp)\n\t\t\t\tthis._selectionDoc = null\n\t\t\t}\n\t\t\tthis._selectionWin = null\n\t\t},\n\t\tonMouseUp() {\n\t\t\tthis.updateToolbarFromSelection(document, window)\n\t\t},\n\t\tonSelectionMouseUp() {\n\t\t\tif (this._selectionWin) {\n\t\t\t\tthis.updateToolbarFromSelection(this._selectionDoc, this._selectionWin)\n\t\t\t}\n\t\t},\n\t\tupdateToolbarFromSelection(doc, win) {\n\t\t\tconst sel = win.getSelection()\n\t\t\tconst text = (sel && sel.toString ? sel.toString() : '').trim()\n\t\t\tthis.selectedText = text\n\t\t\tif (!text) {\n\t\t\t\tthis.toolbarVisible = false\n\t\t\t\treturn\n\t\t\t}\n\t\t\tlet top = 0\n\t\t\tlet left = 0\n\t\t\ttry {\n\t\t\t\tconst range = sel.getRangeAt(0)\n\t\t\t\tconst rect = range.getBoundingClientRect()\n\t\t\t\tconst iframe = this.$refs.viewerEl?.querySelector('iframe')\n\t\t\t\tif (iframe && doc !== document) {\n\t\t\t\t\tconst iframeRect = iframe.getBoundingClientRect()\n\t\t\t\t\ttop = iframeRect.top + rect.top + rect.height / 2\n\t\t\t\t\tleft = iframeRect.left + rect.left + rect.width / 2\n\t\t\t\t} else {\n\t\t\t\t\ttop = rect.top + rect.height / 2\n\t\t\t\t\tleft = rect.left + rect.width / 2\n\t\t\t\t}\n\t\t\t} catch (_) {}\n\t\t\tthis.toolbarPosition = { top, left }\n\t\t\tthis.toolbarVisible = true\n\t\t},\n\t\tonAddToDictionary() {\n\t\t\tif (this.selectedText) {\n\t\t\t\tthis.$emit('add-to-dictionary', this.selectedText)\n\t\t\t\tthis.toolbarVisible = false\n\t\t\t\tthis.selectedText = ''\n\t\t\t\tif (this._selectionWin && this._selectionWin.getSelection()) {\n\t\t\t\t\tthis._selectionWin.getSelection().removeAllRanges()\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n}\n</script>\n\n<style scoped>\n.epub-viewer {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n}\n.epub-viewer__area {\n\twidth: 100%;\n\theight: 100%;\n\tbackground: var(--color-main-background, #fff);\n}\n.epub-viewer__loading,\n.epub-viewer__error {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n}\n.epub-viewer__error {\n\tcolor: var(--color-error, #c00);\n}\n</style>\n","<template>\n\t<Teleport to=\"body\">\n\t\t<div\n\t\t\tv-if=\"visible\"\n\t\t\tclass=\"selection-toolbar\"\n\t\t\t:style=\"toolbarStyle\"\n\t\t\trole=\"toolbar\"\n\t\t>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"selection-toolbar__btn\"\n\t\t\t\t@click=\"onAdd\"\n\t\t\t>\n\t\t\t\t{{ t('ereader', 'Add to dictionary') }}\n\t\t\t</button>\n\t\t</div>\n\t</Teleport>\n</template>\n\n<script>\nimport { translate as t } from '@nextcloud/l10n'\n\nexport default {\n\tname: 'SelectionToolbar',\n\tprops: {\n\t\tvisible: { type: Boolean, default: false },\n\t\tposition: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({ top: 0, left: 0 }),\n\t\t},\n\t},\n\temits: ['add'],\n\tcomputed: {\n\t\ttoolbarStyle() {\n\t\t\tconst { top, left } = this.position\n\t\t\treturn {\n\t\t\t\ttop: `${top}px`,\n\t\t\t\tleft: `${left}px`,\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\tt,\n\t\tonAdd() {\n\t\t\tthis.$emit('add')\n\t\t},\n\t},\n}\n</script>\n\n<style scoped>\n.selection-toolbar {\n\tposition: fixed;\n\tz-index: 1000;\n\ttransform: translate(-50%, -100%);\n\tmargin-top: -8px;\n\tpadding: 4px 8px;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-radius: var(--ereader-radius-sm);\n\tbox-shadow: var(--ereader-card-shadow);\n}\n\n.selection-toolbar__btn {\n\tpadding: 0.35rem 0.75rem;\n\tfont-size: 0.875rem;\n\tborder: none;\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: rgba(255, 255, 255, 0.2);\n\tcolor: inherit;\n\tcursor: pointer;\n}\n\n.selection-toolbar__btn:hover {\n\tbackground: rgba(255, 255, 255, 0.3);\n}\n</style>\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./SelectionToolbar.vue?vue&type=style&index=0&id=7caed96a&scoped=true&lang=css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./SelectionToolbar.vue?vue&type=style&index=0&id=7caed96a&scoped=true&lang=css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render } from \"./SelectionToolbar.vue?vue&type=template&id=7caed96a&scoped=true\"\nimport script from \"./SelectionToolbar.vue?vue&type=script&lang=js\"\nexport * from \"./SelectionToolbar.vue?vue&type=script&lang=js\"\n\nimport \"./SelectionToolbar.vue?vue&type=style&index=0&id=7caed96a&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-7caed96a\"]])\n\nexport default __exports__","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./EpubViewer.vue?vue&type=style&index=0&id=01c9fc31&scoped=true&lang=css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./EpubViewer.vue?vue&type=style&index=0&id=01c9fc31&scoped=true&lang=css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render } from \"./EpubViewer.vue?vue&type=template&id=01c9fc31&scoped=true\"\nimport script from \"./EpubViewer.vue?vue&type=script&lang=js\"\nexport * from \"./EpubViewer.vue?vue&type=script&lang=js\"\n\nimport \"./EpubViewer.vue?vue&type=style&index=0&id=01c9fc31&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-01c9fc31\"]])\n\nexport default __exports__","<template>\n\t<div class=\"pdf-viewer\">\n\t\t<header v-if=\"!loading && !error\" class=\"pdf-viewer__toolbar\">\n\t\t\t<div class=\"pdf-viewer__toolbar-group\">\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"pdf-viewer__btn\"\n\t\t\t\t\t:title=\"t('ereader', 'Zoom out')\"\n\t\t\t\t\t:disabled=\"scaleFactor <= minScale\"\n\t\t\t\t\t@click=\"zoomOut\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"pdf-viewer__icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\" aria-hidden=\"true\">\n\t\t\t\t\t\t<path d=\"M19 13H5v-2h14v2z\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t\t<span class=\"pdf-viewer__scale\">{{ scalePercent }}%</span>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"pdf-viewer__btn\"\n\t\t\t\t\t:title=\"t('ereader', 'Zoom in')\"\n\t\t\t\t\t:disabled=\"scaleFactor >= maxScale\"\n\t\t\t\t\t@click=\"zoomIn\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"pdf-viewer__icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\" aria-hidden=\"true\">\n\t\t\t\t\t\t<path d=\"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"pdf-viewer__btn pdf-viewer__btn--text\"\n\t\t\t\t:title=\"t('ereader', 'Fit to width')\"\n\t\t\t\t@click=\"fitWidth\"\n\t\t\t>\n\t\t\t\t{{ t('ereader', 'Fit width') }}\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"pdf-viewer__btn pdf-viewer__btn--text\"\n\t\t\t\t:title=\"t('ereader', 'Fit page')\"\n\t\t\t\t@click=\"fitPage\"\n\t\t\t>\n\t\t\t\t{{ t('ereader', 'Fit page') }}\n\t\t\t</button>\n\t\t\t<div class=\"pdf-viewer__toolbar-group pdf-viewer__toolbar-group--pages\">\n\t\t\t\t<label class=\"pdf-viewer__label\" for=\"pdf-pages-per-view\">\n\t\t\t\t\t{{ t('ereader', 'Pages on screen') }}\n\t\t\t\t</label>\n\t\t\t\t<button\n\t\t\t\t\tv-for=\"n in [1, 2, 3]\"\n\t\t\t\t\t:key=\"n\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"pdf-viewer__btn pdf-viewer__btn--pages\"\n\t\t\t\t\t:class=\"{ 'pdf-viewer__btn--pages-active': pagesPerView === n }\"\n\t\t\t\t\t:title=\"t('ereader', 'Show {n} page(s)', { n })\"\n\t\t\t\t\t@click=\"setPagesPerView(n)\"\n\t\t\t\t>\n\t\t\t\t\t{{ n }}\n\t\t\t\t</button>\n\t\t\t\t<input\n\t\t\t\t\tid=\"pdf-pages-per-view\"\n\t\t\t\t\tv-model=\"pagesPerViewInput\"\n\t\t\t\t\ttype=\"number\"\n\t\t\t\t\tmin=\"1\"\n\t\t\t\t\t:max=\"maxPagesPerView\"\n\t\t\t\t\tclass=\"pdf-viewer__pages-input\"\n\t\t\t\t\t:title=\"t('ereader', 'Number of pages visible at once (1–6)')\"\n\t\t\t\t\t@input=\"onPagesPerViewInput\"\n\t\t\t\t\t@change=\"onPagesPerViewChange\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"pdf-viewer__toolbar-group pdf-viewer__toolbar-group--page\">\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"pdf-viewer__btn\"\n\t\t\t\t\t:title=\"t('ereader', 'Previous page')\"\n\t\t\t\t\t:disabled=\"currentPage <= 1\"\n\t\t\t\t\t@click=\"goToPage(currentPage - 1)\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"pdf-viewer__icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\" aria-hidden=\"true\">\n\t\t\t\t\t\t<path d=\"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t\t<span class=\"pdf-viewer__page-indicator\">\n\t\t\t\t\t{{ t('ereader', 'Page') }} {{ currentPage }} / {{ numPages }}\n\t\t\t\t</span>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"pdf-viewer__btn\"\n\t\t\t\t\t:title=\"t('ereader', 'Next page')\"\n\t\t\t\t\t:disabled=\"currentPage >= numPages\"\n\t\t\t\t\t@click=\"goToPage(currentPage + 1)\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"pdf-viewer__icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\" aria-hidden=\"true\">\n\t\t\t\t\t\t<path d=\"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</header>\n\t\t<div ref=\"scrollEl\" class=\"pdf-viewer__scroll\" @scroll=\"onScroll\" @mouseup=\"onMouseUp\">\n\t\t\t<div ref=\"containerEl\" class=\"pdf-viewer__container\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"pageNum in numPages\"\n\t\t\t\t\t:key=\"pageNum\"\n\t\t\t\t\t:ref=\"(el) => setPageWrapRef(el, pageNum)\"\n\t\t\t\t\tclass=\"pdf-viewer__page-wrap\"\n\t\t\t\t\t:data-page=\"pageNum\"\n\t\t\t\t>\n\t\t\t\t\t<canvas\n\t\t\t\t\t\t:ref=\"(el) => setCanvasRef(el, pageNum)\"\n\t\t\t\t\t\tclass=\"pdf-viewer__page\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:ref=\"(el) => setTextLayerRef(el, pageNum)\"\n\t\t\t\t\t\tclass=\"pdf-viewer__text-layer\"\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<SelectionToolbar\n\t\t\t:visible=\"toolbarVisible\"\n\t\t\t:position=\"toolbarPosition\"\n\t\t\t@add=\"onAddToDictionary\"\n\t\t/>\n\t\t<div v-if=\"loading\" class=\"pdf-viewer__loading\">{{ t('ereader', 'Loading…') }}</div>\n\t\t<div v-else-if=\"error\" class=\"pdf-viewer__error\">{{ error }}</div>\n\t</div>\n</template>\n\n<script>\nimport { markRaw } from 'vue'\nimport { translate as t } from '@nextcloud/l10n'\nimport { generateUrl } from '@nextcloud/router'\nimport * as pdfjsLib from 'pdfjs-dist'\n\nif (typeof window !== 'undefined' && !pdfjsLib.GlobalWorkerOptions.workerSrc) {\n\tpdfjsLib.GlobalWorkerOptions.workerSrc = generateUrl('/apps/ereader/js/pdf.worker.js')\n}\n\nconst MIN_SCALE = 0.5\nconst MAX_SCALE = 3\nconst ZOOM_STEP = 0.25\nconst MIN_PAGES_PER_VIEW = 1\nconst MAX_PAGES_PER_VIEW = 6\n\nimport SelectionToolbar from './SelectionToolbar.vue'\n\nexport default {\n\tname: 'PdfViewer',\n\tcomponents: { SelectionToolbar },\n\temits: ['add-to-dictionary'],\n\tprops: {\n\t\tblob: {\n\t\t\ttype: Blob,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tloading: true,\n\t\t\terror: '',\n\t\t\tnumPages: 0,\n\t\t\tpdfDoc: null,\n\t\t\tcanvasRefs: {},\n\t\t\tpageWrapRefs: {},\n\t\t\tscaleFactor: 1,\n\t\t\tcurrentPage: 1,\n\t\t\tminScale: MIN_SCALE,\n\t\t\tmaxScale: MAX_SCALE,\n\t\t\tpixelRatio: typeof window !== 'undefined' ? Math.min(window.devicePixelRatio || 1, 2) : 1,\n\t\t\tfitPageScale: 1,\n\t\t\tfitWidthScale: 1,\n\t\t\tpagesPerView: 1,\n\t\t\tpagesPerViewInput: '1',\n\t\t\tmaxPagesPerView: MAX_PAGES_PER_VIEW,\n\t\t\ttoolbarVisible: false,\n\t\t\ttoolbarPosition: { top: 0, left: 0 },\n\t\t\tselectedText: '',\n\t\t\ttextLayerRefs: {},\n\t\t\ttextLayers: {},\n\t\t}\n\t},\n\tcomputed: {\n\t\tscalePercent() {\n\t\t\treturn Math.round(this.scaleFactor * 100)\n\t\t},\n\t},\n\twatch: {\n\t\tpagesPerView() {\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t},\n\tasync mounted() {\n\t\tawait this.loadPdf()\n\t},\n\tbeforeUnmount() {\n\t\tthis.canvasRefs = {}\n\t\tthis.pageWrapRefs = {}\n\t\tthis.textLayerRefs = {}\n\t\tObject.values(this.textLayers).forEach((tl) => { if (tl && tl.cancel) tl.cancel() })\n\t\tthis.textLayers = {}\n\t\tif (this.$refs.scrollEl) {\n\t\t\tthis.$refs.scrollEl.removeEventListener('scroll', this.onScroll)\n\t\t}\n\t\tif (this.pdfDoc && typeof this.pdfDoc.destroy === 'function') {\n\t\t\ttry {\n\t\t\t\tthis.pdfDoc.destroy()\n\t\t\t} catch (_) {}\n\t\t\tthis.pdfDoc = null\n\t\t}\n\t},\n\tmethods: {\n\t\tt,\n\t\tsetCanvasRef(el, pageNum) {\n\t\t\tif (el) this.canvasRefs[pageNum] = el\n\t\t},\n\t\tsetPageWrapRef(el, pageNum) {\n\t\t\tif (el) this.pageWrapRefs[pageNum] = el\n\t\t},\n\t\tsetTextLayerRef(el, pageNum) {\n\t\t\tif (el) this.textLayerRefs[pageNum] = el\n\t\t},\n\t\tonMouseUp() {\n\t\t\tconst sel = window.getSelection()\n\t\t\tconst text = (sel && sel.toString ? sel.toString() : '').trim()\n\t\t\tthis.selectedText = text\n\t\t\tif (!text) {\n\t\t\t\tthis.toolbarVisible = false\n\t\t\t\treturn\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst range = sel.getRangeAt(0)\n\t\t\t\tconst rect = range.getBoundingClientRect()\n\t\t\t\tthis.toolbarPosition = {\n\t\t\t\t\ttop: rect.top + rect.height / 2,\n\t\t\t\t\tleft: rect.left + rect.width / 2,\n\t\t\t\t}\n\t\t\t\tthis.toolbarVisible = true\n\t\t\t} catch (_) {\n\t\t\t\tthis.toolbarVisible = false\n\t\t\t}\n\t\t},\n\t\tonAddToDictionary() {\n\t\t\tif (this.selectedText) {\n\t\t\t\tthis.$emit('add-to-dictionary', this.selectedText)\n\t\t\t\tthis.toolbarVisible = false\n\t\t\t\tthis.selectedText = ''\n\t\t\t\tif (window.getSelection()) window.getSelection().removeAllRanges()\n\t\t\t}\n\t\t},\n\t\tsetPagesPerView(n) {\n\t\t\tconst clamped = Math.min(MAX_PAGES_PER_VIEW, Math.max(MIN_PAGES_PER_VIEW, Number(n)))\n\t\t\tthis.pagesPerViewInput = String(clamped)\n\t\t\tthis.pagesPerView = clamped\n\t\t},\n\t\tonPagesPerViewInput() {\n\t\t\tthis.applyPagesPerViewFromInput()\n\t\t},\n\t\tonPagesPerViewChange() {\n\t\t\tthis.applyPagesPerViewFromInput()\n\t\t},\n\t\tapplyPagesPerViewFromInput() {\n\t\t\tconst v = parseInt(this.pagesPerViewInput, 10)\n\t\t\tif (!Number.isFinite(v) || v < MIN_PAGES_PER_VIEW) {\n\t\t\t\tthis.pagesPerViewInput = String(this.pagesPerView)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconst clamped = Math.min(MAX_PAGES_PER_VIEW, Math.max(MIN_PAGES_PER_VIEW, v))\n\t\t\tthis.pagesPerViewInput = String(clamped)\n\t\t\tthis.pagesPerView = clamped\n\t\t},\n\t\tzoomIn() {\n\t\t\tthis.scaleFactor = Math.min(this.maxScale, this.scaleFactor + ZOOM_STEP)\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t\tzoomOut() {\n\t\t\tthis.scaleFactor = Math.max(this.minScale, this.scaleFactor - ZOOM_STEP)\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t\tfitWidth() {\n\t\t\tthis.scaleFactor = this.fitWidthScale\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t\tfitPage() {\n\t\t\tthis.scaleFactor = this.fitPageScale\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t\tgoToPage(pageNum) {\n\t\t\tconst n = Math.max(1, Math.min(this.numPages, pageNum))\n\t\t\tthis.currentPage = n\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tconst el = this.pageWrapRefs[n]\n\t\t\t\tif (el && this.$refs.scrollEl) {\n\t\t\t\t\tel.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' })\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tonScroll() {\n\t\t\tconst scrollEl = this.$refs.scrollEl\n\t\t\tif (!scrollEl || this.numPages === 0) return\n\t\t\tconst scrollLeft = scrollEl.scrollLeft\n\t\t\tconst viewportCenter = scrollLeft + scrollEl.clientWidth / 2\n\t\t\tlet page = 1\n\t\t\tlet bestDist = Infinity\n\t\t\tfor (let n = 1; n <= this.numPages; n++) {\n\t\t\t\tconst wrap = this.pageWrapRefs[n]\n\t\t\t\tif (!wrap) continue\n\t\t\t\tconst wrapCenter = wrap.offsetLeft + wrap.offsetWidth / 2\n\t\t\t\tconst dist = Math.abs(viewportCenter - wrapCenter)\n\t\t\t\tif (dist < bestDist) {\n\t\t\t\t\tbestDist = dist\n\t\t\t\t\tpage = n\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.currentPage = page\n\t\t},\n\t\tasync loadPdf() {\n\t\t\tthis.loading = true\n\t\t\tthis.error = ''\n\t\t\ttry {\n\t\t\t\tconst data = await this.blob.arrayBuffer()\n\t\t\t\tconst doc = await pdfjsLib.getDocument({ data }).promise\n\t\t\t\tthis.pdfDoc = markRaw(doc)\n\t\t\t\tthis.numPages = this.pdfDoc.numPages\n\t\t\t\tthis.loading = false\n\t\t\t\tawait this.$nextTick()\n\t\t\t\tawait this.$nextTick()\n\t\t\t\tawait this.computeFitPageScale()\n\t\t\t\tthis.scaleFactor = this.fitPageScale\n\t\t\t\tawait this.renderAllPages()\n\t\t\t\tif (this.$refs.scrollEl) {\n\t\t\t\t\tthis.$refs.scrollEl.addEventListener('scroll', this.onScroll, { passive: true })\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthis.error = e.message || t('ereader', 'Failed to load PDF')\n\t\t\t\tthis.loading = false\n\t\t\t}\n\t\t},\n\t\tasync computeFitPageScale() {\n\t\t\tif (!this.pdfDoc || !this.$refs.scrollEl) return\n\t\t\tconst scrollEl = this.$refs.scrollEl\n\t\t\tconst w = scrollEl.clientWidth || 800\n\t\t\tconst h = scrollEl.clientHeight || 600\n\t\t\tconst firstPage = await this.pdfDoc.getPage(1)\n\t\t\tconst vp = firstPage.getViewport({ scale: 1 })\n\t\t\tconst scaleW = w / vp.width\n\t\t\tconst scaleH = h / vp.height\n\t\t\tconst fitBoth = Math.min(scaleW, scaleH, this.maxScale)\n\t\t\tthis.fitPageScale = 1\n\t\t\tthis.fitWidthScale = Math.min(scaleW / fitBoth, this.maxScale)\n\t\t\tif (this.scaleFactor === 1) {\n\t\t\t\tthis.scaleFactor = this.fitPageScale\n\t\t\t}\n\t\t},\n\t\tasync renderAllPages() {\n\t\t\tif (!this.pdfDoc || !this.$refs.containerEl || !this.$refs.scrollEl) return\n\t\t\tconst scrollEl = this.$refs.scrollEl\n\t\t\tconst viewWidth = scrollEl.clientWidth || 800\n\t\t\tconst viewHeight = scrollEl.clientHeight || 600\n\t\t\tconst perPage = Math.max(1, this.pagesPerView || 1)\n\t\t\tconst baseWidth = viewWidth / perPage\n\t\t\tconst baseHeight = viewHeight\n\t\t\tfor (let n = 1; n <= this.numPages; n++) {\n\t\t\t\tconst canvas = this.canvasRefs[n]\n\t\t\t\tif (!canvas) continue\n\t\t\t\tconst page = await this.pdfDoc.getPage(n)\n\t\t\t\tconst vp1 = page.getViewport({ scale: 1 })\n\t\t\t\tconst scaleByWidth = baseWidth / vp1.width\n\t\t\t\tconst scaleByHeight = baseHeight / vp1.height\n\t\t\t\tconst baseScale = Math.min(scaleByWidth, scaleByHeight)\n\t\t\t\tconst effectiveScale = baseScale * this.scaleFactor * this.pixelRatio\n\t\t\t\tconst viewport = page.getViewport({ scale: effectiveScale })\n\t\t\t\tcanvas.width = viewport.width\n\t\t\t\tcanvas.height = viewport.height\n\t\t\t\tcanvas.style.width = (viewport.width / this.pixelRatio) + 'px'\n\t\t\t\tcanvas.style.height = (viewport.height / this.pixelRatio) + 'px'\n\t\t\t\tconst ctx = canvas.getContext('2d')\n\t\t\t\tawait page.render({\n\t\t\t\t\tcanvasContext: ctx,\n\t\t\t\t\tviewport,\n\t\t\t\t}).promise\n\t\t\t\tconst textLayerEl = this.textLayerRefs[n]\n\t\t\t\tif (textLayerEl && pdfjsLib.TextLayer) {\n\t\t\t\t\tif (this.textLayers[n] && this.textLayers[n].cancel) {\n\t\t\t\t\t\tthis.textLayers[n].cancel()\n\t\t\t\t\t}\n\t\t\t\t\ttextLayerEl.innerHTML = ''\n\t\t\t\t\tconst displayViewport = page.getViewport({ scale: baseScale * this.scaleFactor })\n\t\t\t\t\ttextLayerEl.style.width = displayViewport.width + 'px'\n\t\t\t\t\ttextLayerEl.style.height = displayViewport.height + 'px'\n\t\t\t\t\tconst textContent = await page.getTextContent()\n\t\t\t\t\tconst textLayer = new pdfjsLib.TextLayer({\n\t\t\t\t\t\ttextContentSource: textContent,\n\t\t\t\t\t\tcontainer: textLayerEl,\n\t\t\t\t\t\tviewport: displayViewport,\n\t\t\t\t\t})\n\t\t\t\t\tthis.textLayers[n] = textLayer\n\t\t\t\t\tawait textLayer.render()\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n}\n</script>\n\n<style scoped>\n.pdf-viewer {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: var(--ereader-surface);\n}\n\n.pdf-viewer__toolbar {\n\tflex-shrink: 0;\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\talign-items: center;\n\tgap: 0.5rem 1rem;\n\tpadding: 0.5rem 0.75rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n\n.pdf-viewer__toolbar-group {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 0.25rem;\n}\n\n.pdf-viewer__toolbar-group--page {\n\tmargin-left: auto;\n}\n\n.pdf-viewer__btn {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\tmin-width: 36px;\n\theight: 36px;\n\tpadding: 0 0.5rem;\n\tborder: none;\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: transparent;\n\tcolor: inherit;\n\tcursor: pointer;\n\ttransition: background 0.15s;\n}\n\n.pdf-viewer__btn:hover:not(:disabled) {\n\tbackground: rgba(255, 255, 255, 0.2);\n}\n\n.pdf-viewer__btn:disabled {\n\topacity: 0.5;\n\tcursor: not-allowed;\n}\n\n.pdf-viewer__btn--text {\n\tfont-size: 0.875rem;\n}\n\n.pdf-viewer__toolbar-group--pages {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 0.25rem;\n}\n\n.pdf-viewer__btn--pages {\n\tmin-width: 32px;\n\tfont-size: 0.875rem;\n\tfont-weight: 500;\n}\n\n.pdf-viewer__btn--pages-active {\n\tbackground: rgba(255, 255, 255, 0.3);\n}\n\n.pdf-viewer__icon {\n\twidth: 24px;\n\theight: 24px;\n}\n\n.pdf-viewer__scale {\n\tmin-width: 3.5em;\n\tfont-size: 0.875rem;\n\ttext-align: center;\n}\n\n.pdf-viewer__label {\n\tfont-size: 0.875rem;\n\twhite-space: nowrap;\n\tcolor: var(--ereader-primary-text);\n}\n\n.pdf-viewer__pages-input {\n\twidth: 2.5rem;\n\tpadding: 0.25rem 0.35rem;\n\tfont-size: 0.875rem;\n\ttext-align: center;\n\tborder: 1px solid var(--ereader-border);\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: var(--ereader-surface);\n\tcolor: var(--ereader-primary-text);\n}\n\n.pdf-viewer__pages-input:focus {\n\toutline: none;\n\tborder-color: var(--ereader-primary, #1976d2);\n}\n\n.pdf-viewer__page-indicator {\n\tfont-size: 0.875rem;\n\twhite-space: nowrap;\n}\n\n.pdf-viewer__scroll {\n\tflex: 1;\n\tmin-height: 0;\n\toverflow-x: auto;\n\toverflow-y: auto;\n\tscroll-behavior: smooth;\n\tscroll-snap-type: x mandatory;\n}\n\n.pdf-viewer__container {\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-wrap: nowrap;\n\talign-items: flex-start;\n\tjustify-content: flex-start;\n\tpadding: 1rem;\n\tgap: 1rem;\n\tmin-height: min-content;\n}\n\n.pdf-viewer__page-wrap {\n\tposition: relative;\n\tflex: 0 0 auto;\n\tscroll-snap-align: center;\n\tscroll-snap-stop: always;\n}\n\n.pdf-viewer__text-layer {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\toverflow: hidden;\n\tline-height: 1;\n\tuser-select: text;\n\tpointer-events: auto;\n}\n\n.pdf-viewer__text-layer span {\n\tcolor: transparent;\n\tposition: absolute;\n\twhite-space: pre;\n\ttransform-origin: 0 0;\n\tpointer-events: auto;\n}\n\n.pdf-viewer__page {\n\tdisplay: block;\n\tmax-width: 100%;\n\theight: auto;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n\n.pdf-viewer__loading,\n.pdf-viewer__error {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n\tbackground: var(--ereader-surface);\n}\n\n.pdf-viewer__error {\n\tcolor: var(--ereader-error);\n}\n</style>\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./PdfViewer.vue?vue&type=style&index=0&id=073dca8d&scoped=true&lang=css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./PdfViewer.vue?vue&type=style&index=0&id=073dca8d&scoped=true&lang=css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render } from \"./PdfViewer.vue?vue&type=template&id=073dca8d&scoped=true\"\nimport script from \"./PdfViewer.vue?vue&type=script&lang=js\"\nexport * from \"./PdfViewer.vue?vue&type=script&lang=js\"\n\nimport \"./PdfViewer.vue?vue&type=style&index=0&id=073dca8d&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-073dca8d\"]])\n\nexport default __exports__","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./Read.vue?vue&type=style&index=0&id=33b668b8&scoped=true&lang=css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./Read.vue?vue&type=style&index=0&id=33b668b8&scoped=true&lang=css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render } from \"./Read.vue?vue&type=template&id=33b668b8&scoped=true\"\nimport script from \"./Read.vue?vue&type=script&lang=js\"\nexport * from \"./Read.vue?vue&type=script&lang=js\"\n\nimport \"./Read.vue?vue&type=style&index=0&id=33b668b8&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-33b668b8\"]])\n\nexport default __exports__","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `\n.selection-toolbar[data-v-7caed96a] {\n\tposition: fixed;\n\tz-index: 1000;\n\ttransform: translate(-50%, -100%);\n\tmargin-top: -8px;\n\tpadding: 4px 8px;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-radius: var(--ereader-radius-sm);\n\tbox-shadow: var(--ereader-card-shadow);\n}\n.selection-toolbar__btn[data-v-7caed96a] {\n\tpadding: 0.35rem 0.75rem;\n\tfont-size: 0.875rem;\n\tborder: none;\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: rgba(255, 255, 255, 0.2);\n\tcolor: inherit;\n\tcursor: pointer;\n}\n.selection-toolbar__btn[data-v-7caed96a]:hover {\n\tbackground: rgba(255, 255, 255, 0.3);\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/components/SelectionToolbar.vue\"],\"names\":[],\"mappings\":\";AAmDA;CACC,eAAe;CACf,aAAa;CACb,iCAAiC;CACjC,gBAAgB;CAChB,gBAAgB;CAChB,qCAAqC;CACrC,kCAAkC;CAClC,uCAAuC;CACvC,sCAAsC;AACvC;AAEA;CACC,wBAAwB;CACxB,mBAAmB;CACnB,YAAY;CACZ,uCAAuC;CACvC,oCAAoC;CACpC,cAAc;CACd,eAAe;AAChB;AAEA;CACC,oCAAoC;AACrC\",\"sourcesContent\":[\"<template>\\n\\t<Teleport to=\\\"body\\\">\\n\\t\\t<div\\n\\t\\t\\tv-if=\\\"visible\\\"\\n\\t\\t\\tclass=\\\"selection-toolbar\\\"\\n\\t\\t\\t:style=\\\"toolbarStyle\\\"\\n\\t\\t\\trole=\\\"toolbar\\\"\\n\\t\\t>\\n\\t\\t\\t<button\\n\\t\\t\\t\\ttype=\\\"button\\\"\\n\\t\\t\\t\\tclass=\\\"selection-toolbar__btn\\\"\\n\\t\\t\\t\\t@click=\\\"onAdd\\\"\\n\\t\\t\\t>\\n\\t\\t\\t\\t{{ t('ereader', 'Add to dictionary') }}\\n\\t\\t\\t</button>\\n\\t\\t</div>\\n\\t</Teleport>\\n</template>\\n\\n<script>\\nimport { translate as t } from '@nextcloud/l10n'\\n\\nexport default {\\n\\tname: 'SelectionToolbar',\\n\\tprops: {\\n\\t\\tvisible: { type: Boolean, default: false },\\n\\t\\tposition: {\\n\\t\\t\\ttype: Object,\\n\\t\\t\\tdefault: () => ({ top: 0, left: 0 }),\\n\\t\\t},\\n\\t},\\n\\temits: ['add'],\\n\\tcomputed: {\\n\\t\\ttoolbarStyle() {\\n\\t\\t\\tconst { top, left } = this.position\\n\\t\\t\\treturn {\\n\\t\\t\\t\\ttop: `${top}px`,\\n\\t\\t\\t\\tleft: `${left}px`,\\n\\t\\t\\t}\\n\\t\\t},\\n\\t},\\n\\tmethods: {\\n\\t\\tt,\\n\\t\\tonAdd() {\\n\\t\\t\\tthis.$emit('add')\\n\\t\\t},\\n\\t},\\n}\\n</script>\\n\\n<style scoped>\\n.selection-toolbar {\\n\\tposition: fixed;\\n\\tz-index: 1000;\\n\\ttransform: translate(-50%, -100%);\\n\\tmargin-top: -8px;\\n\\tpadding: 4px 8px;\\n\\tbackground: var(--ereader-action-bar);\\n\\tcolor: var(--ereader-primary-text);\\n\\tborder-radius: var(--ereader-radius-sm);\\n\\tbox-shadow: var(--ereader-card-shadow);\\n}\\n\\n.selection-toolbar__btn {\\n\\tpadding: 0.35rem 0.75rem;\\n\\tfont-size: 0.875rem;\\n\\tborder: none;\\n\\tborder-radius: var(--ereader-radius-sm);\\n\\tbackground: rgba(255, 255, 255, 0.2);\\n\\tcolor: inherit;\\n\\tcursor: pointer;\\n}\\n\\n.selection-toolbar__btn:hover {\\n\\tbackground: rgba(255, 255, 255, 0.3);\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `\n.epub-viewer[data-v-01c9fc31] {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n}\n.epub-viewer__area[data-v-01c9fc31] {\n\twidth: 100%;\n\theight: 100%;\n\tbackground: var(--color-main-background, #fff);\n}\n.epub-viewer__loading[data-v-01c9fc31],\n.epub-viewer__error[data-v-01c9fc31] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n}\n.epub-viewer__error[data-v-01c9fc31] {\n\tcolor: var(--color-error, #c00);\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/components/EpubViewer.vue\"],\"names\":[],\"mappings\":\";AAiIA;CACC,kBAAkB;CAClB,WAAW;CACX,YAAY;AACb;AACA;CACC,WAAW;CACX,YAAY;CACZ,8CAA8C;AAC/C;AACA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;AACnB;AACA;CACC,+BAA+B;AAChC\",\"sourcesContent\":[\"<template>\\n\\t<div class=\\\"epub-viewer\\\" @mouseup=\\\"onMouseUp\\\">\\n\\t\\t<div ref=\\\"viewerEl\\\" class=\\\"epub-viewer__area\\\"></div>\\n\\t\\t<SelectionToolbar\\n\\t\\t\\t:visible=\\\"toolbarVisible\\\"\\n\\t\\t\\t:position=\\\"toolbarPosition\\\"\\n\\t\\t\\t@add=\\\"onAddToDictionary\\\"\\n\\t\\t/>\\n\\t\\t<div v-if=\\\"loading\\\" class=\\\"epub-viewer__loading\\\">{{ t('ereader', 'Loading…') }}</div>\\n\\t\\t<div v-else-if=\\\"error\\\" class=\\\"epub-viewer__error\\\">{{ error }}</div>\\n\\t</div>\\n</template>\\n\\n<script>\\nimport { translate as t } from '@nextcloud/l10n'\\nimport SelectionToolbar from './SelectionToolbar.vue'\\n\\nexport default {\\n\\tname: 'EpubViewer',\\n\\tcomponents: { SelectionToolbar },\\n\\tprops: {\\n\\t\\turl: { type: String, required: true },\\n\\t},\\n\\temits: ['add-to-dictionary'],\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tloading: true,\\n\\t\\t\\terror: '',\\n\\t\\t\\trendition: null,\\n\\t\\t\\tbook: null,\\n\\t\\t\\ttoolbarVisible: false,\\n\\t\\t\\ttoolbarPosition: { top: 0, left: 0 },\\n\\t\\t\\tselectedText: '',\\n\\t\\t}\\n\\t},\\n\\tasync mounted() {\\n\\t\\ttry {\\n\\t\\t\\tconst { default: ePub } = await import('epubjs')\\n\\t\\t\\tthis.book = ePub(this.url)\\n\\t\\t\\tawait this.book.ready\\n\\t\\t\\tthis.rendition = this.book.renderTo(this.$refs.viewerEl, {\\n\\t\\t\\t\\twidth: '100%',\\n\\t\\t\\t\\theight: '100%',\\n\\t\\t\\t\\tspread: 'none',\\n\\t\\t\\t})\\n\\t\\t\\tawait this.rendition.display()\\n\\t\\t\\tthis.loading = false\\n\\t\\t\\tthis.$nextTick(() => this.attachSelectionListener())\\n\\t\\t} catch (e) {\\n\\t\\t\\tthis.error = e.message || this.t('ereader', 'Failed to load book')\\n\\t\\t\\tthis.loading = false\\n\\t\\t}\\n\\t},\\n\\tbeforeUnmount() {\\n\\t\\tthis.detachSelectionListener()\\n\\t\\tif (this.rendition) {\\n\\t\\t\\tthis.rendition.destroy()\\n\\t\\t}\\n\\t\\tif (this.book) {\\n\\t\\t\\tthis.book.destroy()\\n\\t\\t}\\n\\t},\\n\\tmethods: {\\n\\t\\tt,\\n\\t\\tattachSelectionListener() {\\n\\t\\t\\tconst iframe = this.$refs.viewerEl?.querySelector('iframe')\\n\\t\\t\\tconst doc = iframe ? iframe.contentDocument : document\\n\\t\\t\\tconst win = iframe ? iframe.contentWindow : window\\n\\t\\t\\tif (!doc || !win) return\\n\\t\\t\\tthis._selectionDoc = doc\\n\\t\\t\\tthis._selectionWin = win\\n\\t\\t\\tdoc.addEventListener('mouseup', this.onSelectionMouseUp)\\n\\t\\t},\\n\\t\\tdetachSelectionListener() {\\n\\t\\t\\tif (this._selectionDoc) {\\n\\t\\t\\t\\tthis._selectionDoc.removeEventListener('mouseup', this.onSelectionMouseUp)\\n\\t\\t\\t\\tthis._selectionDoc = null\\n\\t\\t\\t}\\n\\t\\t\\tthis._selectionWin = null\\n\\t\\t},\\n\\t\\tonMouseUp() {\\n\\t\\t\\tthis.updateToolbarFromSelection(document, window)\\n\\t\\t},\\n\\t\\tonSelectionMouseUp() {\\n\\t\\t\\tif (this._selectionWin) {\\n\\t\\t\\t\\tthis.updateToolbarFromSelection(this._selectionDoc, this._selectionWin)\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\tupdateToolbarFromSelection(doc, win) {\\n\\t\\t\\tconst sel = win.getSelection()\\n\\t\\t\\tconst text = (sel && sel.toString ? sel.toString() : '').trim()\\n\\t\\t\\tthis.selectedText = text\\n\\t\\t\\tif (!text) {\\n\\t\\t\\t\\tthis.toolbarVisible = false\\n\\t\\t\\t\\treturn\\n\\t\\t\\t}\\n\\t\\t\\tlet top = 0\\n\\t\\t\\tlet left = 0\\n\\t\\t\\ttry {\\n\\t\\t\\t\\tconst range = sel.getRangeAt(0)\\n\\t\\t\\t\\tconst rect = range.getBoundingClientRect()\\n\\t\\t\\t\\tconst iframe = this.$refs.viewerEl?.querySelector('iframe')\\n\\t\\t\\t\\tif (iframe && doc !== document) {\\n\\t\\t\\t\\t\\tconst iframeRect = iframe.getBoundingClientRect()\\n\\t\\t\\t\\t\\ttop = iframeRect.top + rect.top + rect.height / 2\\n\\t\\t\\t\\t\\tleft = iframeRect.left + rect.left + rect.width / 2\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\ttop = rect.top + rect.height / 2\\n\\t\\t\\t\\t\\tleft = rect.left + rect.width / 2\\n\\t\\t\\t\\t}\\n\\t\\t\\t} catch (_) {}\\n\\t\\t\\tthis.toolbarPosition = { top, left }\\n\\t\\t\\tthis.toolbarVisible = true\\n\\t\\t},\\n\\t\\tonAddToDictionary() {\\n\\t\\t\\tif (this.selectedText) {\\n\\t\\t\\t\\tthis.$emit('add-to-dictionary', this.selectedText)\\n\\t\\t\\t\\tthis.toolbarVisible = false\\n\\t\\t\\t\\tthis.selectedText = ''\\n\\t\\t\\t\\tif (this._selectionWin && this._selectionWin.getSelection()) {\\n\\t\\t\\t\\t\\tthis._selectionWin.getSelection().removeAllRanges()\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t},\\n\\t},\\n}\\n</script>\\n\\n<style scoped>\\n.epub-viewer {\\n\\tposition: relative;\\n\\twidth: 100%;\\n\\theight: 100%;\\n}\\n.epub-viewer__area {\\n\\twidth: 100%;\\n\\theight: 100%;\\n\\tbackground: var(--color-main-background, #fff);\\n}\\n.epub-viewer__loading,\\n.epub-viewer__error {\\n\\tposition: absolute;\\n\\tinset: 0;\\n\\tdisplay: flex;\\n\\talign-items: center;\\n\\tjustify-content: center;\\n\\tpadding: 2rem;\\n\\ttext-align: center;\\n}\\n.epub-viewer__error {\\n\\tcolor: var(--color-error, #c00);\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `\n.pdf-viewer[data-v-073dca8d] {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: var(--ereader-surface);\n}\n.pdf-viewer__toolbar[data-v-073dca8d] {\n\tflex-shrink: 0;\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\talign-items: center;\n\tgap: 0.5rem 1rem;\n\tpadding: 0.5rem 0.75rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n.pdf-viewer__toolbar-group[data-v-073dca8d] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 0.25rem;\n}\n.pdf-viewer__toolbar-group--page[data-v-073dca8d] {\n\tmargin-left: auto;\n}\n.pdf-viewer__btn[data-v-073dca8d] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\tmin-width: 36px;\n\theight: 36px;\n\tpadding: 0 0.5rem;\n\tborder: none;\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: transparent;\n\tcolor: inherit;\n\tcursor: pointer;\n\ttransition: background 0.15s;\n}\n.pdf-viewer__btn[data-v-073dca8d]:hover:not(:disabled) {\n\tbackground: rgba(255, 255, 255, 0.2);\n}\n.pdf-viewer__btn[data-v-073dca8d]:disabled {\n\topacity: 0.5;\n\tcursor: not-allowed;\n}\n.pdf-viewer__btn--text[data-v-073dca8d] {\n\tfont-size: 0.875rem;\n}\n.pdf-viewer__toolbar-group--pages[data-v-073dca8d] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 0.25rem;\n}\n.pdf-viewer__btn--pages[data-v-073dca8d] {\n\tmin-width: 32px;\n\tfont-size: 0.875rem;\n\tfont-weight: 500;\n}\n.pdf-viewer__btn--pages-active[data-v-073dca8d] {\n\tbackground: rgba(255, 255, 255, 0.3);\n}\n.pdf-viewer__icon[data-v-073dca8d] {\n\twidth: 24px;\n\theight: 24px;\n}\n.pdf-viewer__scale[data-v-073dca8d] {\n\tmin-width: 3.5em;\n\tfont-size: 0.875rem;\n\ttext-align: center;\n}\n.pdf-viewer__label[data-v-073dca8d] {\n\tfont-size: 0.875rem;\n\twhite-space: nowrap;\n\tcolor: var(--ereader-primary-text);\n}\n.pdf-viewer__pages-input[data-v-073dca8d] {\n\twidth: 2.5rem;\n\tpadding: 0.25rem 0.35rem;\n\tfont-size: 0.875rem;\n\ttext-align: center;\n\tborder: 1px solid var(--ereader-border);\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: var(--ereader-surface);\n\tcolor: var(--ereader-primary-text);\n}\n.pdf-viewer__pages-input[data-v-073dca8d]:focus {\n\toutline: none;\n\tborder-color: var(--ereader-primary, #1976d2);\n}\n.pdf-viewer__page-indicator[data-v-073dca8d] {\n\tfont-size: 0.875rem;\n\twhite-space: nowrap;\n}\n.pdf-viewer__scroll[data-v-073dca8d] {\n\tflex: 1;\n\tmin-height: 0;\n\toverflow-x: auto;\n\toverflow-y: auto;\n\tscroll-behavior: smooth;\n\tscroll-snap-type: x mandatory;\n}\n.pdf-viewer__container[data-v-073dca8d] {\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-wrap: nowrap;\n\talign-items: flex-start;\n\tjustify-content: flex-start;\n\tpadding: 1rem;\n\tgap: 1rem;\n\tmin-height: min-content;\n}\n.pdf-viewer__page-wrap[data-v-073dca8d] {\n\tposition: relative;\n\tflex: 0 0 auto;\n\tscroll-snap-align: center;\n\tscroll-snap-stop: always;\n}\n.pdf-viewer__text-layer[data-v-073dca8d] {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\toverflow: hidden;\n\tline-height: 1;\n\tuser-select: text;\n\tpointer-events: auto;\n}\n.pdf-viewer__text-layer span[data-v-073dca8d] {\n\tcolor: transparent;\n\tposition: absolute;\n\twhite-space: pre;\n\ttransform-origin: 0 0;\n\tpointer-events: auto;\n}\n.pdf-viewer__page[data-v-073dca8d] {\n\tdisplay: block;\n\tmax-width: 100%;\n\theight: auto;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n.pdf-viewer__loading[data-v-073dca8d],\n.pdf-viewer__error[data-v-073dca8d] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n\tbackground: var(--ereader-surface);\n}\n.pdf-viewer__error[data-v-073dca8d] {\n\tcolor: var(--ereader-error);\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/components/PdfViewer.vue\"],\"names\":[],\"mappings\":\";AAuZA;CACC,kBAAkB;CAClB,WAAW;CACX,YAAY;CACZ,aAAa;CACb,sBAAsB;CACtB,kCAAkC;AACnC;AAEA;CACC,cAAc;CACd,aAAa;CACb,eAAe;CACf,mBAAmB;CACnB,gBAAgB;CAChB,uBAAuB;CACvB,qCAAqC;CACrC,kCAAkC;CAClC,8CAA8C;AAC/C;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,YAAY;AACb;AAEA;CACC,iBAAiB;AAClB;AAEA;CACC,oBAAoB;CACpB,mBAAmB;CACnB,uBAAuB;CACvB,eAAe;CACf,YAAY;CACZ,iBAAiB;CACjB,YAAY;CACZ,uCAAuC;CACvC,uBAAuB;CACvB,cAAc;CACd,eAAe;CACf,4BAA4B;AAC7B;AAEA;CACC,oCAAoC;AACrC;AAEA;CACC,YAAY;CACZ,mBAAmB;AACpB;AAEA;CACC,mBAAmB;AACpB;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,YAAY;AACb;AAEA;CACC,eAAe;CACf,mBAAmB;CACnB,gBAAgB;AACjB;AAEA;CACC,oCAAoC;AACrC;AAEA;CACC,WAAW;CACX,YAAY;AACb;AAEA;CACC,gBAAgB;CAChB,mBAAmB;CACnB,kBAAkB;AACnB;AAEA;CACC,mBAAmB;CACnB,mBAAmB;CACnB,kCAAkC;AACnC;AAEA;CACC,aAAa;CACb,wBAAwB;CACxB,mBAAmB;CACnB,kBAAkB;CAClB,uCAAuC;CACvC,uCAAuC;CACvC,kCAAkC;CAClC,kCAAkC;AACnC;AAEA;CACC,aAAa;CACb,6CAA6C;AAC9C;AAEA;CACC,mBAAmB;CACnB,mBAAmB;AACpB;AAEA;CACC,OAAO;CACP,aAAa;CACb,gBAAgB;CAChB,gBAAgB;CAChB,uBAAuB;CACvB,6BAA6B;AAC9B;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,iBAAiB;CACjB,uBAAuB;CACvB,2BAA2B;CAC3B,aAAa;CACb,SAAS;CACT,uBAAuB;AACxB;AAEA;CACC,kBAAkB;CAClB,cAAc;CACd,yBAAyB;CACzB,wBAAwB;AACzB;AAEA;CACC,kBAAkB;CAClB,MAAM;CACN,OAAO;CACP,gBAAgB;CAChB,cAAc;CACd,iBAAiB;CACjB,oBAAoB;AACrB;AAEA;CACC,kBAAkB;CAClB,kBAAkB;CAClB,gBAAgB;CAChB,qBAAqB;CACrB,oBAAoB;AACrB;AAEA;CACC,cAAc;CACd,eAAe;CACf,YAAY;CACZ,sCAAsC;AACvC;AAEA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;CAClB,oCAAoC;CACpC,kCAAkC;AACnC;AAEA;CACC,2BAA2B;AAC5B\",\"sourcesContent\":[\"<template>\\n\\t<div class=\\\"pdf-viewer\\\">\\n\\t\\t<header v-if=\\\"!loading && !error\\\" class=\\\"pdf-viewer__toolbar\\\">\\n\\t\\t\\t<div class=\\\"pdf-viewer__toolbar-group\\\">\\n\\t\\t\\t\\t<button\\n\\t\\t\\t\\t\\ttype=\\\"button\\\"\\n\\t\\t\\t\\t\\tclass=\\\"pdf-viewer__btn\\\"\\n\\t\\t\\t\\t\\t:title=\\\"t('ereader', 'Zoom out')\\\"\\n\\t\\t\\t\\t\\t:disabled=\\\"scaleFactor <= minScale\\\"\\n\\t\\t\\t\\t\\t@click=\\\"zoomOut\\\"\\n\\t\\t\\t\\t>\\n\\t\\t\\t\\t\\t<svg class=\\\"pdf-viewer__icon\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\" aria-hidden=\\\"true\\\">\\n\\t\\t\\t\\t\\t\\t<path d=\\\"M19 13H5v-2h14v2z\\\"/>\\n\\t\\t\\t\\t\\t</svg>\\n\\t\\t\\t\\t</button>\\n\\t\\t\\t\\t<span class=\\\"pdf-viewer__scale\\\">{{ scalePercent }}%</span>\\n\\t\\t\\t\\t<button\\n\\t\\t\\t\\t\\ttype=\\\"button\\\"\\n\\t\\t\\t\\t\\tclass=\\\"pdf-viewer__btn\\\"\\n\\t\\t\\t\\t\\t:title=\\\"t('ereader', 'Zoom in')\\\"\\n\\t\\t\\t\\t\\t:disabled=\\\"scaleFactor >= maxScale\\\"\\n\\t\\t\\t\\t\\t@click=\\\"zoomIn\\\"\\n\\t\\t\\t\\t>\\n\\t\\t\\t\\t\\t<svg class=\\\"pdf-viewer__icon\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\" aria-hidden=\\\"true\\\">\\n\\t\\t\\t\\t\\t\\t<path d=\\\"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\\\"/>\\n\\t\\t\\t\\t\\t</svg>\\n\\t\\t\\t\\t</button>\\n\\t\\t\\t</div>\\n\\t\\t\\t<button\\n\\t\\t\\t\\ttype=\\\"button\\\"\\n\\t\\t\\t\\tclass=\\\"pdf-viewer__btn pdf-viewer__btn--text\\\"\\n\\t\\t\\t\\t:title=\\\"t('ereader', 'Fit to width')\\\"\\n\\t\\t\\t\\t@click=\\\"fitWidth\\\"\\n\\t\\t\\t>\\n\\t\\t\\t\\t{{ t('ereader', 'Fit width') }}\\n\\t\\t\\t</button>\\n\\t\\t\\t<button\\n\\t\\t\\t\\ttype=\\\"button\\\"\\n\\t\\t\\t\\tclass=\\\"pdf-viewer__btn pdf-viewer__btn--text\\\"\\n\\t\\t\\t\\t:title=\\\"t('ereader', 'Fit page')\\\"\\n\\t\\t\\t\\t@click=\\\"fitPage\\\"\\n\\t\\t\\t>\\n\\t\\t\\t\\t{{ t('ereader', 'Fit page') }}\\n\\t\\t\\t</button>\\n\\t\\t\\t<div class=\\\"pdf-viewer__toolbar-group pdf-viewer__toolbar-group--pages\\\">\\n\\t\\t\\t\\t<label class=\\\"pdf-viewer__label\\\" for=\\\"pdf-pages-per-view\\\">\\n\\t\\t\\t\\t\\t{{ t('ereader', 'Pages on screen') }}\\n\\t\\t\\t\\t</label>\\n\\t\\t\\t\\t<button\\n\\t\\t\\t\\t\\tv-for=\\\"n in [1, 2, 3]\\\"\\n\\t\\t\\t\\t\\t:key=\\\"n\\\"\\n\\t\\t\\t\\t\\ttype=\\\"button\\\"\\n\\t\\t\\t\\t\\tclass=\\\"pdf-viewer__btn pdf-viewer__btn--pages\\\"\\n\\t\\t\\t\\t\\t:class=\\\"{ 'pdf-viewer__btn--pages-active': pagesPerView === n }\\\"\\n\\t\\t\\t\\t\\t:title=\\\"t('ereader', 'Show {n} page(s)', { n })\\\"\\n\\t\\t\\t\\t\\t@click=\\\"setPagesPerView(n)\\\"\\n\\t\\t\\t\\t>\\n\\t\\t\\t\\t\\t{{ n }}\\n\\t\\t\\t\\t</button>\\n\\t\\t\\t\\t<input\\n\\t\\t\\t\\t\\tid=\\\"pdf-pages-per-view\\\"\\n\\t\\t\\t\\t\\tv-model=\\\"pagesPerViewInput\\\"\\n\\t\\t\\t\\t\\ttype=\\\"number\\\"\\n\\t\\t\\t\\t\\tmin=\\\"1\\\"\\n\\t\\t\\t\\t\\t:max=\\\"maxPagesPerView\\\"\\n\\t\\t\\t\\t\\tclass=\\\"pdf-viewer__pages-input\\\"\\n\\t\\t\\t\\t\\t:title=\\\"t('ereader', 'Number of pages visible at once (1–6)')\\\"\\n\\t\\t\\t\\t\\t@input=\\\"onPagesPerViewInput\\\"\\n\\t\\t\\t\\t\\t@change=\\\"onPagesPerViewChange\\\"\\n\\t\\t\\t\\t/>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"pdf-viewer__toolbar-group pdf-viewer__toolbar-group--page\\\">\\n\\t\\t\\t\\t<button\\n\\t\\t\\t\\t\\ttype=\\\"button\\\"\\n\\t\\t\\t\\t\\tclass=\\\"pdf-viewer__btn\\\"\\n\\t\\t\\t\\t\\t:title=\\\"t('ereader', 'Previous page')\\\"\\n\\t\\t\\t\\t\\t:disabled=\\\"currentPage <= 1\\\"\\n\\t\\t\\t\\t\\t@click=\\\"goToPage(currentPage - 1)\\\"\\n\\t\\t\\t\\t>\\n\\t\\t\\t\\t\\t<svg class=\\\"pdf-viewer__icon\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\" aria-hidden=\\\"true\\\">\\n\\t\\t\\t\\t\\t\\t<path d=\\\"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z\\\"/>\\n\\t\\t\\t\\t\\t</svg>\\n\\t\\t\\t\\t</button>\\n\\t\\t\\t\\t<span class=\\\"pdf-viewer__page-indicator\\\">\\n\\t\\t\\t\\t\\t{{ t('ereader', 'Page') }} {{ currentPage }} / {{ numPages }}\\n\\t\\t\\t\\t</span>\\n\\t\\t\\t\\t<button\\n\\t\\t\\t\\t\\ttype=\\\"button\\\"\\n\\t\\t\\t\\t\\tclass=\\\"pdf-viewer__btn\\\"\\n\\t\\t\\t\\t\\t:title=\\\"t('ereader', 'Next page')\\\"\\n\\t\\t\\t\\t\\t:disabled=\\\"currentPage >= numPages\\\"\\n\\t\\t\\t\\t\\t@click=\\\"goToPage(currentPage + 1)\\\"\\n\\t\\t\\t\\t>\\n\\t\\t\\t\\t\\t<svg class=\\\"pdf-viewer__icon\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\" aria-hidden=\\\"true\\\">\\n\\t\\t\\t\\t\\t\\t<path d=\\\"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z\\\"/>\\n\\t\\t\\t\\t\\t</svg>\\n\\t\\t\\t\\t</button>\\n\\t\\t\\t</div>\\n\\t\\t</header>\\n\\t\\t<div ref=\\\"scrollEl\\\" class=\\\"pdf-viewer__scroll\\\" @scroll=\\\"onScroll\\\" @mouseup=\\\"onMouseUp\\\">\\n\\t\\t\\t<div ref=\\\"containerEl\\\" class=\\\"pdf-viewer__container\\\">\\n\\t\\t\\t\\t<div\\n\\t\\t\\t\\t\\tv-for=\\\"pageNum in numPages\\\"\\n\\t\\t\\t\\t\\t:key=\\\"pageNum\\\"\\n\\t\\t\\t\\t\\t:ref=\\\"(el) => setPageWrapRef(el, pageNum)\\\"\\n\\t\\t\\t\\t\\tclass=\\\"pdf-viewer__page-wrap\\\"\\n\\t\\t\\t\\t\\t:data-page=\\\"pageNum\\\"\\n\\t\\t\\t\\t>\\n\\t\\t\\t\\t\\t<canvas\\n\\t\\t\\t\\t\\t\\t:ref=\\\"(el) => setCanvasRef(el, pageNum)\\\"\\n\\t\\t\\t\\t\\t\\tclass=\\\"pdf-viewer__page\\\"\\n\\t\\t\\t\\t\\t/>\\n\\t\\t\\t\\t\\t<div\\n\\t\\t\\t\\t\\t\\t:ref=\\\"(el) => setTextLayerRef(el, pageNum)\\\"\\n\\t\\t\\t\\t\\t\\tclass=\\\"pdf-viewer__text-layer\\\"\\n\\t\\t\\t\\t\\t\\taria-hidden=\\\"true\\\"\\n\\t\\t\\t\\t\\t/>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<SelectionToolbar\\n\\t\\t\\t:visible=\\\"toolbarVisible\\\"\\n\\t\\t\\t:position=\\\"toolbarPosition\\\"\\n\\t\\t\\t@add=\\\"onAddToDictionary\\\"\\n\\t\\t/>\\n\\t\\t<div v-if=\\\"loading\\\" class=\\\"pdf-viewer__loading\\\">{{ t('ereader', 'Loading…') }}</div>\\n\\t\\t<div v-else-if=\\\"error\\\" class=\\\"pdf-viewer__error\\\">{{ error }}</div>\\n\\t</div>\\n</template>\\n\\n<script>\\nimport { markRaw } from 'vue'\\nimport { translate as t } from '@nextcloud/l10n'\\nimport { generateUrl } from '@nextcloud/router'\\nimport * as pdfjsLib from 'pdfjs-dist'\\n\\nif (typeof window !== 'undefined' && !pdfjsLib.GlobalWorkerOptions.workerSrc) {\\n\\tpdfjsLib.GlobalWorkerOptions.workerSrc = generateUrl('/apps/ereader/js/pdf.worker.js')\\n}\\n\\nconst MIN_SCALE = 0.5\\nconst MAX_SCALE = 3\\nconst ZOOM_STEP = 0.25\\nconst MIN_PAGES_PER_VIEW = 1\\nconst MAX_PAGES_PER_VIEW = 6\\n\\nimport SelectionToolbar from './SelectionToolbar.vue'\\n\\nexport default {\\n\\tname: 'PdfViewer',\\n\\tcomponents: { SelectionToolbar },\\n\\temits: ['add-to-dictionary'],\\n\\tprops: {\\n\\t\\tblob: {\\n\\t\\t\\ttype: Blob,\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tloading: true,\\n\\t\\t\\terror: '',\\n\\t\\t\\tnumPages: 0,\\n\\t\\t\\tpdfDoc: null,\\n\\t\\t\\tcanvasRefs: {},\\n\\t\\t\\tpageWrapRefs: {},\\n\\t\\t\\tscaleFactor: 1,\\n\\t\\t\\tcurrentPage: 1,\\n\\t\\t\\tminScale: MIN_SCALE,\\n\\t\\t\\tmaxScale: MAX_SCALE,\\n\\t\\t\\tpixelRatio: typeof window !== 'undefined' ? Math.min(window.devicePixelRatio || 1, 2) : 1,\\n\\t\\t\\tfitPageScale: 1,\\n\\t\\t\\tfitWidthScale: 1,\\n\\t\\t\\tpagesPerView: 1,\\n\\t\\t\\tpagesPerViewInput: '1',\\n\\t\\t\\tmaxPagesPerView: MAX_PAGES_PER_VIEW,\\n\\t\\t\\ttoolbarVisible: false,\\n\\t\\t\\ttoolbarPosition: { top: 0, left: 0 },\\n\\t\\t\\tselectedText: '',\\n\\t\\t\\ttextLayerRefs: {},\\n\\t\\t\\ttextLayers: {},\\n\\t\\t}\\n\\t},\\n\\tcomputed: {\\n\\t\\tscalePercent() {\\n\\t\\t\\treturn Math.round(this.scaleFactor * 100)\\n\\t\\t},\\n\\t},\\n\\twatch: {\\n\\t\\tpagesPerView() {\\n\\t\\t\\tthis.$nextTick(() => this.renderAllPages())\\n\\t\\t},\\n\\t},\\n\\tasync mounted() {\\n\\t\\tawait this.loadPdf()\\n\\t},\\n\\tbeforeUnmount() {\\n\\t\\tthis.canvasRefs = {}\\n\\t\\tthis.pageWrapRefs = {}\\n\\t\\tthis.textLayerRefs = {}\\n\\t\\tObject.values(this.textLayers).forEach((tl) => { if (tl && tl.cancel) tl.cancel() })\\n\\t\\tthis.textLayers = {}\\n\\t\\tif (this.$refs.scrollEl) {\\n\\t\\t\\tthis.$refs.scrollEl.removeEventListener('scroll', this.onScroll)\\n\\t\\t}\\n\\t\\tif (this.pdfDoc && typeof this.pdfDoc.destroy === 'function') {\\n\\t\\t\\ttry {\\n\\t\\t\\t\\tthis.pdfDoc.destroy()\\n\\t\\t\\t} catch (_) {}\\n\\t\\t\\tthis.pdfDoc = null\\n\\t\\t}\\n\\t},\\n\\tmethods: {\\n\\t\\tt,\\n\\t\\tsetCanvasRef(el, pageNum) {\\n\\t\\t\\tif (el) this.canvasRefs[pageNum] = el\\n\\t\\t},\\n\\t\\tsetPageWrapRef(el, pageNum) {\\n\\t\\t\\tif (el) this.pageWrapRefs[pageNum] = el\\n\\t\\t},\\n\\t\\tsetTextLayerRef(el, pageNum) {\\n\\t\\t\\tif (el) this.textLayerRefs[pageNum] = el\\n\\t\\t},\\n\\t\\tonMouseUp() {\\n\\t\\t\\tconst sel = window.getSelection()\\n\\t\\t\\tconst text = (sel && sel.toString ? sel.toString() : '').trim()\\n\\t\\t\\tthis.selectedText = text\\n\\t\\t\\tif (!text) {\\n\\t\\t\\t\\tthis.toolbarVisible = false\\n\\t\\t\\t\\treturn\\n\\t\\t\\t}\\n\\t\\t\\ttry {\\n\\t\\t\\t\\tconst range = sel.getRangeAt(0)\\n\\t\\t\\t\\tconst rect = range.getBoundingClientRect()\\n\\t\\t\\t\\tthis.toolbarPosition = {\\n\\t\\t\\t\\t\\ttop: rect.top + rect.height / 2,\\n\\t\\t\\t\\t\\tleft: rect.left + rect.width / 2,\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tthis.toolbarVisible = true\\n\\t\\t\\t} catch (_) {\\n\\t\\t\\t\\tthis.toolbarVisible = false\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\tonAddToDictionary() {\\n\\t\\t\\tif (this.selectedText) {\\n\\t\\t\\t\\tthis.$emit('add-to-dictionary', this.selectedText)\\n\\t\\t\\t\\tthis.toolbarVisible = false\\n\\t\\t\\t\\tthis.selectedText = ''\\n\\t\\t\\t\\tif (window.getSelection()) window.getSelection().removeAllRanges()\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\tsetPagesPerView(n) {\\n\\t\\t\\tconst clamped = Math.min(MAX_PAGES_PER_VIEW, Math.max(MIN_PAGES_PER_VIEW, Number(n)))\\n\\t\\t\\tthis.pagesPerViewInput = String(clamped)\\n\\t\\t\\tthis.pagesPerView = clamped\\n\\t\\t},\\n\\t\\tonPagesPerViewInput() {\\n\\t\\t\\tthis.applyPagesPerViewFromInput()\\n\\t\\t},\\n\\t\\tonPagesPerViewChange() {\\n\\t\\t\\tthis.applyPagesPerViewFromInput()\\n\\t\\t},\\n\\t\\tapplyPagesPerViewFromInput() {\\n\\t\\t\\tconst v = parseInt(this.pagesPerViewInput, 10)\\n\\t\\t\\tif (!Number.isFinite(v) || v < MIN_PAGES_PER_VIEW) {\\n\\t\\t\\t\\tthis.pagesPerViewInput = String(this.pagesPerView)\\n\\t\\t\\t\\treturn\\n\\t\\t\\t}\\n\\t\\t\\tconst clamped = Math.min(MAX_PAGES_PER_VIEW, Math.max(MIN_PAGES_PER_VIEW, v))\\n\\t\\t\\tthis.pagesPerViewInput = String(clamped)\\n\\t\\t\\tthis.pagesPerView = clamped\\n\\t\\t},\\n\\t\\tzoomIn() {\\n\\t\\t\\tthis.scaleFactor = Math.min(this.maxScale, this.scaleFactor + ZOOM_STEP)\\n\\t\\t\\tthis.$nextTick(() => this.renderAllPages())\\n\\t\\t},\\n\\t\\tzoomOut() {\\n\\t\\t\\tthis.scaleFactor = Math.max(this.minScale, this.scaleFactor - ZOOM_STEP)\\n\\t\\t\\tthis.$nextTick(() => this.renderAllPages())\\n\\t\\t},\\n\\t\\tfitWidth() {\\n\\t\\t\\tthis.scaleFactor = this.fitWidthScale\\n\\t\\t\\tthis.$nextTick(() => this.renderAllPages())\\n\\t\\t},\\n\\t\\tfitPage() {\\n\\t\\t\\tthis.scaleFactor = this.fitPageScale\\n\\t\\t\\tthis.$nextTick(() => this.renderAllPages())\\n\\t\\t},\\n\\t\\tgoToPage(pageNum) {\\n\\t\\t\\tconst n = Math.max(1, Math.min(this.numPages, pageNum))\\n\\t\\t\\tthis.currentPage = n\\n\\t\\t\\tthis.$nextTick(() => {\\n\\t\\t\\t\\tconst el = this.pageWrapRefs[n]\\n\\t\\t\\t\\tif (el && this.$refs.scrollEl) {\\n\\t\\t\\t\\t\\tel.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' })\\n\\t\\t\\t\\t}\\n\\t\\t\\t})\\n\\t\\t},\\n\\t\\tonScroll() {\\n\\t\\t\\tconst scrollEl = this.$refs.scrollEl\\n\\t\\t\\tif (!scrollEl || this.numPages === 0) return\\n\\t\\t\\tconst scrollLeft = scrollEl.scrollLeft\\n\\t\\t\\tconst viewportCenter = scrollLeft + scrollEl.clientWidth / 2\\n\\t\\t\\tlet page = 1\\n\\t\\t\\tlet bestDist = Infinity\\n\\t\\t\\tfor (let n = 1; n <= this.numPages; n++) {\\n\\t\\t\\t\\tconst wrap = this.pageWrapRefs[n]\\n\\t\\t\\t\\tif (!wrap) continue\\n\\t\\t\\t\\tconst wrapCenter = wrap.offsetLeft + wrap.offsetWidth / 2\\n\\t\\t\\t\\tconst dist = Math.abs(viewportCenter - wrapCenter)\\n\\t\\t\\t\\tif (dist < bestDist) {\\n\\t\\t\\t\\t\\tbestDist = dist\\n\\t\\t\\t\\t\\tpage = n\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\tthis.currentPage = page\\n\\t\\t},\\n\\t\\tasync loadPdf() {\\n\\t\\t\\tthis.loading = true\\n\\t\\t\\tthis.error = ''\\n\\t\\t\\ttry {\\n\\t\\t\\t\\tconst data = await this.blob.arrayBuffer()\\n\\t\\t\\t\\tconst doc = await pdfjsLib.getDocument({ data }).promise\\n\\t\\t\\t\\tthis.pdfDoc = markRaw(doc)\\n\\t\\t\\t\\tthis.numPages = this.pdfDoc.numPages\\n\\t\\t\\t\\tthis.loading = false\\n\\t\\t\\t\\tawait this.$nextTick()\\n\\t\\t\\t\\tawait this.$nextTick()\\n\\t\\t\\t\\tawait this.computeFitPageScale()\\n\\t\\t\\t\\tthis.scaleFactor = this.fitPageScale\\n\\t\\t\\t\\tawait this.renderAllPages()\\n\\t\\t\\t\\tif (this.$refs.scrollEl) {\\n\\t\\t\\t\\t\\tthis.$refs.scrollEl.addEventListener('scroll', this.onScroll, { passive: true })\\n\\t\\t\\t\\t}\\n\\t\\t\\t} catch (e) {\\n\\t\\t\\t\\tthis.error = e.message || t('ereader', 'Failed to load PDF')\\n\\t\\t\\t\\tthis.loading = false\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\tasync computeFitPageScale() {\\n\\t\\t\\tif (!this.pdfDoc || !this.$refs.scrollEl) return\\n\\t\\t\\tconst scrollEl = this.$refs.scrollEl\\n\\t\\t\\tconst w = scrollEl.clientWidth || 800\\n\\t\\t\\tconst h = scrollEl.clientHeight || 600\\n\\t\\t\\tconst firstPage = await this.pdfDoc.getPage(1)\\n\\t\\t\\tconst vp = firstPage.getViewport({ scale: 1 })\\n\\t\\t\\tconst scaleW = w / vp.width\\n\\t\\t\\tconst scaleH = h / vp.height\\n\\t\\t\\tconst fitBoth = Math.min(scaleW, scaleH, this.maxScale)\\n\\t\\t\\tthis.fitPageScale = 1\\n\\t\\t\\tthis.fitWidthScale = Math.min(scaleW / fitBoth, this.maxScale)\\n\\t\\t\\tif (this.scaleFactor === 1) {\\n\\t\\t\\t\\tthis.scaleFactor = this.fitPageScale\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\tasync renderAllPages() {\\n\\t\\t\\tif (!this.pdfDoc || !this.$refs.containerEl || !this.$refs.scrollEl) return\\n\\t\\t\\tconst scrollEl = this.$refs.scrollEl\\n\\t\\t\\tconst viewWidth = scrollEl.clientWidth || 800\\n\\t\\t\\tconst viewHeight = scrollEl.clientHeight || 600\\n\\t\\t\\tconst perPage = Math.max(1, this.pagesPerView || 1)\\n\\t\\t\\tconst baseWidth = viewWidth / perPage\\n\\t\\t\\tconst baseHeight = viewHeight\\n\\t\\t\\tfor (let n = 1; n <= this.numPages; n++) {\\n\\t\\t\\t\\tconst canvas = this.canvasRefs[n]\\n\\t\\t\\t\\tif (!canvas) continue\\n\\t\\t\\t\\tconst page = await this.pdfDoc.getPage(n)\\n\\t\\t\\t\\tconst vp1 = page.getViewport({ scale: 1 })\\n\\t\\t\\t\\tconst scaleByWidth = baseWidth / vp1.width\\n\\t\\t\\t\\tconst scaleByHeight = baseHeight / vp1.height\\n\\t\\t\\t\\tconst baseScale = Math.min(scaleByWidth, scaleByHeight)\\n\\t\\t\\t\\tconst effectiveScale = baseScale * this.scaleFactor * this.pixelRatio\\n\\t\\t\\t\\tconst viewport = page.getViewport({ scale: effectiveScale })\\n\\t\\t\\t\\tcanvas.width = viewport.width\\n\\t\\t\\t\\tcanvas.height = viewport.height\\n\\t\\t\\t\\tcanvas.style.width = (viewport.width / this.pixelRatio) + 'px'\\n\\t\\t\\t\\tcanvas.style.height = (viewport.height / this.pixelRatio) + 'px'\\n\\t\\t\\t\\tconst ctx = canvas.getContext('2d')\\n\\t\\t\\t\\tawait page.render({\\n\\t\\t\\t\\t\\tcanvasContext: ctx,\\n\\t\\t\\t\\t\\tviewport,\\n\\t\\t\\t\\t}).promise\\n\\t\\t\\t\\tconst textLayerEl = this.textLayerRefs[n]\\n\\t\\t\\t\\tif (textLayerEl && pdfjsLib.TextLayer) {\\n\\t\\t\\t\\t\\tif (this.textLayers[n] && this.textLayers[n].cancel) {\\n\\t\\t\\t\\t\\t\\tthis.textLayers[n].cancel()\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\ttextLayerEl.innerHTML = ''\\n\\t\\t\\t\\t\\tconst displayViewport = page.getViewport({ scale: baseScale * this.scaleFactor })\\n\\t\\t\\t\\t\\ttextLayerEl.style.width = displayViewport.width + 'px'\\n\\t\\t\\t\\t\\ttextLayerEl.style.height = displayViewport.height + 'px'\\n\\t\\t\\t\\t\\tconst textContent = await page.getTextContent()\\n\\t\\t\\t\\t\\tconst textLayer = new pdfjsLib.TextLayer({\\n\\t\\t\\t\\t\\t\\ttextContentSource: textContent,\\n\\t\\t\\t\\t\\t\\tcontainer: textLayerEl,\\n\\t\\t\\t\\t\\t\\tviewport: displayViewport,\\n\\t\\t\\t\\t\\t})\\n\\t\\t\\t\\t\\tthis.textLayers[n] = textLayer\\n\\t\\t\\t\\t\\tawait textLayer.render()\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t},\\n\\t},\\n}\\n</script>\\n\\n<style scoped>\\n.pdf-viewer {\\n\\tposition: relative;\\n\\twidth: 100%;\\n\\theight: 100%;\\n\\tdisplay: flex;\\n\\tflex-direction: column;\\n\\tbackground: var(--ereader-surface);\\n}\\n\\n.pdf-viewer__toolbar {\\n\\tflex-shrink: 0;\\n\\tdisplay: flex;\\n\\tflex-wrap: wrap;\\n\\talign-items: center;\\n\\tgap: 0.5rem 1rem;\\n\\tpadding: 0.5rem 0.75rem;\\n\\tbackground: var(--ereader-action-bar);\\n\\tcolor: var(--ereader-primary-text);\\n\\tborder-bottom: 1px solid var(--ereader-border);\\n}\\n\\n.pdf-viewer__toolbar-group {\\n\\tdisplay: flex;\\n\\talign-items: center;\\n\\tgap: 0.25rem;\\n}\\n\\n.pdf-viewer__toolbar-group--page {\\n\\tmargin-left: auto;\\n}\\n\\n.pdf-viewer__btn {\\n\\tdisplay: inline-flex;\\n\\talign-items: center;\\n\\tjustify-content: center;\\n\\tmin-width: 36px;\\n\\theight: 36px;\\n\\tpadding: 0 0.5rem;\\n\\tborder: none;\\n\\tborder-radius: var(--ereader-radius-sm);\\n\\tbackground: transparent;\\n\\tcolor: inherit;\\n\\tcursor: pointer;\\n\\ttransition: background 0.15s;\\n}\\n\\n.pdf-viewer__btn:hover:not(:disabled) {\\n\\tbackground: rgba(255, 255, 255, 0.2);\\n}\\n\\n.pdf-viewer__btn:disabled {\\n\\topacity: 0.5;\\n\\tcursor: not-allowed;\\n}\\n\\n.pdf-viewer__btn--text {\\n\\tfont-size: 0.875rem;\\n}\\n\\n.pdf-viewer__toolbar-group--pages {\\n\\tdisplay: flex;\\n\\talign-items: center;\\n\\tgap: 0.25rem;\\n}\\n\\n.pdf-viewer__btn--pages {\\n\\tmin-width: 32px;\\n\\tfont-size: 0.875rem;\\n\\tfont-weight: 500;\\n}\\n\\n.pdf-viewer__btn--pages-active {\\n\\tbackground: rgba(255, 255, 255, 0.3);\\n}\\n\\n.pdf-viewer__icon {\\n\\twidth: 24px;\\n\\theight: 24px;\\n}\\n\\n.pdf-viewer__scale {\\n\\tmin-width: 3.5em;\\n\\tfont-size: 0.875rem;\\n\\ttext-align: center;\\n}\\n\\n.pdf-viewer__label {\\n\\tfont-size: 0.875rem;\\n\\twhite-space: nowrap;\\n\\tcolor: var(--ereader-primary-text);\\n}\\n\\n.pdf-viewer__pages-input {\\n\\twidth: 2.5rem;\\n\\tpadding: 0.25rem 0.35rem;\\n\\tfont-size: 0.875rem;\\n\\ttext-align: center;\\n\\tborder: 1px solid var(--ereader-border);\\n\\tborder-radius: var(--ereader-radius-sm);\\n\\tbackground: var(--ereader-surface);\\n\\tcolor: var(--ereader-primary-text);\\n}\\n\\n.pdf-viewer__pages-input:focus {\\n\\toutline: none;\\n\\tborder-color: var(--ereader-primary, #1976d2);\\n}\\n\\n.pdf-viewer__page-indicator {\\n\\tfont-size: 0.875rem;\\n\\twhite-space: nowrap;\\n}\\n\\n.pdf-viewer__scroll {\\n\\tflex: 1;\\n\\tmin-height: 0;\\n\\toverflow-x: auto;\\n\\toverflow-y: auto;\\n\\tscroll-behavior: smooth;\\n\\tscroll-snap-type: x mandatory;\\n}\\n\\n.pdf-viewer__container {\\n\\tdisplay: flex;\\n\\tflex-direction: row;\\n\\tflex-wrap: nowrap;\\n\\talign-items: flex-start;\\n\\tjustify-content: flex-start;\\n\\tpadding: 1rem;\\n\\tgap: 1rem;\\n\\tmin-height: min-content;\\n}\\n\\n.pdf-viewer__page-wrap {\\n\\tposition: relative;\\n\\tflex: 0 0 auto;\\n\\tscroll-snap-align: center;\\n\\tscroll-snap-stop: always;\\n}\\n\\n.pdf-viewer__text-layer {\\n\\tposition: absolute;\\n\\ttop: 0;\\n\\tleft: 0;\\n\\toverflow: hidden;\\n\\tline-height: 1;\\n\\tuser-select: text;\\n\\tpointer-events: auto;\\n}\\n\\n.pdf-viewer__text-layer span {\\n\\tcolor: transparent;\\n\\tposition: absolute;\\n\\twhite-space: pre;\\n\\ttransform-origin: 0 0;\\n\\tpointer-events: auto;\\n}\\n\\n.pdf-viewer__page {\\n\\tdisplay: block;\\n\\tmax-width: 100%;\\n\\theight: auto;\\n\\tbox-shadow: var(--ereader-card-shadow);\\n}\\n\\n.pdf-viewer__loading,\\n.pdf-viewer__error {\\n\\tposition: absolute;\\n\\tinset: 0;\\n\\tdisplay: flex;\\n\\talign-items: center;\\n\\tjustify-content: center;\\n\\tpadding: 2rem;\\n\\ttext-align: center;\\n\\tcolor: var(--ereader-text-secondary);\\n\\tbackground: var(--ereader-surface);\\n}\\n\\n.pdf-viewer__error {\\n\\tcolor: var(--ereader-error);\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `\n.ereader-read[data-v-33b668b8] {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tmin-height: 0;\n\twidth: 100%;\n\tmax-width: 100vw;\n\tbox-sizing: border-box;\n\toverflow: hidden;\n}\n.ereader-read__header[data-v-33b668b8] {\n\tflex-shrink: 0;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n.ereader-read__back[data-v-33b668b8] {\n\tcolor: inherit;\n\ttext-decoration: none;\n\tfont-weight: 500;\n}\n.ereader-read__back[data-v-33b668b8]:hover {\n\ttext-decoration: underline;\n}\n.ereader-read__area[data-v-33b668b8] {\n\tflex: 1;\n\tposition: relative;\n\tmin-height: 0;\n\twidth: 100%;\n\toverflow: hidden;\n}\n.ereader-read__error[data-v-33b668b8],\n.ereader-read__loading[data-v-33b668b8] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n}\n.ereader-read__error[data-v-33b668b8] {\n\tcolor: var(--ereader-error);\n}\n.ereader-read__toast[data-v-33b668b8] {\n\tposition: absolute;\n\ttop: 1rem;\n\tleft: 50%;\n\ttransform: translateX(-50%);\n\tz-index: 50;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-primary);\n\tcolor: var(--ereader-primary-text);\n\tborder-radius: var(--ereader-radius-sm);\n\tfont-size: 0.9rem;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/views/Read.vue\"],\"names\":[],\"mappings\":\";AAkFA;CACC,aAAa;CACb,sBAAsB;CACtB,YAAY;CACZ,aAAa;CACb,WAAW;CACX,gBAAgB;CAChB,sBAAsB;CACtB,gBAAgB;AACjB;AACA;CACC,cAAc;CACd,oBAAoB;CACpB,qCAAqC;CACrC,kCAAkC;CAClC,8CAA8C;AAC/C;AACA;CACC,cAAc;CACd,qBAAqB;CACrB,gBAAgB;AACjB;AACA;CACC,0BAA0B;AAC3B;AACA;CACC,OAAO;CACP,kBAAkB;CAClB,aAAa;CACb,WAAW;CACX,gBAAgB;AACjB;AACA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;CAClB,oCAAoC;AACrC;AACA;CACC,2BAA2B;AAC5B;AACA;CACC,kBAAkB;CAClB,SAAS;CACT,SAAS;CACT,2BAA2B;CAC3B,WAAW;CACX,oBAAoB;CACpB,kCAAkC;CAClC,kCAAkC;CAClC,uCAAuC;CACvC,iBAAiB;CACjB,sCAAsC;AACvC\",\"sourcesContent\":[\"<template>\\n\\t<div class=\\\"ereader-read\\\">\\n\\t\\t<header v-if=\\\"!isMobile\\\" class=\\\"ereader-read__header\\\">\\n\\t\\t\\t<router-link :to=\\\"{ name: 'Library' }\\\" class=\\\"ereader-read__back\\\">{{ t('ereader', 'Back to library') }}</router-link>\\n\\t\\t</header>\\n\\t\\t<div class=\\\"ereader-read__area\\\">\\n\\t\\t\\t<div v-if=\\\"dictMessage\\\" class=\\\"ereader-read__toast\\\">{{ dictMessage }}</div>\\n\\t\\t\\t<div v-if=\\\"error\\\" class=\\\"ereader-read__error\\\">{{ error }}</div>\\n\\t\\t\\t<div v-else-if=\\\"!isEpub && loadingPdf\\\" class=\\\"ereader-read__loading\\\">{{ t('ereader', 'Loading…') }}</div>\\n\\t\\t\\t<EpubViewer v-else-if=\\\"isEpub\\\" :url=\\\"streamUrl\\\" @add-to-dictionary=\\\"onAddToDictionary\\\" />\\n\\t\\t\\t<PdfViewer v-else-if=\\\"pdfBlob\\\" :blob=\\\"pdfBlob\\\" @add-to-dictionary=\\\"onAddToDictionary\\\" />\\n\\t\\t</div>\\n\\t</div>\\n</template>\\n\\n<script>\\nimport { getStreamUrl, getStreamBlob } from '../router/api'\\nimport { translate as t } from '@nextcloud/l10n'\\nimport EpubViewer from '../components/EpubViewer.vue'\\nimport PdfViewer from '../components/PdfViewer.vue'\\n\\nconst MIME_EPUB = 'application/epub+zip'\\nconst MOBILE_BREAKPOINT = 768\\n\\nexport default {\\n\\tname: 'Read',\\n\\tcomponents: { EpubViewer, PdfViewer },\\n\\tprops: {\\n\\t\\tfileId: {\\n\\t\\t\\ttype: [String, Number],\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\terror: '',\\n\\t\\t\\tloadingPdf: false,\\n\\t\\t\\tpdfBlob: null,\\n\\t\\t\\twindowWidth: typeof window !== 'undefined' ? window.innerWidth : 1024,\\n\\t\\t\\tdictMessage: '',\\n\\t\\t}\\n\\t},\\n\\tcomputed: {\\n\\t\\tstreamUrl() {\\n\\t\\t\\treturn getStreamUrl(Number(this.fileId))\\n\\t\\t},\\n\\t\\tisEpub() {\\n\\t\\t\\treturn this.$route.query?.mime === MIME_EPUB\\n\\t\\t},\\n\\t\\tisMobile() {\\n\\t\\t\\treturn this.windowWidth <= MOBILE_BREAKPOINT\\n\\t\\t},\\n\\t},\\n\\tasync mounted() {\\n\\t\\twindow.addEventListener('resize', this.onResize)\\n\\t\\tif (this.isEpub) return\\n\\t\\tthis.loadingPdf = true\\n\\t\\tthis.error = ''\\n\\t\\ttry {\\n\\t\\t\\tthis.pdfBlob = await getStreamBlob(Number(this.fileId))\\n\\t\\t} catch (e) {\\n\\t\\t\\tthis.error = e.response?.status === 403\\n\\t\\t\\t\\t? t('ereader', 'Access denied. Please refresh the page and try again.')\\n\\t\\t\\t\\t: (e.message || t('ereader', 'Failed to load the file.'))\\n\\t\\t} finally {\\n\\t\\t\\tthis.loadingPdf = false\\n\\t\\t}\\n\\t},\\n\\tbeforeUnmount() {\\n\\t\\twindow.removeEventListener('resize', this.onResize)\\n\\t\\tthis.pdfBlob = null\\n\\t},\\n\\tmethods: {\\n\\t\\tt,\\n\\t\\tonResize() {\\n\\t\\t\\tthis.windowWidth = window.innerWidth\\n\\t\\t},\\n\\t},\\n}\\n</script>\\n\\n<style scoped>\\n.ereader-read {\\n\\tdisplay: flex;\\n\\tflex-direction: column;\\n\\theight: 100%;\\n\\tmin-height: 0;\\n\\twidth: 100%;\\n\\tmax-width: 100vw;\\n\\tbox-sizing: border-box;\\n\\toverflow: hidden;\\n}\\n.ereader-read__header {\\n\\tflex-shrink: 0;\\n\\tpadding: 0.5rem 1rem;\\n\\tbackground: var(--ereader-action-bar);\\n\\tcolor: var(--ereader-primary-text);\\n\\tborder-bottom: 1px solid var(--ereader-border);\\n}\\n.ereader-read__back {\\n\\tcolor: inherit;\\n\\ttext-decoration: none;\\n\\tfont-weight: 500;\\n}\\n.ereader-read__back:hover {\\n\\ttext-decoration: underline;\\n}\\n.ereader-read__area {\\n\\tflex: 1;\\n\\tposition: relative;\\n\\tmin-height: 0;\\n\\twidth: 100%;\\n\\toverflow: hidden;\\n}\\n.ereader-read__error,\\n.ereader-read__loading {\\n\\tposition: absolute;\\n\\tinset: 0;\\n\\tdisplay: flex;\\n\\talign-items: center;\\n\\tjustify-content: center;\\n\\tpadding: 2rem;\\n\\ttext-align: center;\\n\\tcolor: var(--ereader-text-secondary);\\n}\\n.ereader-read__error {\\n\\tcolor: var(--ereader-error);\\n}\\n.ereader-read__toast {\\n\\tposition: absolute;\\n\\ttop: 1rem;\\n\\tleft: 50%;\\n\\ttransform: translateX(-50%);\\n\\tz-index: 50;\\n\\tpadding: 0.5rem 1rem;\\n\\tbackground: var(--ereader-primary);\\n\\tcolor: var(--ereader-primary-text);\\n\\tborder-radius: var(--ereader-radius-sm);\\n\\tfont-size: 0.9rem;\\n\\tbox-shadow: var(--ereader-card-shadow);\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n"],"names":["class","ref","name","props","visible","type","Boolean","default","position","Object","top","left","emits","computed","toolbarStyle","this","methods","t","onAdd","$emit","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","locals","_createBlock","_Teleport","to","$props","_createElementBlock","style","_normalizeStyle","$options","role","_createElementVNode","onClick","_cache","args","components","SelectionToolbar","url","String","required","data","loading","error","rendition","book","toolbarVisible","toolbarPosition","selectedText","mounted","ePub","ready","renderTo","$refs","viewerEl","width","height","spread","display","$nextTick","attachSelectionListener","e","message","beforeUnmount","detachSelectionListener","destroy","iframe","querySelector","doc","contentDocument","document","win","contentWindow","window","_selectionDoc","_selectionWin","addEventListener","onSelectionMouseUp","removeEventListener","onMouseUp","updateToolbarFromSelection","sel","getSelection","text","toString","trim","rect","getRangeAt","getBoundingClientRect","iframeRect","_","onAddToDictionary","removeAllRanges","onMouseup","_hoisted_1","_createVNode","_component_SelectionToolbar","$data","_hoisted_2","_toDisplayString","_hoisted_3","for","pdfjsLib","workerSrc","generateUrl","blob","Blob","numPages","pdfDoc","canvasRefs","pageWrapRefs","scaleFactor","currentPage","minScale","maxScale","pixelRatio","Math","min","devicePixelRatio","fitPageScale","fitWidthScale","pagesPerView","pagesPerViewInput","maxPagesPerView","textLayerRefs","textLayers","scalePercent","round","watch","renderAllPages","loadPdf","values","forEach","tl","cancel","scrollEl","onScroll","setCanvasRef","el","pageNum","setPageWrapRef","setTextLayerRef","setPagesPerView","n","clamped","max","Number","onPagesPerViewInput","applyPagesPerViewFromInput","onPagesPerViewChange","v","parseInt","isFinite","zoomIn","zoomOut","fitWidth","fitPage","goToPage","scrollIntoView","behavior","block","inline","viewportCenter","scrollLeft","clientWidth","page","bestDist","Infinity","wrap","wrapCenter","offsetLeft","offsetWidth","dist","abs","arrayBuffer","promise","markRaw","computeFitPageScale","passive","w","h","clientHeight","vp","getPage","getViewport","scale","scaleW","scaleH","fitBoth","containerEl","viewWidth","viewHeight","baseWidth","baseHeight","canvas","vp1","scaleByWidth","scaleByHeight","baseScale","effectiveScale","viewport","ctx","getContext","render","canvasContext","textLayerEl","innerHTML","displayViewport","textContent","getTextContent","textLayer","textContentSource","container","EpubViewer","PdfViewer","title","disabled","viewBox","fill","d","_hoisted_5","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_Fragment","_renderList","key","_normalizeClass","$event","_hoisted_11","id","onInput","onChange","_hoisted_13","_hoisted_15","_hoisted_17","_hoisted_19","_hoisted_20","fileId","loadingPdf","pdfBlob","windowWidth","innerWidth","dictMessage","streamUrl","getStreamUrl","isEpub","$route","query","mime","isMobile","onResize","getStreamBlob","response","status","_component_router_link","_hoisted_4","_hoisted_6","_component_EpubViewer","_ctx","_component_PdfViewer","___CSS_LOADER_EXPORT___","push","module"],"ignoreList":[],"sourceRoot":""}