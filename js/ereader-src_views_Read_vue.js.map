{"version":3,"file":"ereader-src_views_Read_vue.js?v=c7f6ea0e87ca144f93ec","mappings":"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","sources":["webpack:///ereader/src/views/Read.vue","webpack:///ereader/src/components/EpubViewer.vue","webpack://ereader/./src/components/EpubViewer.vue?6d36","webpack://ereader/./src/components/EpubViewer.vue?d82e","webpack:///ereader/src/components/PdfViewer.vue","webpack://ereader/./src/components/PdfViewer.vue?f48a","webpack://ereader/./src/components/PdfViewer.vue?c570","webpack://ereader/./src/views/Read.vue?636c","webpack://ereader/./src/views/Read.vue?038f","webpack:///ereader/src/components/EpubViewer.vue?vue&type=style&index=0&id=8cf22e98&scoped=true&lang=css","webpack:///ereader/src/views/Read.vue?vue&type=style&index=0&id=7465632c&scoped=true&lang=css","webpack:///ereader/src/components/PdfViewer.vue?vue&type=style&index=0&id=2aab86c4&scoped=true&lang=css"],"sourcesContent":["<template>\n\t<div class=\"ereader-read\">\n\t\t<header v-if=\"!isMobile\" class=\"ereader-read__header\">\n\t\t\t<router-link :to=\"{ name: 'Library' }\" class=\"ereader-read__back\">{{ t('ereader', 'Back to library') }}</router-link>\n\t\t</header>\n\t\t<div class=\"ereader-read__area\">\n\t\t\t<div v-if=\"error\" class=\"ereader-read__error\">{{ error }}</div>\n\t\t\t<div v-else-if=\"!isEpub && loadingPdf\" class=\"ereader-read__loading\">{{ t('ereader', 'Loading…') }}</div>\n\t\t\t<EpubViewer v-else-if=\"isEpub\" :url=\"streamUrl\" />\n\t\t\t<PdfViewer v-else-if=\"pdfBlob\" :blob=\"pdfBlob\" />\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { getStreamUrl, getStreamBlob } from '../router/api'\nimport { translate as t } from '@nextcloud/l10n'\nimport EpubViewer from '../components/EpubViewer.vue'\nimport PdfViewer from '../components/PdfViewer.vue'\n\nconst MIME_EPUB = 'application/epub+zip'\nconst MOBILE_BREAKPOINT = 768\n\nexport default {\n\tname: 'Read',\n\tcomponents: { EpubViewer, PdfViewer },\n\tprops: {\n\t\tfileId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\terror: '',\n\t\t\tloadingPdf: false,\n\t\t\tpdfBlob: null,\n\t\t\twindowWidth: typeof window !== 'undefined' ? window.innerWidth : 1024,\n\t\t}\n\t},\n\tcomputed: {\n\t\tstreamUrl() {\n\t\t\treturn getStreamUrl(Number(this.fileId))\n\t\t},\n\t\tisEpub() {\n\t\t\treturn this.$route.query?.mime === MIME_EPUB\n\t\t},\n\t\tisMobile() {\n\t\t\treturn this.windowWidth <= MOBILE_BREAKPOINT\n\t\t},\n\t},\n\tasync mounted() {\n\t\twindow.addEventListener('resize', this.onResize)\n\t\tif (this.isEpub) return\n\t\tthis.loadingPdf = true\n\t\tthis.error = ''\n\t\ttry {\n\t\t\tthis.pdfBlob = await getStreamBlob(Number(this.fileId))\n\t\t} catch (e) {\n\t\t\tthis.error = e.response?.status === 403\n\t\t\t\t? t('ereader', 'Access denied. Please refresh the page and try again.')\n\t\t\t\t: (e.message || t('ereader', 'Failed to load the file.'))\n\t\t} finally {\n\t\t\tthis.loadingPdf = false\n\t\t}\n\t},\n\tbeforeUnmount() {\n\t\twindow.removeEventListener('resize', this.onResize)\n\t\tthis.pdfBlob = null\n\t},\n\tmethods: {\n\t\tt,\n\t\tonResize() {\n\t\t\tthis.windowWidth = window.innerWidth\n\t\t},\n\t},\n}\n</script>\n\n<style scoped>\n.ereader-read {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tmin-height: 0;\n\twidth: 100%;\n\tmax-width: 100vw;\n\tbox-sizing: border-box;\n\toverflow: hidden;\n}\n.ereader-read__header {\n\tflex-shrink: 0;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n.ereader-read__back {\n\tcolor: inherit;\n\ttext-decoration: none;\n\tfont-weight: 500;\n}\n.ereader-read__back:hover {\n\ttext-decoration: underline;\n}\n.ereader-read__area {\n\tflex: 1;\n\tposition: relative;\n\tmin-height: 0;\n\twidth: 100%;\n\toverflow: hidden;\n}\n.ereader-read__error,\n.ereader-read__loading {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n}\n.ereader-read__error {\n\tcolor: var(--ereader-error);\n}\n</style>\n","<template>\n\t<div class=\"epub-viewer\">\n\t\t<div ref=\"viewerEl\" class=\"epub-viewer__area\"></div>\n\t\t<div v-if=\"loading\" class=\"epub-viewer__loading\">{{ t('ereader', 'Loading…') }}</div>\n\t\t<div v-else-if=\"error\" class=\"epub-viewer__error\">{{ error }}</div>\n\t</div>\n</template>\n\n<script>\nimport { translate as t } from '@nextcloud/l10n'\n\nexport default {\n\tname: 'EpubViewer',\n\tprops: {\n\t\turl: { type: String, required: true },\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tloading: true,\n\t\t\terror: '',\n\t\t\trendition: null,\n\t\t\tbook: null,\n\t\t}\n\t},\n\tasync mounted() {\n\t\ttry {\n\t\t\tconst { default: ePub } = await import('epubjs')\n\t\t\tthis.book = ePub(this.url)\n\t\t\tawait this.book.ready\n\t\t\tthis.rendition = this.book.renderTo(this.$refs.viewerEl, {\n\t\t\t\twidth: '100%',\n\t\t\t\theight: '100%',\n\t\t\t\tspread: 'none',\n\t\t\t})\n\t\t\tawait this.rendition.display()\n\t\t\tthis.loading = false\n\t\t} catch (e) {\n\t\t\tthis.error = e.message || this.t('ereader', 'Failed to load book')\n\t\t\tthis.loading = false\n\t\t}\n\t},\n\tbeforeUnmount() {\n\t\tif (this.rendition) {\n\t\t\tthis.rendition.destroy()\n\t\t}\n\t\tif (this.book) {\n\t\t\tthis.book.destroy()\n\t\t}\n\t},\n\tmethods: {\n\t\tt,\n\t},\n}\n</script>\n\n<style scoped>\n.epub-viewer {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n}\n.epub-viewer__area {\n\twidth: 100%;\n\theight: 100%;\n\tbackground: var(--color-main-background, #fff);\n}\n.epub-viewer__loading,\n.epub-viewer__error {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n}\n.epub-viewer__error {\n\tcolor: var(--color-error, #c00);\n}\n</style>\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./EpubViewer.vue?vue&type=style&index=0&id=8cf22e98&scoped=true&lang=css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./EpubViewer.vue?vue&type=style&index=0&id=8cf22e98&scoped=true&lang=css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render } from \"./EpubViewer.vue?vue&type=template&id=8cf22e98&scoped=true\"\nimport script from \"./EpubViewer.vue?vue&type=script&lang=js\"\nexport * from \"./EpubViewer.vue?vue&type=script&lang=js\"\n\nimport \"./EpubViewer.vue?vue&type=style&index=0&id=8cf22e98&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-8cf22e98\"]])\n\nexport default __exports__","<template>\n\t<div class=\"pdf-viewer\">\n\t\t<div ref=\"containerEl\" class=\"pdf-viewer__container\">\n\t\t\t<canvas\n\t\t\t\tv-for=\"pageNum in numPages\"\n\t\t\t\t:key=\"pageNum\"\n\t\t\t\t:ref=\"(el) => setCanvasRef(el, pageNum)\"\n\t\t\t\tclass=\"pdf-viewer__page\"\n\t\t\t/>\n\t\t</div>\n\t\t<div v-if=\"loading\" class=\"pdf-viewer__loading\">{{ t('ereader', 'Loading…') }}</div>\n\t\t<div v-else-if=\"error\" class=\"pdf-viewer__error\">{{ error }}</div>\n\t</div>\n</template>\n\n<script>\nimport { translate as t } from '@nextcloud/l10n'\nimport { generateUrl } from '@nextcloud/router'\nimport * as pdfjsLib from 'pdfjs-dist'\n\n// Point worker to our built file (Nextcloud app js path)\nif (typeof window !== 'undefined' && !pdfjsLib.GlobalWorkerOptions.workerSrc) {\n\tpdfjsLib.GlobalWorkerOptions.workerSrc = generateUrl('/apps/ereader/js/pdf.worker.js')\n}\n\nexport default {\n\tname: 'PdfViewer',\n\tprops: {\n\t\tblob: {\n\t\t\ttype: Blob,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tloading: true,\n\t\t\terror: '',\n\t\t\tnumPages: 0,\n\t\t\tpdfDoc: null,\n\t\t\tcanvasRefs: {},\n\t\t}\n\t},\n\tasync mounted() {\n\t\tawait this.loadPdf()\n\t},\n\tbeforeUnmount() {\n\t\tthis.canvasRefs = {}\n\t\tif (this.pdfDoc) {\n\t\t\tthis.pdfDoc.destroy()\n\t\t\tthis.pdfDoc = null\n\t\t}\n\t},\n\tmethods: {\n\t\tt,\n\t\tsetCanvasRef(el, pageNum) {\n\t\t\tif (el) this.canvasRefs[pageNum] = el\n\t\t},\n\t\tasync loadPdf() {\n\t\t\tthis.loading = true\n\t\t\tthis.error = ''\n\t\t\ttry {\n\t\t\t\tconst data = await this.blob.arrayBuffer()\n\t\t\t\tthis.pdfDoc = await pdfjsLib.getDocument({ data }).promise\n\t\t\t\tthis.numPages = this.pdfDoc.numPages\n\t\t\t\tthis.loading = false\n\t\t\t\tawait this.$nextTick()\n\t\t\t\tawait this.renderAllPages()\n\t\t\t} catch (e) {\n\t\t\t\tthis.error = e.message || t('ereader', 'Failed to load PDF')\n\t\t\t\tthis.loading = false\n\t\t\t}\n\t\t},\n\t\tasync renderAllPages() {\n\t\t\tif (!this.pdfDoc || !this.$refs.containerEl) return\n\t\t\tconst container = this.$refs.containerEl\n\t\t\tconst width = container.clientWidth || 800\n\t\t\tfor (let n = 1; n <= this.numPages; n++) {\n\t\t\t\tconst canvas = this.canvasRefs[n]\n\t\t\t\tif (!canvas) continue\n\t\t\t\tconst page = await this.pdfDoc.getPage(n)\n\t\t\t\tconst scale = width / page.getViewport({ scale: 1 }).width\n\t\t\t\tconst viewport = page.getViewport({ scale })\n\t\t\t\tcanvas.height = viewport.height\n\t\t\t\tcanvas.width = viewport.width\n\t\t\t\tconst ctx = canvas.getContext('2d')\n\t\t\t\tawait page.render({\n\t\t\t\t\tcanvasContext: ctx,\n\t\t\t\t\tviewport,\n\t\t\t\t}).promise\n\t\t\t}\n\t\t},\n\t},\n}\n</script>\n\n<style scoped>\n.pdf-viewer {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: var(--ereader-surface);\n\toverflow: auto;\n}\n\n.pdf-viewer__container {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tpadding: 1rem 0;\n\tgap: 1rem;\n}\n\n.pdf-viewer__page {\n\tdisplay: block;\n\tmax-width: 100%;\n\theight: auto;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n\n.pdf-viewer__loading,\n.pdf-viewer__error {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n}\n\n.pdf-viewer__error {\n\tcolor: var(--ereader-error);\n}\n</style>\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./PdfViewer.vue?vue&type=style&index=0&id=2aab86c4&scoped=true&lang=css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./PdfViewer.vue?vue&type=style&index=0&id=2aab86c4&scoped=true&lang=css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render } from \"./PdfViewer.vue?vue&type=template&id=2aab86c4&scoped=true\"\nimport script from \"./PdfViewer.vue?vue&type=script&lang=js\"\nexport * from \"./PdfViewer.vue?vue&type=script&lang=js\"\n\nimport \"./PdfViewer.vue?vue&type=style&index=0&id=2aab86c4&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-2aab86c4\"]])\n\nexport default __exports__","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./Read.vue?vue&type=style&index=0&id=7465632c&scoped=true&lang=css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[11].use[0]!./Read.vue?vue&type=style&index=0&id=7465632c&scoped=true&lang=css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render } from \"./Read.vue?vue&type=template&id=7465632c&scoped=true\"\nimport script from \"./Read.vue?vue&type=script&lang=js\"\nexport * from \"./Read.vue?vue&type=script&lang=js\"\n\nimport \"./Read.vue?vue&type=style&index=0&id=7465632c&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-7465632c\"]])\n\nexport default __exports__","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `\n.epub-viewer[data-v-8cf22e98] {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n}\n.epub-viewer__area[data-v-8cf22e98] {\n\twidth: 100%;\n\theight: 100%;\n\tbackground: var(--color-main-background, #fff);\n}\n.epub-viewer__loading[data-v-8cf22e98],\n.epub-viewer__error[data-v-8cf22e98] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n}\n.epub-viewer__error[data-v-8cf22e98] {\n\tcolor: var(--color-error, #c00);\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/components/EpubViewer.vue\"],\"names\":[],\"mappings\":\";AAwDA;CACC,kBAAkB;CAClB,WAAW;CACX,YAAY;AACb;AACA;CACC,WAAW;CACX,YAAY;CACZ,8CAA8C;AAC/C;AACA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;AACnB;AACA;CACC,+BAA+B;AAChC\",\"sourcesContent\":[\"<template>\\n\\t<div class=\\\"epub-viewer\\\">\\n\\t\\t<div ref=\\\"viewerEl\\\" class=\\\"epub-viewer__area\\\"></div>\\n\\t\\t<div v-if=\\\"loading\\\" class=\\\"epub-viewer__loading\\\">{{ t('ereader', 'Loading…') }}</div>\\n\\t\\t<div v-else-if=\\\"error\\\" class=\\\"epub-viewer__error\\\">{{ error }}</div>\\n\\t</div>\\n</template>\\n\\n<script>\\nimport { translate as t } from '@nextcloud/l10n'\\n\\nexport default {\\n\\tname: 'EpubViewer',\\n\\tprops: {\\n\\t\\turl: { type: String, required: true },\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tloading: true,\\n\\t\\t\\terror: '',\\n\\t\\t\\trendition: null,\\n\\t\\t\\tbook: null,\\n\\t\\t}\\n\\t},\\n\\tasync mounted() {\\n\\t\\ttry {\\n\\t\\t\\tconst { default: ePub } = await import('epubjs')\\n\\t\\t\\tthis.book = ePub(this.url)\\n\\t\\t\\tawait this.book.ready\\n\\t\\t\\tthis.rendition = this.book.renderTo(this.$refs.viewerEl, {\\n\\t\\t\\t\\twidth: '100%',\\n\\t\\t\\t\\theight: '100%',\\n\\t\\t\\t\\tspread: 'none',\\n\\t\\t\\t})\\n\\t\\t\\tawait this.rendition.display()\\n\\t\\t\\tthis.loading = false\\n\\t\\t} catch (e) {\\n\\t\\t\\tthis.error = e.message || this.t('ereader', 'Failed to load book')\\n\\t\\t\\tthis.loading = false\\n\\t\\t}\\n\\t},\\n\\tbeforeUnmount() {\\n\\t\\tif (this.rendition) {\\n\\t\\t\\tthis.rendition.destroy()\\n\\t\\t}\\n\\t\\tif (this.book) {\\n\\t\\t\\tthis.book.destroy()\\n\\t\\t}\\n\\t},\\n\\tmethods: {\\n\\t\\tt,\\n\\t},\\n}\\n</script>\\n\\n<style scoped>\\n.epub-viewer {\\n\\tposition: relative;\\n\\twidth: 100%;\\n\\theight: 100%;\\n}\\n.epub-viewer__area {\\n\\twidth: 100%;\\n\\theight: 100%;\\n\\tbackground: var(--color-main-background, #fff);\\n}\\n.epub-viewer__loading,\\n.epub-viewer__error {\\n\\tposition: absolute;\\n\\tinset: 0;\\n\\tdisplay: flex;\\n\\talign-items: center;\\n\\tjustify-content: center;\\n\\tpadding: 2rem;\\n\\ttext-align: center;\\n}\\n.epub-viewer__error {\\n\\tcolor: var(--color-error, #c00);\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `\n.ereader-read[data-v-7465632c] {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tmin-height: 0;\n\twidth: 100%;\n\tmax-width: 100vw;\n\tbox-sizing: border-box;\n\toverflow: hidden;\n}\n.ereader-read__header[data-v-7465632c] {\n\tflex-shrink: 0;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n.ereader-read__back[data-v-7465632c] {\n\tcolor: inherit;\n\ttext-decoration: none;\n\tfont-weight: 500;\n}\n.ereader-read__back[data-v-7465632c]:hover {\n\ttext-decoration: underline;\n}\n.ereader-read__area[data-v-7465632c] {\n\tflex: 1;\n\tposition: relative;\n\tmin-height: 0;\n\twidth: 100%;\n\toverflow: hidden;\n}\n.ereader-read__error[data-v-7465632c],\n.ereader-read__loading[data-v-7465632c] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n}\n.ereader-read__error[data-v-7465632c] {\n\tcolor: var(--ereader-error);\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/views/Read.vue\"],\"names\":[],\"mappings\":\";AAgFA;CACC,aAAa;CACb,sBAAsB;CACtB,YAAY;CACZ,aAAa;CACb,WAAW;CACX,gBAAgB;CAChB,sBAAsB;CACtB,gBAAgB;AACjB;AACA;CACC,cAAc;CACd,oBAAoB;CACpB,qCAAqC;CACrC,kCAAkC;CAClC,8CAA8C;AAC/C;AACA;CACC,cAAc;CACd,qBAAqB;CACrB,gBAAgB;AACjB;AACA;CACC,0BAA0B;AAC3B;AACA;CACC,OAAO;CACP,kBAAkB;CAClB,aAAa;CACb,WAAW;CACX,gBAAgB;AACjB;AACA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;CAClB,oCAAoC;AACrC;AACA;CACC,2BAA2B;AAC5B\",\"sourcesContent\":[\"<template>\\n\\t<div class=\\\"ereader-read\\\">\\n\\t\\t<header v-if=\\\"!isMobile\\\" class=\\\"ereader-read__header\\\">\\n\\t\\t\\t<router-link :to=\\\"{ name: 'Library' }\\\" class=\\\"ereader-read__back\\\">{{ t('ereader', 'Back to library') }}</router-link>\\n\\t\\t</header>\\n\\t\\t<div class=\\\"ereader-read__area\\\">\\n\\t\\t\\t<div v-if=\\\"error\\\" class=\\\"ereader-read__error\\\">{{ error }}</div>\\n\\t\\t\\t<div v-else-if=\\\"!isEpub && loadingPdf\\\" class=\\\"ereader-read__loading\\\">{{ t('ereader', 'Loading…') }}</div>\\n\\t\\t\\t<EpubViewer v-else-if=\\\"isEpub\\\" :url=\\\"streamUrl\\\" />\\n\\t\\t\\t<PdfViewer v-else-if=\\\"pdfBlob\\\" :blob=\\\"pdfBlob\\\" />\\n\\t\\t</div>\\n\\t</div>\\n</template>\\n\\n<script>\\nimport { getStreamUrl, getStreamBlob } from '../router/api'\\nimport { translate as t } from '@nextcloud/l10n'\\nimport EpubViewer from '../components/EpubViewer.vue'\\nimport PdfViewer from '../components/PdfViewer.vue'\\n\\nconst MIME_EPUB = 'application/epub+zip'\\nconst MOBILE_BREAKPOINT = 768\\n\\nexport default {\\n\\tname: 'Read',\\n\\tcomponents: { EpubViewer, PdfViewer },\\n\\tprops: {\\n\\t\\tfileId: {\\n\\t\\t\\ttype: [String, Number],\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\terror: '',\\n\\t\\t\\tloadingPdf: false,\\n\\t\\t\\tpdfBlob: null,\\n\\t\\t\\twindowWidth: typeof window !== 'undefined' ? window.innerWidth : 1024,\\n\\t\\t}\\n\\t},\\n\\tcomputed: {\\n\\t\\tstreamUrl() {\\n\\t\\t\\treturn getStreamUrl(Number(this.fileId))\\n\\t\\t},\\n\\t\\tisEpub() {\\n\\t\\t\\treturn this.$route.query?.mime === MIME_EPUB\\n\\t\\t},\\n\\t\\tisMobile() {\\n\\t\\t\\treturn this.windowWidth <= MOBILE_BREAKPOINT\\n\\t\\t},\\n\\t},\\n\\tasync mounted() {\\n\\t\\twindow.addEventListener('resize', this.onResize)\\n\\t\\tif (this.isEpub) return\\n\\t\\tthis.loadingPdf = true\\n\\t\\tthis.error = ''\\n\\t\\ttry {\\n\\t\\t\\tthis.pdfBlob = await getStreamBlob(Number(this.fileId))\\n\\t\\t} catch (e) {\\n\\t\\t\\tthis.error = e.response?.status === 403\\n\\t\\t\\t\\t? t('ereader', 'Access denied. Please refresh the page and try again.')\\n\\t\\t\\t\\t: (e.message || t('ereader', 'Failed to load the file.'))\\n\\t\\t} finally {\\n\\t\\t\\tthis.loadingPdf = false\\n\\t\\t}\\n\\t},\\n\\tbeforeUnmount() {\\n\\t\\twindow.removeEventListener('resize', this.onResize)\\n\\t\\tthis.pdfBlob = null\\n\\t},\\n\\tmethods: {\\n\\t\\tt,\\n\\t\\tonResize() {\\n\\t\\t\\tthis.windowWidth = window.innerWidth\\n\\t\\t},\\n\\t},\\n}\\n</script>\\n\\n<style scoped>\\n.ereader-read {\\n\\tdisplay: flex;\\n\\tflex-direction: column;\\n\\theight: 100%;\\n\\tmin-height: 0;\\n\\twidth: 100%;\\n\\tmax-width: 100vw;\\n\\tbox-sizing: border-box;\\n\\toverflow: hidden;\\n}\\n.ereader-read__header {\\n\\tflex-shrink: 0;\\n\\tpadding: 0.5rem 1rem;\\n\\tbackground: var(--ereader-action-bar);\\n\\tcolor: var(--ereader-primary-text);\\n\\tborder-bottom: 1px solid var(--ereader-border);\\n}\\n.ereader-read__back {\\n\\tcolor: inherit;\\n\\ttext-decoration: none;\\n\\tfont-weight: 500;\\n}\\n.ereader-read__back:hover {\\n\\ttext-decoration: underline;\\n}\\n.ereader-read__area {\\n\\tflex: 1;\\n\\tposition: relative;\\n\\tmin-height: 0;\\n\\twidth: 100%;\\n\\toverflow: hidden;\\n}\\n.ereader-read__error,\\n.ereader-read__loading {\\n\\tposition: absolute;\\n\\tinset: 0;\\n\\tdisplay: flex;\\n\\talign-items: center;\\n\\tjustify-content: center;\\n\\tpadding: 2rem;\\n\\ttext-align: center;\\n\\tcolor: var(--ereader-text-secondary);\\n}\\n.ereader-read__error {\\n\\tcolor: var(--ereader-error);\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `\n.pdf-viewer[data-v-2aab86c4] {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: var(--ereader-surface);\n\toverflow: auto;\n}\n.pdf-viewer__container[data-v-2aab86c4] {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tpadding: 1rem 0;\n\tgap: 1rem;\n}\n.pdf-viewer__page[data-v-2aab86c4] {\n\tdisplay: block;\n\tmax-width: 100%;\n\theight: auto;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n.pdf-viewer__loading[data-v-2aab86c4],\n.pdf-viewer__error[data-v-2aab86c4] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n}\n.pdf-viewer__error[data-v-2aab86c4] {\n\tcolor: var(--ereader-error);\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/components/PdfViewer.vue\"],\"names\":[],\"mappings\":\";AAgGA;CACC,kBAAkB;CAClB,WAAW;CACX,YAAY;CACZ,kCAAkC;CAClC,cAAc;AACf;AAEA;CACC,aAAa;CACb,sBAAsB;CACtB,mBAAmB;CACnB,eAAe;CACf,SAAS;AACV;AAEA;CACC,cAAc;CACd,eAAe;CACf,YAAY;CACZ,sCAAsC;AACvC;AAEA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;CAClB,oCAAoC;AACrC;AAEA;CACC,2BAA2B;AAC5B\",\"sourcesContent\":[\"<template>\\n\\t<div class=\\\"pdf-viewer\\\">\\n\\t\\t<div ref=\\\"containerEl\\\" class=\\\"pdf-viewer__container\\\">\\n\\t\\t\\t<canvas\\n\\t\\t\\t\\tv-for=\\\"pageNum in numPages\\\"\\n\\t\\t\\t\\t:key=\\\"pageNum\\\"\\n\\t\\t\\t\\t:ref=\\\"(el) => setCanvasRef(el, pageNum)\\\"\\n\\t\\t\\t\\tclass=\\\"pdf-viewer__page\\\"\\n\\t\\t\\t/>\\n\\t\\t</div>\\n\\t\\t<div v-if=\\\"loading\\\" class=\\\"pdf-viewer__loading\\\">{{ t('ereader', 'Loading…') }}</div>\\n\\t\\t<div v-else-if=\\\"error\\\" class=\\\"pdf-viewer__error\\\">{{ error }}</div>\\n\\t</div>\\n</template>\\n\\n<script>\\nimport { translate as t } from '@nextcloud/l10n'\\nimport { generateUrl } from '@nextcloud/router'\\nimport * as pdfjsLib from 'pdfjs-dist'\\n\\n// Point worker to our built file (Nextcloud app js path)\\nif (typeof window !== 'undefined' && !pdfjsLib.GlobalWorkerOptions.workerSrc) {\\n\\tpdfjsLib.GlobalWorkerOptions.workerSrc = generateUrl('/apps/ereader/js/pdf.worker.js')\\n}\\n\\nexport default {\\n\\tname: 'PdfViewer',\\n\\tprops: {\\n\\t\\tblob: {\\n\\t\\t\\ttype: Blob,\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tloading: true,\\n\\t\\t\\terror: '',\\n\\t\\t\\tnumPages: 0,\\n\\t\\t\\tpdfDoc: null,\\n\\t\\t\\tcanvasRefs: {},\\n\\t\\t}\\n\\t},\\n\\tasync mounted() {\\n\\t\\tawait this.loadPdf()\\n\\t},\\n\\tbeforeUnmount() {\\n\\t\\tthis.canvasRefs = {}\\n\\t\\tif (this.pdfDoc) {\\n\\t\\t\\tthis.pdfDoc.destroy()\\n\\t\\t\\tthis.pdfDoc = null\\n\\t\\t}\\n\\t},\\n\\tmethods: {\\n\\t\\tt,\\n\\t\\tsetCanvasRef(el, pageNum) {\\n\\t\\t\\tif (el) this.canvasRefs[pageNum] = el\\n\\t\\t},\\n\\t\\tasync loadPdf() {\\n\\t\\t\\tthis.loading = true\\n\\t\\t\\tthis.error = ''\\n\\t\\t\\ttry {\\n\\t\\t\\t\\tconst data = await this.blob.arrayBuffer()\\n\\t\\t\\t\\tthis.pdfDoc = await pdfjsLib.getDocument({ data }).promise\\n\\t\\t\\t\\tthis.numPages = this.pdfDoc.numPages\\n\\t\\t\\t\\tthis.loading = false\\n\\t\\t\\t\\tawait this.$nextTick()\\n\\t\\t\\t\\tawait this.renderAllPages()\\n\\t\\t\\t} catch (e) {\\n\\t\\t\\t\\tthis.error = e.message || t('ereader', 'Failed to load PDF')\\n\\t\\t\\t\\tthis.loading = false\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\tasync renderAllPages() {\\n\\t\\t\\tif (!this.pdfDoc || !this.$refs.containerEl) return\\n\\t\\t\\tconst container = this.$refs.containerEl\\n\\t\\t\\tconst width = container.clientWidth || 800\\n\\t\\t\\tfor (let n = 1; n <= this.numPages; n++) {\\n\\t\\t\\t\\tconst canvas = this.canvasRefs[n]\\n\\t\\t\\t\\tif (!canvas) continue\\n\\t\\t\\t\\tconst page = await this.pdfDoc.getPage(n)\\n\\t\\t\\t\\tconst scale = width / page.getViewport({ scale: 1 }).width\\n\\t\\t\\t\\tconst viewport = page.getViewport({ scale })\\n\\t\\t\\t\\tcanvas.height = viewport.height\\n\\t\\t\\t\\tcanvas.width = viewport.width\\n\\t\\t\\t\\tconst ctx = canvas.getContext('2d')\\n\\t\\t\\t\\tawait page.render({\\n\\t\\t\\t\\t\\tcanvasContext: ctx,\\n\\t\\t\\t\\t\\tviewport,\\n\\t\\t\\t\\t}).promise\\n\\t\\t\\t}\\n\\t\\t},\\n\\t},\\n}\\n</script>\\n\\n<style scoped>\\n.pdf-viewer {\\n\\tposition: relative;\\n\\twidth: 100%;\\n\\theight: 100%;\\n\\tbackground: var(--ereader-surface);\\n\\toverflow: auto;\\n}\\n\\n.pdf-viewer__container {\\n\\tdisplay: flex;\\n\\tflex-direction: column;\\n\\talign-items: center;\\n\\tpadding: 1rem 0;\\n\\tgap: 1rem;\\n}\\n\\n.pdf-viewer__page {\\n\\tdisplay: block;\\n\\tmax-width: 100%;\\n\\theight: auto;\\n\\tbox-shadow: var(--ereader-card-shadow);\\n}\\n\\n.pdf-viewer__loading,\\n.pdf-viewer__error {\\n\\tposition: absolute;\\n\\tinset: 0;\\n\\tdisplay: flex;\\n\\talign-items: center;\\n\\tjustify-content: center;\\n\\tpadding: 2rem;\\n\\ttext-align: center;\\n\\tcolor: var(--ereader-text-secondary);\\n}\\n\\n.pdf-viewer__error {\\n\\tcolor: var(--ereader-error);\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n"],"names":["class","ref","name","props","url","type","String","required","data","loading","error","rendition","book","mounted","default","ePub","this","ready","renderTo","$refs","viewerEl","width","height","spread","display","e","message","t","beforeUnmount","destroy","methods","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","locals","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","$data","_hoisted_3","_toDisplayString","$options","_hoisted_4","window","pdfjsLib","workerSrc","generateUrl","blob","Blob","numPages","pdfDoc","canvasRefs","loadPdf","setCanvasRef","el","pageNum","arrayBuffer","promise","$nextTick","renderAllPages","containerEl","clientWidth","n","canvas","page","getPage","scale","getViewport","viewport","ctx","getContext","render","canvasContext","components","EpubViewer","PdfViewer","_Fragment","_renderList","key","fileId","Number","loadingPdf","pdfBlob","windowWidth","innerWidth","computed","streamUrl","getStreamUrl","isEpub","$route","query","mime","isMobile","addEventListener","onResize","getStreamBlob","response","status","removeEventListener","_createVNode","_component_router_link","to","_hoisted_5","_createBlock","_component_EpubViewer","_component_PdfViewer","___CSS_LOADER_EXPORT___","push","module","id"],"ignoreList":[],"sourceRoot":""}