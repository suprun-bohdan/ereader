"use strict";(self.webpackChunkereader=self.webpackChunkereader||[]).push([["src_views_Read_vue"],{1398(t,e,n){n.r(e),n.d(e,{default:()=>rt});var r=n(641),a=n(33);const i={class:"ereader-read"},o={key:0,class:"ereader-read__header"},s={class:"ereader-read__area"},d={key:0,class:"ereader-read__error"},l={key:1,class:"ereader-read__loading"};var c=n(249),A=n(3334);const p={class:"epub-viewer"},f={ref:"viewerEl",class:"epub-viewer__area"},h={key:0,class:"epub-viewer__loading"},u={key:1,class:"epub-viewer__error"};const v={name:"EpubViewer",props:{url:{type:String,required:!0}},data:()=>({loading:!0,error:"",rendition:null,book:null}),async mounted(){try{const{default:t}=await n.e("vendors-node_modules_epubjs_src_index_js").then(n.bind(n,1684));this.book=t(this.url),await this.book.ready,this.rendition=this.book.renderTo(this.$refs.viewerEl,{width:"100%",height:"100%",spread:"none"}),await this.rendition.display(),this.loading=!1}catch(t){this.error=t.message||this.t("ereader","Failed to load book"),this.loading=!1}},beforeUnmount(){this.rendition&&this.rendition.destroy(),this.book&&this.book.destroy()},methods:{t:A.Tl}};var C=n(5072),g=n.n(C),w=n(7825),b=n.n(w),m=n(7659),_=n.n(m),B=n(5056),k=n.n(B),x=n(540),y=n.n(x),P=n(1113),E=n.n(P),L=n(2706),R={};R.styleTagTransform=E(),R.setAttributes=k(),R.insert=_().bind(null,"head"),R.domAPI=b(),R.insertStyleElement=y();g()(L.A,R);L.A&&L.A.locals&&L.A.locals;var W=n(6262);const S=(0,W.A)(v,[["render",function(t,e,n,i,o,s){return(0,r.uX)(),(0,r.CE)("div",p,[(0,r.Lk)("div",f,null,512),o.loading?((0,r.uX)(),(0,r.CE)("div",h,(0,a.v_)(s.t("ereader","Loading…")),1)):o.error?((0,r.uX)(),(0,r.CE)("div",u,(0,a.v_)(o.error),1)):(0,r.Q3)("",!0)])}],["__scopeId","data-v-8cf22e98"]]),M={class:"pdf-viewer"},T={key:0,class:"pdf-viewer__toolbar"},z={class:"pdf-viewer__toolbar-group"},F=["title","disabled"],$={class:"pdf-viewer__scale"},I=["title","disabled"],V=["title"],j={class:"pdf-viewer__toolbar-group pdf-viewer__toolbar-group--page"},N=["title","disabled"],X={class:"pdf-viewer__page-indicator"},D=["title","disabled"],O={ref:"containerEl",class:"pdf-viewer__container"},Y=["data-page"],U={key:1,class:"pdf-viewer__loading"},q={key:2,class:"pdf-viewer__error"};var Z=n(953),Q=n(9498),H=n(1100);"undefined"==typeof window||H.EA.workerSrc||(H.EA.workerSrc=(0,Q.Jv)("/apps/ereader/js/pdf.worker.js"));const G={name:"PdfViewer",props:{blob:{type:Blob,required:!0}},data:()=>({loading:!0,error:"",numPages:0,pdfDoc:null,canvasRefs:{},pageWrapRefs:{},scaleFactor:1,currentPage:1,minScale:.5,maxScale:3,pixelRatio:"undefined"!=typeof window?Math.min(window.devicePixelRatio||1,2):1}),computed:{scalePercent(){return Math.round(100*this.scaleFactor)}},async mounted(){await this.loadPdf()},beforeUnmount(){if(this.canvasRefs={},this.pageWrapRefs={},this.$refs.scrollEl&&this.$refs.scrollEl.removeEventListener("scroll",this.onScroll),this.pdfDoc&&"function"==typeof this.pdfDoc.destroy){try{this.pdfDoc.destroy()}catch(t){}this.pdfDoc=null}},methods:{t:A.Tl,setCanvasRef(t,e){t&&(this.canvasRefs[e]=t)},setPageWrapRef(t,e){t&&(this.pageWrapRefs[e]=t)},zoomIn(){this.scaleFactor=Math.min(this.maxScale,this.scaleFactor+.25),this.$nextTick(()=>this.renderAllPages())},zoomOut(){this.scaleFactor=Math.max(this.minScale,this.scaleFactor-.25),this.$nextTick(()=>this.renderAllPages())},fitWidth(){this.scaleFactor=1,this.$nextTick(()=>this.renderAllPages())},goToPage(t){const e=Math.max(1,Math.min(this.numPages,t)),n=this.pageWrapRefs[e];n&&this.$refs.scrollEl&&n.scrollIntoView({behavior:"smooth",block:"start"}),this.currentPage=e},onScroll(){const t=this.$refs.scrollEl;if(!t||0===this.numPages)return;const e=t.scrollTop+t.clientHeight/2;let n=1;for(let t=1;t<=this.numPages;t++){const r=this.pageWrapRefs[t];if(!r)continue;const a=r.offsetTop,i=a+r.offsetHeight;if(e>=a&&e<=i){n=t;break}if(e<i){n=t;break}n=t}this.currentPage=n},async loadPdf(){this.loading=!0,this.error="";try{const t=await this.blob.arrayBuffer(),e=await H.YE({data:t}).promise;this.pdfDoc=(0,Z.IG)(e),this.numPages=this.pdfDoc.numPages,this.loading=!1,await this.$nextTick(),await this.$nextTick(),await this.renderAllPages(),this.$refs.scrollEl&&this.$refs.scrollEl.addEventListener("scroll",this.onScroll,{passive:!0})}catch(t){this.error=t.message||(0,A.Tl)("ereader","Failed to load PDF"),this.loading=!1}},async renderAllPages(){if(!this.pdfDoc||!this.$refs.containerEl)return;const t=this.$refs.containerEl.clientWidth||800;for(let e=1;e<=this.numPages;e++){const n=this.canvasRefs[e];if(!n)continue;const r=await this.pdfDoc.getPage(e),a=t/r.getViewport({scale:1}).width*this.scaleFactor*this.pixelRatio,i=r.getViewport({scale:a});n.width=i.width,n.height=i.height,n.style.width=i.width/this.pixelRatio+"px",n.style.height=i.height/this.pixelRatio+"px";const o=n.getContext("2d");await r.render({canvasContext:o,viewport:i}).promise}}}};var K=n(4717),J={};J.styleTagTransform=E(),J.setAttributes=k(),J.insert=_().bind(null,"head"),J.domAPI=b(),J.insertStyleElement=y();g()(K.A,J);K.A&&K.A.locals&&K.A.locals;const tt={name:"Read",components:{EpubViewer:S,PdfViewer:(0,W.A)(G,[["render",function(t,e,n,i,o,s){return(0,r.uX)(),(0,r.CE)("div",M,[o.loading||o.error?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("header",T,[(0,r.Lk)("div",z,[(0,r.Lk)("button",{type:"button",class:"pdf-viewer__btn",title:s.t("ereader","Zoom out"),disabled:o.scaleFactor<=o.minScale,onClick:e[0]||(e[0]=(...t)=>s.zoomOut&&s.zoomOut(...t))},[...e[6]||(e[6]=[(0,r.Lk)("svg",{class:"pdf-viewer__icon",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[(0,r.Lk)("path",{d:"M19 13H5v-2h14v2z"})],-1)])],8,F),(0,r.Lk)("span",$,(0,a.v_)(s.scalePercent)+"%",1),(0,r.Lk)("button",{type:"button",class:"pdf-viewer__btn",title:s.t("ereader","Zoom in"),disabled:o.scaleFactor>=o.maxScale,onClick:e[1]||(e[1]=(...t)=>s.zoomIn&&s.zoomIn(...t))},[...e[7]||(e[7]=[(0,r.Lk)("svg",{class:"pdf-viewer__icon",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[(0,r.Lk)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1)])],8,I)]),(0,r.Lk)("button",{type:"button",class:"pdf-viewer__btn pdf-viewer__btn--text",title:s.t("ereader","Fit to width"),onClick:e[2]||(e[2]=(...t)=>s.fitWidth&&s.fitWidth(...t))},(0,a.v_)(s.t("ereader","Fit width")),9,V),(0,r.Lk)("div",j,[(0,r.Lk)("button",{type:"button",class:"pdf-viewer__btn",title:s.t("ereader","Previous page"),disabled:o.currentPage<=1,onClick:e[3]||(e[3]=t=>s.goToPage(o.currentPage-1))},[...e[8]||(e[8]=[(0,r.Lk)("svg",{class:"pdf-viewer__icon",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[(0,r.Lk)("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1)])],8,N),(0,r.Lk)("span",X,(0,a.v_)(s.t("ereader","Page"))+" "+(0,a.v_)(o.currentPage)+" / "+(0,a.v_)(o.numPages),1),(0,r.Lk)("button",{type:"button",class:"pdf-viewer__btn",title:s.t("ereader","Next page"),disabled:o.currentPage>=o.numPages,onClick:e[4]||(e[4]=t=>s.goToPage(o.currentPage+1))},[...e[9]||(e[9]=[(0,r.Lk)("svg",{class:"pdf-viewer__icon",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[(0,r.Lk)("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})],-1)])],8,D)])])),(0,r.Lk)("div",{ref:"scrollEl",class:"pdf-viewer__scroll",onScroll:e[5]||(e[5]=(...t)=>s.onScroll&&s.onScroll(...t))},[(0,r.Lk)("div",O,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.numPages,t=>((0,r.uX)(),(0,r.CE)("div",{key:t,ref_for:!0,ref:e=>s.setPageWrapRef(e,t),class:"pdf-viewer__page-wrap","data-page":t},[(0,r.Lk)("canvas",{ref_for:!0,ref:e=>s.setCanvasRef(e,t),class:"pdf-viewer__page"},null,512)],8,Y))),128))],512)],544),o.loading?((0,r.uX)(),(0,r.CE)("div",U,(0,a.v_)(s.t("ereader","Loading…")),1)):o.error?((0,r.uX)(),(0,r.CE)("div",q,(0,a.v_)(o.error),1)):(0,r.Q3)("",!0)])}],["__scopeId","data-v-0f2e5dd0"]])},props:{fileId:{type:[String,Number],required:!0}},data:()=>({error:"",loadingPdf:!1,pdfBlob:null,windowWidth:"undefined"!=typeof window?window.innerWidth:1024}),computed:{streamUrl(){return(0,c.Wq)(Number(this.fileId))},isEpub(){return"application/epub+zip"===this.$route.query?.mime},isMobile(){return this.windowWidth<=768}},async mounted(){if(window.addEventListener("resize",this.onResize),!this.isEpub){this.loadingPdf=!0,this.error="";try{this.pdfBlob=await(0,c.O0)(Number(this.fileId))}catch(t){this.error=403===t.response?.status?(0,A.Tl)("ereader","Access denied. Please refresh the page and try again."):t.message||(0,A.Tl)("ereader","Failed to load the file.")}finally{this.loadingPdf=!1}}},beforeUnmount(){window.removeEventListener("resize",this.onResize),this.pdfBlob=null},methods:{t:A.Tl,onResize(){this.windowWidth=window.innerWidth}}};var et=n(5337),nt={};nt.styleTagTransform=E(),nt.setAttributes=k(),nt.insert=_().bind(null,"head"),nt.domAPI=b(),nt.insertStyleElement=y();g()(et.A,nt);et.A&&et.A.locals&&et.A.locals;const rt=(0,W.A)(tt,[["render",function(t,e,n,c,A,p){const f=(0,r.g2)("router-link"),h=(0,r.g2)("EpubViewer"),u=(0,r.g2)("PdfViewer");return(0,r.uX)(),(0,r.CE)("div",i,[p.isMobile?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("header",o,[(0,r.bF)(f,{to:{name:"Library"},class:"ereader-read__back"},{default:(0,r.k6)(()=>[(0,r.eW)((0,a.v_)(p.t("ereader","Back to library")),1)]),_:1})])),(0,r.Lk)("div",s,[A.error?((0,r.uX)(),(0,r.CE)("div",d,(0,a.v_)(A.error),1)):!p.isEpub&&A.loadingPdf?((0,r.uX)(),(0,r.CE)("div",l,(0,a.v_)(p.t("ereader","Loading…")),1)):p.isEpub?((0,r.uX)(),(0,r.Wv)(h,{key:2,url:p.streamUrl},null,8,["url"])):A.pdfBlob?((0,r.uX)(),(0,r.Wv)(u,{key:3,blob:A.pdfBlob},null,8,["blob"])):(0,r.Q3)("",!0)])])}],["__scopeId","data-v-7465632c"]])},2706(t,e,n){n.d(e,{A:()=>s});var r=n(1354),a=n.n(r),i=n(6314),o=n.n(i)()(a());o.push([t.id,"\n.epub-viewer[data-v-8cf22e98] {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n}\n.epub-viewer__area[data-v-8cf22e98] {\n\twidth: 100%;\n\theight: 100%;\n\tbackground: var(--color-main-background, #fff);\n}\n.epub-viewer__loading[data-v-8cf22e98],\n.epub-viewer__error[data-v-8cf22e98] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n}\n.epub-viewer__error[data-v-8cf22e98] {\n\tcolor: var(--color-error, #c00);\n}\n","",{version:3,sources:["webpack://./src/components/EpubViewer.vue"],names:[],mappings:";AAwDA;CACC,kBAAkB;CAClB,WAAW;CACX,YAAY;AACb;AACA;CACC,WAAW;CACX,YAAY;CACZ,8CAA8C;AAC/C;AACA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;AACnB;AACA;CACC,+BAA+B;AAChC",sourcesContent:["<template>\n\t<div class=\"epub-viewer\">\n\t\t<div ref=\"viewerEl\" class=\"epub-viewer__area\"></div>\n\t\t<div v-if=\"loading\" class=\"epub-viewer__loading\">{{ t('ereader', 'Loading…') }}</div>\n\t\t<div v-else-if=\"error\" class=\"epub-viewer__error\">{{ error }}</div>\n\t</div>\n</template>\n\n<script>\nimport { translate as t } from '@nextcloud/l10n'\n\nexport default {\n\tname: 'EpubViewer',\n\tprops: {\n\t\turl: { type: String, required: true },\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tloading: true,\n\t\t\terror: '',\n\t\t\trendition: null,\n\t\t\tbook: null,\n\t\t}\n\t},\n\tasync mounted() {\n\t\ttry {\n\t\t\tconst { default: ePub } = await import('epubjs')\n\t\t\tthis.book = ePub(this.url)\n\t\t\tawait this.book.ready\n\t\t\tthis.rendition = this.book.renderTo(this.$refs.viewerEl, {\n\t\t\t\twidth: '100%',\n\t\t\t\theight: '100%',\n\t\t\t\tspread: 'none',\n\t\t\t})\n\t\t\tawait this.rendition.display()\n\t\t\tthis.loading = false\n\t\t} catch (e) {\n\t\t\tthis.error = e.message || this.t('ereader', 'Failed to load book')\n\t\t\tthis.loading = false\n\t\t}\n\t},\n\tbeforeUnmount() {\n\t\tif (this.rendition) {\n\t\t\tthis.rendition.destroy()\n\t\t}\n\t\tif (this.book) {\n\t\t\tthis.book.destroy()\n\t\t}\n\t},\n\tmethods: {\n\t\tt,\n\t},\n}\n<\/script>\n\n<style scoped>\n.epub-viewer {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n}\n.epub-viewer__area {\n\twidth: 100%;\n\theight: 100%;\n\tbackground: var(--color-main-background, #fff);\n}\n.epub-viewer__loading,\n.epub-viewer__error {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n}\n.epub-viewer__error {\n\tcolor: var(--color-error, #c00);\n}\n</style>\n"],sourceRoot:""}]);const s=o},4717(t,e,n){n.d(e,{A:()=>s});var r=n(1354),a=n.n(r),i=n(6314),o=n.n(i)()(a());o.push([t.id,"\n.pdf-viewer[data-v-0f2e5dd0] {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: var(--ereader-surface);\n}\n.pdf-viewer__toolbar[data-v-0f2e5dd0] {\n\tflex-shrink: 0;\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\talign-items: center;\n\tgap: 0.5rem 1rem;\n\tpadding: 0.5rem 0.75rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n.pdf-viewer__toolbar-group[data-v-0f2e5dd0] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 0.25rem;\n}\n.pdf-viewer__toolbar-group--page[data-v-0f2e5dd0] {\n\tmargin-left: auto;\n}\n.pdf-viewer__btn[data-v-0f2e5dd0] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\tmin-width: 36px;\n\theight: 36px;\n\tpadding: 0 0.5rem;\n\tborder: none;\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: transparent;\n\tcolor: inherit;\n\tcursor: pointer;\n\ttransition: background 0.15s;\n}\n.pdf-viewer__btn[data-v-0f2e5dd0]:hover:not(:disabled) {\n\tbackground: rgba(255, 255, 255, 0.2);\n}\n.pdf-viewer__btn[data-v-0f2e5dd0]:disabled {\n\topacity: 0.5;\n\tcursor: not-allowed;\n}\n.pdf-viewer__btn--text[data-v-0f2e5dd0] {\n\tfont-size: 0.875rem;\n}\n.pdf-viewer__icon[data-v-0f2e5dd0] {\n\twidth: 24px;\n\theight: 24px;\n}\n.pdf-viewer__scale[data-v-0f2e5dd0] {\n\tmin-width: 3.5em;\n\tfont-size: 0.875rem;\n\ttext-align: center;\n}\n.pdf-viewer__page-indicator[data-v-0f2e5dd0] {\n\tfont-size: 0.875rem;\n\twhite-space: nowrap;\n}\n.pdf-viewer__scroll[data-v-0f2e5dd0] {\n\tflex: 1;\n\tmin-height: 0;\n\toverflow: auto;\n\tscroll-behavior: smooth;\n}\n.pdf-viewer__container[data-v-0f2e5dd0] {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tpadding: 1rem 0;\n\tgap: 1rem;\n}\n.pdf-viewer__page-wrap[data-v-0f2e5dd0] {\n\tdisplay: block;\n}\n.pdf-viewer__page[data-v-0f2e5dd0] {\n\tdisplay: block;\n\tmax-width: 100%;\n\theight: auto;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n.pdf-viewer__loading[data-v-0f2e5dd0],\n.pdf-viewer__error[data-v-0f2e5dd0] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n\tbackground: var(--ereader-surface);\n}\n.pdf-viewer__error[data-v-0f2e5dd0] {\n\tcolor: var(--ereader-error);\n}\n","",{version:3,sources:["webpack://./src/components/PdfViewer.vue"],names:[],mappings:";AAiPA;CACC,kBAAkB;CAClB,WAAW;CACX,YAAY;CACZ,aAAa;CACb,sBAAsB;CACtB,kCAAkC;AACnC;AAEA;CACC,cAAc;CACd,aAAa;CACb,eAAe;CACf,mBAAmB;CACnB,gBAAgB;CAChB,uBAAuB;CACvB,qCAAqC;CACrC,kCAAkC;CAClC,8CAA8C;AAC/C;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,YAAY;AACb;AAEA;CACC,iBAAiB;AAClB;AAEA;CACC,oBAAoB;CACpB,mBAAmB;CACnB,uBAAuB;CACvB,eAAe;CACf,YAAY;CACZ,iBAAiB;CACjB,YAAY;CACZ,uCAAuC;CACvC,uBAAuB;CACvB,cAAc;CACd,eAAe;CACf,4BAA4B;AAC7B;AAEA;CACC,oCAAoC;AACrC;AAEA;CACC,YAAY;CACZ,mBAAmB;AACpB;AAEA;CACC,mBAAmB;AACpB;AAEA;CACC,WAAW;CACX,YAAY;AACb;AAEA;CACC,gBAAgB;CAChB,mBAAmB;CACnB,kBAAkB;AACnB;AAEA;CACC,mBAAmB;CACnB,mBAAmB;AACpB;AAEA;CACC,OAAO;CACP,aAAa;CACb,cAAc;CACd,uBAAuB;AACxB;AAEA;CACC,aAAa;CACb,sBAAsB;CACtB,mBAAmB;CACnB,eAAe;CACf,SAAS;AACV;AAEA;CACC,cAAc;AACf;AAEA;CACC,cAAc;CACd,eAAe;CACf,YAAY;CACZ,sCAAsC;AACvC;AAEA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;CAClB,oCAAoC;CACpC,kCAAkC;AACnC;AAEA;CACC,2BAA2B;AAC5B",sourcesContent:['<template>\n\t<div class="pdf-viewer">\n\t\t<header v-if="!loading && !error" class="pdf-viewer__toolbar">\n\t\t\t<div class="pdf-viewer__toolbar-group">\n\t\t\t\t<button\n\t\t\t\t\ttype="button"\n\t\t\t\t\tclass="pdf-viewer__btn"\n\t\t\t\t\t:title="t(\'ereader\', \'Zoom out\')"\n\t\t\t\t\t:disabled="scaleFactor <= minScale"\n\t\t\t\t\t@click="zoomOut"\n\t\t\t\t>\n\t\t\t\t\t<svg class="pdf-viewer__icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">\n\t\t\t\t\t\t<path d="M19 13H5v-2h14v2z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t\t<span class="pdf-viewer__scale">{{ scalePercent }}%</span>\n\t\t\t\t<button\n\t\t\t\t\ttype="button"\n\t\t\t\t\tclass="pdf-viewer__btn"\n\t\t\t\t\t:title="t(\'ereader\', \'Zoom in\')"\n\t\t\t\t\t:disabled="scaleFactor >= maxScale"\n\t\t\t\t\t@click="zoomIn"\n\t\t\t\t>\n\t\t\t\t\t<svg class="pdf-viewer__icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">\n\t\t\t\t\t\t<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\ttype="button"\n\t\t\t\tclass="pdf-viewer__btn pdf-viewer__btn--text"\n\t\t\t\t:title="t(\'ereader\', \'Fit to width\')"\n\t\t\t\t@click="fitWidth"\n\t\t\t>\n\t\t\t\t{{ t(\'ereader\', \'Fit width\') }}\n\t\t\t</button>\n\t\t\t<div class="pdf-viewer__toolbar-group pdf-viewer__toolbar-group--page">\n\t\t\t\t<button\n\t\t\t\t\ttype="button"\n\t\t\t\t\tclass="pdf-viewer__btn"\n\t\t\t\t\t:title="t(\'ereader\', \'Previous page\')"\n\t\t\t\t\t:disabled="currentPage <= 1"\n\t\t\t\t\t@click="goToPage(currentPage - 1)"\n\t\t\t\t>\n\t\t\t\t\t<svg class="pdf-viewer__icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">\n\t\t\t\t\t\t<path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t\t<span class="pdf-viewer__page-indicator">\n\t\t\t\t\t{{ t(\'ereader\', \'Page\') }} {{ currentPage }} / {{ numPages }}\n\t\t\t\t</span>\n\t\t\t\t<button\n\t\t\t\t\ttype="button"\n\t\t\t\t\tclass="pdf-viewer__btn"\n\t\t\t\t\t:title="t(\'ereader\', \'Next page\')"\n\t\t\t\t\t:disabled="currentPage >= numPages"\n\t\t\t\t\t@click="goToPage(currentPage + 1)"\n\t\t\t\t>\n\t\t\t\t\t<svg class="pdf-viewer__icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">\n\t\t\t\t\t\t<path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</header>\n\t\t<div ref="scrollEl" class="pdf-viewer__scroll" @scroll="onScroll">\n\t\t\t<div ref="containerEl" class="pdf-viewer__container">\n\t\t\t\t<div\n\t\t\t\t\tv-for="pageNum in numPages"\n\t\t\t\t\t:key="pageNum"\n\t\t\t\t\t:ref="(el) => setPageWrapRef(el, pageNum)"\n\t\t\t\t\tclass="pdf-viewer__page-wrap"\n\t\t\t\t\t:data-page="pageNum"\n\t\t\t\t>\n\t\t\t\t\t<canvas\n\t\t\t\t\t\t:ref="(el) => setCanvasRef(el, pageNum)"\n\t\t\t\t\t\tclass="pdf-viewer__page"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if="loading" class="pdf-viewer__loading">{{ t(\'ereader\', \'Loading…\') }}</div>\n\t\t<div v-else-if="error" class="pdf-viewer__error">{{ error }}</div>\n\t</div>\n</template>\n\n<script>\nimport { markRaw } from \'vue\'\nimport { translate as t } from \'@nextcloud/l10n\'\nimport { generateUrl } from \'@nextcloud/router\'\nimport * as pdfjsLib from \'pdfjs-dist\'\n\nif (typeof window !== \'undefined\' && !pdfjsLib.GlobalWorkerOptions.workerSrc) {\n\tpdfjsLib.GlobalWorkerOptions.workerSrc = generateUrl(\'/apps/ereader/js/pdf.worker.js\')\n}\n\nconst MIN_SCALE = 0.5\nconst MAX_SCALE = 3\nconst ZOOM_STEP = 0.25\n\nexport default {\n\tname: \'PdfViewer\',\n\tprops: {\n\t\tblob: {\n\t\t\ttype: Blob,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tloading: true,\n\t\t\terror: \'\',\n\t\t\tnumPages: 0,\n\t\t\tpdfDoc: null,\n\t\t\tcanvasRefs: {},\n\t\t\tpageWrapRefs: {},\n\t\t\tscaleFactor: 1,\n\t\t\tcurrentPage: 1,\n\t\t\tminScale: MIN_SCALE,\n\t\t\tmaxScale: MAX_SCALE,\n\t\t\tpixelRatio: typeof window !== \'undefined\' ? Math.min(window.devicePixelRatio || 1, 2) : 1,\n\t\t}\n\t},\n\tcomputed: {\n\t\tscalePercent() {\n\t\t\treturn Math.round(this.scaleFactor * 100)\n\t\t},\n\t},\n\tasync mounted() {\n\t\tawait this.loadPdf()\n\t},\n\tbeforeUnmount() {\n\t\tthis.canvasRefs = {}\n\t\tthis.pageWrapRefs = {}\n\t\tif (this.$refs.scrollEl) {\n\t\t\tthis.$refs.scrollEl.removeEventListener(\'scroll\', this.onScroll)\n\t\t}\n\t\tif (this.pdfDoc && typeof this.pdfDoc.destroy === \'function\') {\n\t\t\ttry {\n\t\t\t\tthis.pdfDoc.destroy()\n\t\t\t} catch (_) {}\n\t\t\tthis.pdfDoc = null\n\t\t}\n\t},\n\tmethods: {\n\t\tt,\n\t\tsetCanvasRef(el, pageNum) {\n\t\t\tif (el) this.canvasRefs[pageNum] = el\n\t\t},\n\t\tsetPageWrapRef(el, pageNum) {\n\t\t\tif (el) this.pageWrapRefs[pageNum] = el\n\t\t},\n\t\tzoomIn() {\n\t\t\tthis.scaleFactor = Math.min(this.maxScale, this.scaleFactor + ZOOM_STEP)\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t\tzoomOut() {\n\t\t\tthis.scaleFactor = Math.max(this.minScale, this.scaleFactor - ZOOM_STEP)\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t\tfitWidth() {\n\t\t\tthis.scaleFactor = 1\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t\tgoToPage(pageNum) {\n\t\t\tconst n = Math.max(1, Math.min(this.numPages, pageNum))\n\t\t\tconst el = this.pageWrapRefs[n]\n\t\t\tif (el && this.$refs.scrollEl) {\n\t\t\t\tel.scrollIntoView({ behavior: \'smooth\', block: \'start\' })\n\t\t\t}\n\t\t\tthis.currentPage = n\n\t\t},\n\t\tonScroll() {\n\t\t\tconst scrollEl = this.$refs.scrollEl\n\t\t\tif (!scrollEl || this.numPages === 0) return\n\t\t\tconst scrollTop = scrollEl.scrollTop\n\t\t\tconst viewportMid = scrollTop + scrollEl.clientHeight / 2\n\t\t\tlet page = 1\n\t\t\tfor (let n = 1; n <= this.numPages; n++) {\n\t\t\t\tconst wrap = this.pageWrapRefs[n]\n\t\t\t\tif (!wrap) continue\n\t\t\t\tconst top = wrap.offsetTop\n\t\t\t\tconst bottom = top + wrap.offsetHeight\n\t\t\t\tif (viewportMid >= top && viewportMid <= bottom) {\n\t\t\t\t\tpage = n\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tif (viewportMid < bottom) {\n\t\t\t\t\tpage = n\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tpage = n\n\t\t\t}\n\t\t\tthis.currentPage = page\n\t\t},\n\t\tasync loadPdf() {\n\t\t\tthis.loading = true\n\t\t\tthis.error = \'\'\n\t\t\ttry {\n\t\t\t\tconst data = await this.blob.arrayBuffer()\n\t\t\t\tconst doc = await pdfjsLib.getDocument({ data }).promise\n\t\t\t\tthis.pdfDoc = markRaw(doc)\n\t\t\t\tthis.numPages = this.pdfDoc.numPages\n\t\t\t\tthis.loading = false\n\t\t\t\tawait this.$nextTick()\n\t\t\t\tawait this.$nextTick()\n\t\t\t\tawait this.renderAllPages()\n\t\t\t\tif (this.$refs.scrollEl) {\n\t\t\t\t\tthis.$refs.scrollEl.addEventListener(\'scroll\', this.onScroll, { passive: true })\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthis.error = e.message || t(\'ereader\', \'Failed to load PDF\')\n\t\t\t\tthis.loading = false\n\t\t\t}\n\t\t},\n\t\tasync renderAllPages() {\n\t\t\tif (!this.pdfDoc || !this.$refs.containerEl) return\n\t\t\tconst container = this.$refs.containerEl\n\t\t\tconst baseWidth = container.clientWidth || 800\n\t\t\tfor (let n = 1; n <= this.numPages; n++) {\n\t\t\t\tconst canvas = this.canvasRefs[n]\n\t\t\t\tif (!canvas) continue\n\t\t\t\tconst page = await this.pdfDoc.getPage(n)\n\t\t\t\tconst baseScale = baseWidth / page.getViewport({ scale: 1 }).width\n\t\t\t\tconst effectiveScale = baseScale * this.scaleFactor * this.pixelRatio\n\t\t\t\tconst viewport = page.getViewport({ scale: effectiveScale })\n\t\t\t\tcanvas.width = viewport.width\n\t\t\t\tcanvas.height = viewport.height\n\t\t\t\tcanvas.style.width = (viewport.width / this.pixelRatio) + \'px\'\n\t\t\t\tcanvas.style.height = (viewport.height / this.pixelRatio) + \'px\'\n\t\t\t\tconst ctx = canvas.getContext(\'2d\')\n\t\t\t\tawait page.render({\n\t\t\t\t\tcanvasContext: ctx,\n\t\t\t\t\tviewport,\n\t\t\t\t}).promise\n\t\t\t}\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.pdf-viewer {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: var(--ereader-surface);\n}\n\n.pdf-viewer__toolbar {\n\tflex-shrink: 0;\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\talign-items: center;\n\tgap: 0.5rem 1rem;\n\tpadding: 0.5rem 0.75rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n\n.pdf-viewer__toolbar-group {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 0.25rem;\n}\n\n.pdf-viewer__toolbar-group--page {\n\tmargin-left: auto;\n}\n\n.pdf-viewer__btn {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\tmin-width: 36px;\n\theight: 36px;\n\tpadding: 0 0.5rem;\n\tborder: none;\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: transparent;\n\tcolor: inherit;\n\tcursor: pointer;\n\ttransition: background 0.15s;\n}\n\n.pdf-viewer__btn:hover:not(:disabled) {\n\tbackground: rgba(255, 255, 255, 0.2);\n}\n\n.pdf-viewer__btn:disabled {\n\topacity: 0.5;\n\tcursor: not-allowed;\n}\n\n.pdf-viewer__btn--text {\n\tfont-size: 0.875rem;\n}\n\n.pdf-viewer__icon {\n\twidth: 24px;\n\theight: 24px;\n}\n\n.pdf-viewer__scale {\n\tmin-width: 3.5em;\n\tfont-size: 0.875rem;\n\ttext-align: center;\n}\n\n.pdf-viewer__page-indicator {\n\tfont-size: 0.875rem;\n\twhite-space: nowrap;\n}\n\n.pdf-viewer__scroll {\n\tflex: 1;\n\tmin-height: 0;\n\toverflow: auto;\n\tscroll-behavior: smooth;\n}\n\n.pdf-viewer__container {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tpadding: 1rem 0;\n\tgap: 1rem;\n}\n\n.pdf-viewer__page-wrap {\n\tdisplay: block;\n}\n\n.pdf-viewer__page {\n\tdisplay: block;\n\tmax-width: 100%;\n\theight: auto;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n\n.pdf-viewer__loading,\n.pdf-viewer__error {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n\tbackground: var(--ereader-surface);\n}\n\n.pdf-viewer__error {\n\tcolor: var(--ereader-error);\n}\n</style>\n'],sourceRoot:""}]);const s=o},5337(t,e,n){n.d(e,{A:()=>s});var r=n(1354),a=n.n(r),i=n(6314),o=n.n(i)()(a());o.push([t.id,"\n.ereader-read[data-v-7465632c] {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tmin-height: 0;\n\twidth: 100%;\n\tmax-width: 100vw;\n\tbox-sizing: border-box;\n\toverflow: hidden;\n}\n.ereader-read__header[data-v-7465632c] {\n\tflex-shrink: 0;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n.ereader-read__back[data-v-7465632c] {\n\tcolor: inherit;\n\ttext-decoration: none;\n\tfont-weight: 500;\n}\n.ereader-read__back[data-v-7465632c]:hover {\n\ttext-decoration: underline;\n}\n.ereader-read__area[data-v-7465632c] {\n\tflex: 1;\n\tposition: relative;\n\tmin-height: 0;\n\twidth: 100%;\n\toverflow: hidden;\n}\n.ereader-read__error[data-v-7465632c],\n.ereader-read__loading[data-v-7465632c] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n}\n.ereader-read__error[data-v-7465632c] {\n\tcolor: var(--ereader-error);\n}\n","",{version:3,sources:["webpack://./src/views/Read.vue"],names:[],mappings:";AAgFA;CACC,aAAa;CACb,sBAAsB;CACtB,YAAY;CACZ,aAAa;CACb,WAAW;CACX,gBAAgB;CAChB,sBAAsB;CACtB,gBAAgB;AACjB;AACA;CACC,cAAc;CACd,oBAAoB;CACpB,qCAAqC;CACrC,kCAAkC;CAClC,8CAA8C;AAC/C;AACA;CACC,cAAc;CACd,qBAAqB;CACrB,gBAAgB;AACjB;AACA;CACC,0BAA0B;AAC3B;AACA;CACC,OAAO;CACP,kBAAkB;CAClB,aAAa;CACb,WAAW;CACX,gBAAgB;AACjB;AACA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;CAClB,oCAAoC;AACrC;AACA;CACC,2BAA2B;AAC5B",sourcesContent:["<template>\n\t<div class=\"ereader-read\">\n\t\t<header v-if=\"!isMobile\" class=\"ereader-read__header\">\n\t\t\t<router-link :to=\"{ name: 'Library' }\" class=\"ereader-read__back\">{{ t('ereader', 'Back to library') }}</router-link>\n\t\t</header>\n\t\t<div class=\"ereader-read__area\">\n\t\t\t<div v-if=\"error\" class=\"ereader-read__error\">{{ error }}</div>\n\t\t\t<div v-else-if=\"!isEpub && loadingPdf\" class=\"ereader-read__loading\">{{ t('ereader', 'Loading…') }}</div>\n\t\t\t<EpubViewer v-else-if=\"isEpub\" :url=\"streamUrl\" />\n\t\t\t<PdfViewer v-else-if=\"pdfBlob\" :blob=\"pdfBlob\" />\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { getStreamUrl, getStreamBlob } from '../router/api'\nimport { translate as t } from '@nextcloud/l10n'\nimport EpubViewer from '../components/EpubViewer.vue'\nimport PdfViewer from '../components/PdfViewer.vue'\n\nconst MIME_EPUB = 'application/epub+zip'\nconst MOBILE_BREAKPOINT = 768\n\nexport default {\n\tname: 'Read',\n\tcomponents: { EpubViewer, PdfViewer },\n\tprops: {\n\t\tfileId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\terror: '',\n\t\t\tloadingPdf: false,\n\t\t\tpdfBlob: null,\n\t\t\twindowWidth: typeof window !== 'undefined' ? window.innerWidth : 1024,\n\t\t}\n\t},\n\tcomputed: {\n\t\tstreamUrl() {\n\t\t\treturn getStreamUrl(Number(this.fileId))\n\t\t},\n\t\tisEpub() {\n\t\t\treturn this.$route.query?.mime === MIME_EPUB\n\t\t},\n\t\tisMobile() {\n\t\t\treturn this.windowWidth <= MOBILE_BREAKPOINT\n\t\t},\n\t},\n\tasync mounted() {\n\t\twindow.addEventListener('resize', this.onResize)\n\t\tif (this.isEpub) return\n\t\tthis.loadingPdf = true\n\t\tthis.error = ''\n\t\ttry {\n\t\t\tthis.pdfBlob = await getStreamBlob(Number(this.fileId))\n\t\t} catch (e) {\n\t\t\tthis.error = e.response?.status === 403\n\t\t\t\t? t('ereader', 'Access denied. Please refresh the page and try again.')\n\t\t\t\t: (e.message || t('ereader', 'Failed to load the file.'))\n\t\t} finally {\n\t\t\tthis.loadingPdf = false\n\t\t}\n\t},\n\tbeforeUnmount() {\n\t\twindow.removeEventListener('resize', this.onResize)\n\t\tthis.pdfBlob = null\n\t},\n\tmethods: {\n\t\tt,\n\t\tonResize() {\n\t\t\tthis.windowWidth = window.innerWidth\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.ereader-read {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tmin-height: 0;\n\twidth: 100%;\n\tmax-width: 100vw;\n\tbox-sizing: border-box;\n\toverflow: hidden;\n}\n.ereader-read__header {\n\tflex-shrink: 0;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n.ereader-read__back {\n\tcolor: inherit;\n\ttext-decoration: none;\n\tfont-weight: 500;\n}\n.ereader-read__back:hover {\n\ttext-decoration: underline;\n}\n.ereader-read__area {\n\tflex: 1;\n\tposition: relative;\n\tmin-height: 0;\n\twidth: 100%;\n\toverflow: hidden;\n}\n.ereader-read__error,\n.ereader-read__loading {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n}\n.ereader-read__error {\n\tcolor: var(--ereader-error);\n}\n</style>\n"],sourceRoot:""}]);const s=o}}]);
//# sourceMappingURL=ereader-src_views_Read_vue.js.map?v=f9d847d83318af57b2ee