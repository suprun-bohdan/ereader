"use strict";(self.webpackChunkereader=self.webpackChunkereader||[]).push([["src_views_Read_vue"],{2037(t,e,n){n.r(e),n.d(e,{default:()=>ht});var r=n(641),i=n(33);const a={class:"ereader-read"},o={key:0,class:"ereader-read__header"},s={class:"ereader-read__area"},l={key:0,class:"ereader-read__toast"},d={key:1,class:"ereader-read__error"},c={key:2,class:"ereader-read__loading"};var p=n(249),A=n(3334);const h={ref:"viewerEl",class:"epub-viewer__area"},f={key:0,class:"epub-viewer__loading"},u={key:1,class:"epub-viewer__error"};const g={name:"SelectionToolbar",props:{visible:{type:Boolean,default:!1},position:{type:Object,default:()=>({top:0,left:0})}},emits:["add"],computed:{toolbarStyle(){const{top:t,left:e}=this.position;return{top:`${t}px`,left:`${e}px`}}},methods:{t:A.Tl,onAdd(){this.$emit("add")}}};var C=n(5072),b=n.n(C),v=n(7825),m=n.n(v),w=n(7659),_=n.n(w),x=n(5056),B=n.n(x),y=n(540),P=n.n(y),k=n(1113),E=n.n(k),S=n(7042),T={};T.styleTagTransform=E(),T.setAttributes=B(),T.insert=_().bind(null,"head"),T.domAPI=m(),T.insertStyleElement=P();b()(S.A,T);S.A&&S.A.locals&&S.A.locals;var L=n(6262);const V=(0,L.A)(g,[["render",function(t,e,n,a,o,s){return(0,r.uX)(),(0,r.Wv)(r.Im,{to:"body"},[n.visible?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"selection-toolbar",style:(0,i.Tr)(s.toolbarStyle),role:"toolbar"},[(0,r.Lk)("button",{type:"button",class:"selection-toolbar__btn",onClick:e[0]||(e[0]=(...t)=>s.onAdd&&s.onAdd(...t))},(0,i.v_)(s.t("ereader","Add to dictionary")),1)],4)):(0,r.Q3)("",!0)])}],["__scopeId","data-v-7caed96a"]]),W={name:"EpubViewer",components:{SelectionToolbar:V},props:{url:{type:String,required:!0}},emits:["add-to-dictionary"],data:()=>({loading:!0,error:"",rendition:null,book:null,toolbarVisible:!1,toolbarPosition:{top:0,left:0},selectedText:""}),async mounted(){try{const{default:t}=await n.e("vendors-node_modules_epubjs_src_index_js").then(n.bind(n,1684));this.book=t(this.url),await this.book.ready,this.rendition=this.book.renderTo(this.$refs.viewerEl,{width:"100%",height:"100%",spread:"none"}),await this.rendition.display(),this.loading=!1,this.$nextTick(()=>this.attachSelectionListener())}catch(t){this.error=t.message||this.t("ereader","Failed to load book"),this.loading=!1}},beforeUnmount(){this.detachSelectionListener(),this.rendition&&this.rendition.destroy(),this.book&&this.book.destroy()},methods:{t:A.Tl,attachSelectionListener(){const t=this.$refs.viewerEl?.querySelector("iframe"),e=t?t.contentDocument:document,n=t?t.contentWindow:window;e&&n&&(this._selectionDoc=e,this._selectionWin=n,e.addEventListener("mouseup",this.onSelectionMouseUp))},detachSelectionListener(){this._selectionDoc&&(this._selectionDoc.removeEventListener("mouseup",this.onSelectionMouseUp),this._selectionDoc=null),this._selectionWin=null},onMouseUp(){this.updateToolbarFromSelection(document,window)},onSelectionMouseUp(){this._selectionWin&&this.updateToolbarFromSelection(this._selectionDoc,this._selectionWin)},updateToolbarFromSelection(t,e){const n=e.getSelection(),r=(n&&n.toString?n.toString():"").trim();if(this.selectedText=r,!r)return void(this.toolbarVisible=!1);let i=0,a=0;try{const e=n.getRangeAt(0).getBoundingClientRect(),r=this.$refs.viewerEl?.querySelector("iframe");if(r&&t!==document){const t=r.getBoundingClientRect();i=t.top+e.top+e.height/2,a=t.left+e.left+e.width/2}else i=e.top+e.height/2,a=e.left+e.width/2}catch(t){}this.toolbarPosition={top:i,left:a},this.toolbarVisible=!0},onAddToDictionary(){this.selectedText&&(this.$emit("add-to-dictionary",this.selectedText),this.toolbarVisible=!1,this.selectedText="",this._selectionWin&&this._selectionWin.getSelection()&&this._selectionWin.getSelection().removeAllRanges())}}};var R=n(7711),M={};M.styleTagTransform=E(),M.setAttributes=B(),M.insert=_().bind(null,"head"),M.domAPI=m(),M.insertStyleElement=P();b()(R.A,M);R.A&&R.A.locals&&R.A.locals;const I=(0,L.A)(W,[["render",function(t,e,n,a,o,s){const l=(0,r.g2)("SelectionToolbar");return(0,r.uX)(),(0,r.CE)("div",{class:"epub-viewer",onMouseup:e[0]||(e[0]=(...t)=>s.onMouseUp&&s.onMouseUp(...t))},[(0,r.Lk)("div",h,null,512),(0,r.bF)(l,{visible:o.toolbarVisible,position:o.toolbarPosition,onAdd:s.onAddToDictionary},null,8,["visible","position","onAdd"]),o.loading?((0,r.uX)(),(0,r.CE)("div",f,(0,i.v_)(s.t("ereader","Loading…")),1)):o.error?((0,r.uX)(),(0,r.CE)("div",u,(0,i.v_)(o.error),1)):(0,r.Q3)("",!0)],32)}],["__scopeId","data-v-01c9fc31"]]);var z=n(3751);const F={class:"pdf-viewer"},$={key:0,class:"pdf-viewer__toolbar"},D={class:"pdf-viewer__toolbar-group"},O=["title","disabled"],j={class:"pdf-viewer__scale"},N=["title","disabled"],U=["title"],X=["title"],Y={class:"pdf-viewer__toolbar-group pdf-viewer__toolbar-group--pages"},q={class:"pdf-viewer__label",for:"pdf-pages-per-view"},H=["title","onClick"],Z=["max","title"],Q={class:"pdf-viewer__toolbar-group pdf-viewer__toolbar-group--page"},G=["title","disabled"],K={class:"pdf-viewer__page-indicator"},J=["title","disabled"],tt={ref:"containerEl",class:"pdf-viewer__container"},et=["data-page"],nt={key:1,class:"pdf-viewer__loading"},rt={key:2,class:"pdf-viewer__error"};var it=n(953),at=n(9498),ot=n(1100);"undefined"==typeof window||ot.EA.workerSrc||(ot.EA.workerSrc=(0,at.Jv)("/apps/ereader/js/pdf.worker.js"));const st={name:"PdfViewer",components:{SelectionToolbar:V},emits:["add-to-dictionary"],props:{blob:{type:Blob,required:!0}},data:()=>({loading:!0,error:"",numPages:0,pdfDoc:null,canvasRefs:{},pageWrapRefs:{},scaleFactor:1,currentPage:1,minScale:.5,maxScale:3,pixelRatio:"undefined"!=typeof window?Math.min(window.devicePixelRatio||1,2):1,fitPageScale:1,fitWidthScale:1,pagesPerView:1,pagesPerViewInput:"1",maxPagesPerView:6,toolbarVisible:!1,toolbarPosition:{top:0,left:0},selectedText:"",textLayerRefs:{},textLayers:{},resizeObserver:null}),computed:{scalePercent(){return Math.round(100*this.scaleFactor)}},watch:{pagesPerView(){this.$nextTick(async()=>{await this.computeFitPageScale(),await this.renderAllPages()})}},async mounted(){await this.loadPdf()},beforeUnmount(){if(this.canvasRefs={},this.pageWrapRefs={},this.textLayerRefs={},Object.values(this.textLayers).forEach(t=>{t&&t.cancel&&t.cancel()}),this.textLayers={},this.resizeObserver&&this.$refs.scrollEl&&(this.resizeObserver.unobserve(this.$refs.scrollEl),this.resizeObserver=null),this.$refs.scrollEl&&this.$refs.scrollEl.removeEventListener("scroll",this.onScroll),this.pdfDoc&&"function"==typeof this.pdfDoc.destroy){try{this.pdfDoc.destroy()}catch(t){}this.pdfDoc=null}},methods:{t:A.Tl,setCanvasRef(t,e){t&&(this.canvasRefs[e]=t)},setPageWrapRef(t,e){t&&(this.pageWrapRefs[e]=t)},setTextLayerRef(t,e){t&&(this.textLayerRefs[e]=t)},onMouseUp(){const t=window.getSelection(),e=(t&&t.toString?t.toString():"").trim();if(this.selectedText=e,e)try{const e=t.getRangeAt(0).getBoundingClientRect();this.toolbarPosition={top:e.top+e.height/2,left:e.left+e.width/2},this.toolbarVisible=!0}catch(t){this.toolbarVisible=!1}else this.toolbarVisible=!1},onAddToDictionary(){this.selectedText&&(this.$emit("add-to-dictionary",this.selectedText),this.toolbarVisible=!1,this.selectedText="",window.getSelection()&&window.getSelection().removeAllRanges())},setPagesPerView(t){const e=Math.min(6,Math.max(1,Number(t)));this.pagesPerViewInput=String(e),this.pagesPerView=e},onPagesPerViewInput(){this.applyPagesPerViewFromInput()},onPagesPerViewChange(){this.applyPagesPerViewFromInput()},applyPagesPerViewFromInput(){const t=parseInt(this.pagesPerViewInput,10);if(!Number.isFinite(t)||t<1)return void(this.pagesPerViewInput=String(this.pagesPerView));const e=Math.min(6,Math.max(1,t));this.pagesPerViewInput=String(e),this.pagesPerView=e},zoomIn(){this.scaleFactor=Math.min(this.maxScale,this.scaleFactor+.25),this.$nextTick(()=>this.renderAllPages())},zoomOut(){this.scaleFactor=Math.max(this.minScale,this.scaleFactor-.25),this.$nextTick(()=>this.renderAllPages())},fitWidth(){this.scaleFactor=this.fitWidthScale,this.$nextTick(()=>this.renderAllPages())},fitPage(){this.scaleFactor=this.fitPageScale,this.$nextTick(()=>this.renderAllPages())},goToPage(t){const e=Math.max(1,Math.min(this.numPages,t));this.currentPage=e,this.$nextTick(()=>{const t=this.pageWrapRefs[e];t&&this.$refs.scrollEl&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})},onScroll(){const t=this.$refs.scrollEl;if(!t||0===this.numPages)return;const e=t.scrollLeft+t.clientWidth/2;let n=1,r=1/0;for(let t=1;t<=this.numPages;t++){const i=this.pageWrapRefs[t];if(!i)continue;const a=i.offsetLeft+i.offsetWidth/2,o=Math.abs(e-a);o<r&&(r=o,n=t)}this.currentPage=n},async loadPdf(){this.loading=!0,this.error="";try{const t=await this.blob.arrayBuffer(),e=await ot.YE({data:t}).promise;this.pdfDoc=(0,it.IG)(e),this.numPages=this.pdfDoc.numPages,this.loading=!1,await this.$nextTick(),await this.$nextTick(),await this.computeFitPageScale(),this.scaleFactor=this.fitPageScale,await this.renderAllPages(),this.$refs.scrollEl&&(this.$refs.scrollEl.addEventListener("scroll",this.onScroll,{passive:!0}),this.resizeObserver=new ResizeObserver(()=>{this.$nextTick(()=>{this.computeFitPageScale(),this.renderAllPages()})}),this.resizeObserver.observe(this.$refs.scrollEl))}catch(t){this.error=t.message||(0,A.Tl)("ereader","Failed to load PDF"),this.loading=!1}},async computeFitPageScale(){if(!this.pdfDoc||!this.$refs.scrollEl)return;const t=this.$refs.scrollEl,e=Math.max(1,this.pagesPerView||1),n=(t.clientWidth||800)/e,r=t.clientHeight||600,i=(await this.pdfDoc.getPage(1)).getViewport({scale:1}),a=n/i.width,o=r/i.height,s=Math.min(a,o,this.maxScale);this.fitPageScale=s,this.fitWidthScale=Math.min(a,this.maxScale)},async renderAllPages(){if(!this.pdfDoc||!this.$refs.containerEl||!this.$refs.scrollEl)return;const t=this.$refs.scrollEl,e=Math.max(100,t.clientWidth||800),n=Math.max(100,t.clientHeight||600),r=e/Math.max(1,this.pagesPerView||1),i=n;for(let t=1;t<=this.numPages;t++){const e=this.canvasRefs[t];if(!e)continue;const n=await this.pdfDoc.getPage(t),i=n.getViewport({scale:1}),a=r/i.width,o=(i.height,a),s=o*this.scaleFactor*this.pixelRatio,l=n.getViewport({scale:s});e.width=l.width,e.height=l.height;const d=l.width/this.pixelRatio,c=l.height/this.pixelRatio;e.style.width=d+"px",e.style.height=c+"px";const p=e.getContext("2d");await n.render({canvasContext:p,viewport:l}).promise;const A=this.textLayerRefs[t];if(A&&ot.D6){this.textLayers[t]&&this.textLayers[t].cancel&&this.textLayers[t].cancel(),A.innerHTML="";const e=n.getViewport({scale:o*this.scaleFactor});A.style.cssText=["width:"+d+"px","height:"+c+"px","left:0","top:0","padding:0","margin:0","box-sizing:border-box"].join(";");const r=await n.getTextContent(),i=new ot.D6({textContentSource:r,container:A,viewport:e});this.textLayers[t]=i,await i.render()}}}}};var lt=n(4802),dt={};dt.styleTagTransform=E(),dt.setAttributes=B(),dt.insert=_().bind(null,"head"),dt.domAPI=m(),dt.insertStyleElement=P();b()(lt.A,dt);lt.A&&lt.A.locals&&lt.A.locals;const ct={name:"Read",components:{EpubViewer:I,PdfViewer:(0,L.A)(st,[["render",function(t,e,n,a,o,s){const l=(0,r.g2)("SelectionToolbar");return(0,r.uX)(),(0,r.CE)("div",F,[o.loading||o.error?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("header",$,[(0,r.Lk)("div",D,[(0,r.Lk)("button",{type:"button",class:"pdf-viewer__btn",title:s.t("ereader","Zoom out"),disabled:o.scaleFactor<=o.minScale,onClick:e[0]||(e[0]=(...t)=>s.zoomOut&&s.zoomOut(...t))},[...e[11]||(e[11]=[(0,r.Lk)("svg",{class:"pdf-viewer__icon",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[(0,r.Lk)("path",{d:"M19 13H5v-2h14v2z"})],-1)])],8,O),(0,r.Lk)("span",j,(0,i.v_)(s.scalePercent)+"%",1),(0,r.Lk)("button",{type:"button",class:"pdf-viewer__btn",title:s.t("ereader","Zoom in"),disabled:o.scaleFactor>=o.maxScale,onClick:e[1]||(e[1]=(...t)=>s.zoomIn&&s.zoomIn(...t))},[...e[12]||(e[12]=[(0,r.Lk)("svg",{class:"pdf-viewer__icon",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[(0,r.Lk)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1)])],8,N)]),(0,r.Lk)("button",{type:"button",class:"pdf-viewer__btn pdf-viewer__btn--text",title:s.t("ereader","Fit to width"),onClick:e[2]||(e[2]=(...t)=>s.fitWidth&&s.fitWidth(...t))},(0,i.v_)(s.t("ereader","Fit width")),9,U),(0,r.Lk)("button",{type:"button",class:"pdf-viewer__btn pdf-viewer__btn--text",title:s.t("ereader","Fit page"),onClick:e[3]||(e[3]=(...t)=>s.fitPage&&s.fitPage(...t))},(0,i.v_)(s.t("ereader","Fit page")),9,X),(0,r.Lk)("div",Y,[(0,r.Lk)("label",q,(0,i.v_)(s.t("ereader","Pages on screen")),1),((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)([1,2,3],t=>(0,r.Lk)("button",{key:t,type:"button",class:(0,i.C4)(["pdf-viewer__btn pdf-viewer__btn--pages",{"pdf-viewer__btn--pages-active":o.pagesPerView===t}]),title:s.t("ereader","Show {n} page(s)",{n:t}),onClick:e=>s.setPagesPerView(t)},(0,i.v_)(t),11,H)),64)),(0,r.bo)((0,r.Lk)("input",{id:"pdf-pages-per-view","onUpdate:modelValue":e[4]||(e[4]=t=>o.pagesPerViewInput=t),type:"number",min:"1",max:o.maxPagesPerView,class:"pdf-viewer__pages-input",title:s.t("ereader","Number of pages visible at once (1–6)"),onInput:e[5]||(e[5]=(...t)=>s.onPagesPerViewInput&&s.onPagesPerViewInput(...t)),onChange:e[6]||(e[6]=(...t)=>s.onPagesPerViewChange&&s.onPagesPerViewChange(...t))},null,40,Z),[[z.Jo,o.pagesPerViewInput]])]),(0,r.Lk)("div",Q,[(0,r.Lk)("button",{type:"button",class:"pdf-viewer__btn",title:s.t("ereader","Previous page"),disabled:o.currentPage<=1,onClick:e[7]||(e[7]=t=>s.goToPage(o.currentPage-1))},[...e[13]||(e[13]=[(0,r.Lk)("svg",{class:"pdf-viewer__icon",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[(0,r.Lk)("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1)])],8,G),(0,r.Lk)("span",K,(0,i.v_)(s.t("ereader","Page"))+" "+(0,i.v_)(o.currentPage)+" / "+(0,i.v_)(o.numPages),1),(0,r.Lk)("button",{type:"button",class:"pdf-viewer__btn",title:s.t("ereader","Next page"),disabled:o.currentPage>=o.numPages,onClick:e[8]||(e[8]=t=>s.goToPage(o.currentPage+1))},[...e[14]||(e[14]=[(0,r.Lk)("svg",{class:"pdf-viewer__icon",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[(0,r.Lk)("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})],-1)])],8,J)])])),(0,r.Lk)("div",{ref:"scrollEl",class:"pdf-viewer__scroll",onScroll:e[9]||(e[9]=(...t)=>s.onScroll&&s.onScroll(...t)),onMouseup:e[10]||(e[10]=(...t)=>s.onMouseUp&&s.onMouseUp(...t))},[(0,r.Lk)("div",tt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.numPages,t=>((0,r.uX)(),(0,r.CE)("div",{key:t,ref_for:!0,ref:e=>s.setPageWrapRef(e,t),class:"pdf-viewer__page-wrap","data-page":t},[(0,r.Lk)("canvas",{ref_for:!0,ref:e=>s.setCanvasRef(e,t),class:"pdf-viewer__page"},null,512),(0,r.Lk)("div",{ref_for:!0,ref:e=>s.setTextLayerRef(e,t),class:"pdf-viewer__text-layer","aria-hidden":"true"},null,512)],8,et))),128))],512)],544),(0,r.bF)(l,{visible:o.toolbarVisible,position:o.toolbarPosition,onAdd:s.onAddToDictionary},null,8,["visible","position","onAdd"]),o.loading?((0,r.uX)(),(0,r.CE)("div",nt,(0,i.v_)(s.t("ereader","Loading…")),1)):o.error?((0,r.uX)(),(0,r.CE)("div",rt,(0,i.v_)(o.error),1)):(0,r.Q3)("",!0)])}],["__scopeId","data-v-f5b516f4"]])},props:{fileId:{type:[String,Number],required:!0}},data:()=>({error:"",loadingPdf:!1,pdfBlob:null,windowWidth:"undefined"!=typeof window?window.innerWidth:1024,dictMessage:""}),computed:{streamUrl(){return(0,p.Wq)(Number(this.fileId))},isEpub(){return"application/epub+zip"===this.$route.query?.mime},isMobile(){return this.windowWidth<=768}},async mounted(){if(window.addEventListener("resize",this.onResize),!this.isEpub){this.loadingPdf=!0,this.error="";try{this.pdfBlob=await(0,p.O0)(Number(this.fileId))}catch(t){this.error=403===t.response?.status?(0,A.Tl)("ereader","Access denied. Please refresh the page and try again."):t.message||(0,A.Tl)("ereader","Failed to load the file.")}finally{this.loadingPdf=!1}}},beforeUnmount(){window.removeEventListener("resize",this.onResize),this.pdfBlob=null},methods:{t:A.Tl,onResize(){this.windowWidth=window.innerWidth}}};var pt=n(8909),At={};At.styleTagTransform=E(),At.setAttributes=B(),At.insert=_().bind(null,"head"),At.domAPI=m(),At.insertStyleElement=P();b()(pt.A,At);pt.A&&pt.A.locals&&pt.A.locals;const ht=(0,L.A)(ct,[["render",function(t,e,n,p,A,h){const f=(0,r.g2)("router-link"),u=(0,r.g2)("EpubViewer"),g=(0,r.g2)("PdfViewer");return(0,r.uX)(),(0,r.CE)("div",a,[h.isMobile?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("header",o,[(0,r.bF)(f,{to:{name:"Library"},class:"ereader-read__back"},{default:(0,r.k6)(()=>[(0,r.eW)((0,i.v_)(h.t("ereader","Back to library")),1)]),_:1})])),(0,r.Lk)("div",s,[A.dictMessage?((0,r.uX)(),(0,r.CE)("div",l,(0,i.v_)(A.dictMessage),1)):(0,r.Q3)("",!0),A.error?((0,r.uX)(),(0,r.CE)("div",d,(0,i.v_)(A.error),1)):!h.isEpub&&A.loadingPdf?((0,r.uX)(),(0,r.CE)("div",c,(0,i.v_)(h.t("ereader","Loading…")),1)):h.isEpub?((0,r.uX)(),(0,r.Wv)(u,{key:3,url:h.streamUrl,onAddToDictionary:t.onAddToDictionary},null,8,["url","onAddToDictionary"])):A.pdfBlob?((0,r.uX)(),(0,r.Wv)(g,{key:4,blob:A.pdfBlob,onAddToDictionary:t.onAddToDictionary},null,8,["blob","onAddToDictionary"])):(0,r.Q3)("",!0)])])}],["__scopeId","data-v-33b668b8"]])},4802(t,e,n){n.d(e,{A:()=>s});var r=n(1354),i=n.n(r),a=n(6314),o=n.n(a)()(i());o.push([t.id,"\n.pdf-viewer[data-v-f5b516f4] {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: var(--ereader-surface);\n}\n.pdf-viewer__toolbar[data-v-f5b516f4] {\n\tflex-shrink: 0;\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\talign-items: center;\n\tgap: 0.5rem 1rem;\n\tpadding: 0.5rem 0.75rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n.pdf-viewer__toolbar-group[data-v-f5b516f4] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 0.25rem;\n}\n.pdf-viewer__toolbar-group--page[data-v-f5b516f4] {\n\tmargin-left: auto;\n\tflex-shrink: 0;\n}\n.pdf-viewer__btn[data-v-f5b516f4] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\tmin-width: 36px;\n\theight: 36px;\n\tpadding: 0 0.5rem;\n\tborder: none;\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: transparent;\n\tcolor: inherit;\n\tcursor: pointer;\n\ttransition: background 0.15s;\n}\n.pdf-viewer__btn[data-v-f5b516f4]:hover:not(:disabled) {\n\tbackground: rgba(255, 255, 255, 0.2);\n}\n.pdf-viewer__btn[data-v-f5b516f4]:disabled {\n\topacity: 0.5;\n\tcursor: not-allowed;\n}\n.pdf-viewer__btn--text[data-v-f5b516f4] {\n\tfont-size: 0.875rem;\n}\n.pdf-viewer__toolbar-group--pages[data-v-f5b516f4] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 0.25rem;\n}\n.pdf-viewer__btn--pages[data-v-f5b516f4] {\n\tmin-width: 32px;\n\tfont-size: 0.875rem;\n\tfont-weight: 500;\n}\n.pdf-viewer__btn--pages-active[data-v-f5b516f4] {\n\tbackground: rgba(255, 255, 255, 0.3);\n}\n.pdf-viewer__icon[data-v-f5b516f4] {\n\twidth: 24px;\n\theight: 24px;\n}\n.pdf-viewer__scale[data-v-f5b516f4] {\n\tmin-width: 3.5em;\n\tfont-size: 0.875rem;\n\ttext-align: center;\n}\n.pdf-viewer__label[data-v-f5b516f4] {\n\tfont-size: 0.875rem;\n\twhite-space: nowrap;\n\tcolor: var(--ereader-primary-text);\n}\n.pdf-viewer__pages-input[data-v-f5b516f4] {\n\twidth: 2.5rem;\n\tpadding: 0.25rem 0.35rem;\n\tfont-size: 0.875rem;\n\ttext-align: center;\n\tborder: 1px solid var(--ereader-border);\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: var(--ereader-surface);\n\tcolor: var(--ereader-primary-text);\n}\n.pdf-viewer__pages-input[data-v-f5b516f4]:focus {\n\toutline: none;\n\tborder-color: var(--ereader-primary, #1976d2);\n}\n.pdf-viewer__page-indicator[data-v-f5b516f4] {\n\tfont-size: 0.875rem;\n\twhite-space: nowrap;\n}\n.pdf-viewer__scroll[data-v-f5b516f4] {\n\tflex: 1;\n\tmin-height: 0;\n\toverflow-x: auto;\n\toverflow-y: auto;\n\tscroll-behavior: smooth;\n\tscroll-snap-type: x mandatory;\n}\n.pdf-viewer__container[data-v-f5b516f4] {\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-wrap: nowrap;\n\talign-items: flex-start;\n\tjustify-content: flex-start;\n\tpadding: 1rem;\n\tgap: 1rem;\n\tmin-height: min-content;\n}\n.pdf-viewer__page-wrap[data-v-f5b516f4] {\n\tposition: relative;\n\tflex: 0 0 auto;\n\tscroll-snap-align: center;\n\tscroll-snap-stop: always;\n}\n.pdf-viewer__text-layer[data-v-f5b516f4] {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\toverflow: hidden;\n\tline-height: 1;\n\tuser-select: text;\n\tpointer-events: auto;\n}\n.pdf-viewer__text-layer span[data-v-f5b516f4] {\n\tcolor: transparent;\n\tposition: absolute;\n\twhite-space: pre;\n\ttransform-origin: 0 0;\n\tpointer-events: auto;\n}\n.pdf-viewer__page[data-v-f5b516f4] {\n\tdisplay: block;\n\tmax-width: 100%;\n\theight: auto;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n.pdf-viewer__loading[data-v-f5b516f4],\n.pdf-viewer__error[data-v-f5b516f4] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n\tbackground: var(--ereader-surface);\n}\n.pdf-viewer__error[data-v-f5b516f4] {\n\tcolor: var(--ereader-error);\n}\n","",{version:3,sources:["webpack://./src/components/PdfViewer.vue"],names:[],mappings:";AA+aA;CACC,kBAAkB;CAClB,WAAW;CACX,YAAY;CACZ,aAAa;CACb,sBAAsB;CACtB,kCAAkC;AACnC;AAEA;CACC,cAAc;CACd,aAAa;CACb,eAAe;CACf,mBAAmB;CACnB,gBAAgB;CAChB,uBAAuB;CACvB,qCAAqC;CACrC,kCAAkC;CAClC,8CAA8C;AAC/C;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,YAAY;AACb;AAEA;CACC,iBAAiB;CACjB,cAAc;AACf;AAEA;CACC,oBAAoB;CACpB,mBAAmB;CACnB,uBAAuB;CACvB,eAAe;CACf,YAAY;CACZ,iBAAiB;CACjB,YAAY;CACZ,uCAAuC;CACvC,uBAAuB;CACvB,cAAc;CACd,eAAe;CACf,4BAA4B;AAC7B;AAEA;CACC,oCAAoC;AACrC;AAEA;CACC,YAAY;CACZ,mBAAmB;AACpB;AAEA;CACC,mBAAmB;AACpB;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,YAAY;AACb;AAEA;CACC,eAAe;CACf,mBAAmB;CACnB,gBAAgB;AACjB;AAEA;CACC,oCAAoC;AACrC;AAEA;CACC,WAAW;CACX,YAAY;AACb;AAEA;CACC,gBAAgB;CAChB,mBAAmB;CACnB,kBAAkB;AACnB;AAEA;CACC,mBAAmB;CACnB,mBAAmB;CACnB,kCAAkC;AACnC;AAEA;CACC,aAAa;CACb,wBAAwB;CACxB,mBAAmB;CACnB,kBAAkB;CAClB,uCAAuC;CACvC,uCAAuC;CACvC,kCAAkC;CAClC,kCAAkC;AACnC;AAEA;CACC,aAAa;CACb,6CAA6C;AAC9C;AAEA;CACC,mBAAmB;CACnB,mBAAmB;AACpB;AAEA;CACC,OAAO;CACP,aAAa;CACb,gBAAgB;CAChB,gBAAgB;CAChB,uBAAuB;CACvB,6BAA6B;AAC9B;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,iBAAiB;CACjB,uBAAuB;CACvB,2BAA2B;CAC3B,aAAa;CACb,SAAS;CACT,uBAAuB;AACxB;AAEA;CACC,kBAAkB;CAClB,cAAc;CACd,yBAAyB;CACzB,wBAAwB;AACzB;AAEA;CACC,kBAAkB;CAClB,MAAM;CACN,OAAO;CACP,gBAAgB;CAChB,cAAc;CACd,iBAAiB;CACjB,oBAAoB;AACrB;AAEA;CACC,kBAAkB;CAClB,kBAAkB;CAClB,gBAAgB;CAChB,qBAAqB;CACrB,oBAAoB;AACrB;AAEA;CACC,cAAc;CACd,eAAe;CACf,YAAY;CACZ,sCAAsC;AACvC;AAEA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;CAClB,oCAAoC;CACpC,kCAAkC;AACnC;AAEA;CACC,2BAA2B;AAC5B",sourcesContent:['<template>\n\t<div class="pdf-viewer">\n\t\t<header v-if="!loading && !error" class="pdf-viewer__toolbar">\n\t\t\t<div class="pdf-viewer__toolbar-group">\n\t\t\t\t<button\n\t\t\t\t\ttype="button"\n\t\t\t\t\tclass="pdf-viewer__btn"\n\t\t\t\t\t:title="t(\'ereader\', \'Zoom out\')"\n\t\t\t\t\t:disabled="scaleFactor <= minScale"\n\t\t\t\t\t@click="zoomOut"\n\t\t\t\t>\n\t\t\t\t\t<svg class="pdf-viewer__icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">\n\t\t\t\t\t\t<path d="M19 13H5v-2h14v2z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t\t<span class="pdf-viewer__scale">{{ scalePercent }}%</span>\n\t\t\t\t<button\n\t\t\t\t\ttype="button"\n\t\t\t\t\tclass="pdf-viewer__btn"\n\t\t\t\t\t:title="t(\'ereader\', \'Zoom in\')"\n\t\t\t\t\t:disabled="scaleFactor >= maxScale"\n\t\t\t\t\t@click="zoomIn"\n\t\t\t\t>\n\t\t\t\t\t<svg class="pdf-viewer__icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">\n\t\t\t\t\t\t<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\ttype="button"\n\t\t\t\tclass="pdf-viewer__btn pdf-viewer__btn--text"\n\t\t\t\t:title="t(\'ereader\', \'Fit to width\')"\n\t\t\t\t@click="fitWidth"\n\t\t\t>\n\t\t\t\t{{ t(\'ereader\', \'Fit width\') }}\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\ttype="button"\n\t\t\t\tclass="pdf-viewer__btn pdf-viewer__btn--text"\n\t\t\t\t:title="t(\'ereader\', \'Fit page\')"\n\t\t\t\t@click="fitPage"\n\t\t\t>\n\t\t\t\t{{ t(\'ereader\', \'Fit page\') }}\n\t\t\t</button>\n\t\t\t<div class="pdf-viewer__toolbar-group pdf-viewer__toolbar-group--pages">\n\t\t\t\t<label class="pdf-viewer__label" for="pdf-pages-per-view">\n\t\t\t\t\t{{ t(\'ereader\', \'Pages on screen\') }}\n\t\t\t\t</label>\n\t\t\t\t<button\n\t\t\t\t\tv-for="n in [1, 2, 3]"\n\t\t\t\t\t:key="n"\n\t\t\t\t\ttype="button"\n\t\t\t\t\tclass="pdf-viewer__btn pdf-viewer__btn--pages"\n\t\t\t\t\t:class="{ \'pdf-viewer__btn--pages-active\': pagesPerView === n }"\n\t\t\t\t\t:title="t(\'ereader\', \'Show {n} page(s)\', { n })"\n\t\t\t\t\t@click="setPagesPerView(n)"\n\t\t\t\t>\n\t\t\t\t\t{{ n }}\n\t\t\t\t</button>\n\t\t\t\t<input\n\t\t\t\t\tid="pdf-pages-per-view"\n\t\t\t\t\tv-model="pagesPerViewInput"\n\t\t\t\t\ttype="number"\n\t\t\t\t\tmin="1"\n\t\t\t\t\t:max="maxPagesPerView"\n\t\t\t\t\tclass="pdf-viewer__pages-input"\n\t\t\t\t\t:title="t(\'ereader\', \'Number of pages visible at once (1–6)\')"\n\t\t\t\t\t@input="onPagesPerViewInput"\n\t\t\t\t\t@change="onPagesPerViewChange"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="pdf-viewer__toolbar-group pdf-viewer__toolbar-group--page">\n\t\t\t\t<button\n\t\t\t\t\ttype="button"\n\t\t\t\t\tclass="pdf-viewer__btn"\n\t\t\t\t\t:title="t(\'ereader\', \'Previous page\')"\n\t\t\t\t\t:disabled="currentPage <= 1"\n\t\t\t\t\t@click="goToPage(currentPage - 1)"\n\t\t\t\t>\n\t\t\t\t\t<svg class="pdf-viewer__icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">\n\t\t\t\t\t\t<path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t\t<span class="pdf-viewer__page-indicator">\n\t\t\t\t\t{{ t(\'ereader\', \'Page\') }} {{ currentPage }} / {{ numPages }}\n\t\t\t\t</span>\n\t\t\t\t<button\n\t\t\t\t\ttype="button"\n\t\t\t\t\tclass="pdf-viewer__btn"\n\t\t\t\t\t:title="t(\'ereader\', \'Next page\')"\n\t\t\t\t\t:disabled="currentPage >= numPages"\n\t\t\t\t\t@click="goToPage(currentPage + 1)"\n\t\t\t\t>\n\t\t\t\t\t<svg class="pdf-viewer__icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">\n\t\t\t\t\t\t<path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</header>\n\t\t<div ref="scrollEl" class="pdf-viewer__scroll" @scroll="onScroll" @mouseup="onMouseUp">\n\t\t\t<div ref="containerEl" class="pdf-viewer__container">\n\t\t\t\t<div\n\t\t\t\t\tv-for="pageNum in numPages"\n\t\t\t\t\t:key="pageNum"\n\t\t\t\t\t:ref="(el) => setPageWrapRef(el, pageNum)"\n\t\t\t\t\tclass="pdf-viewer__page-wrap"\n\t\t\t\t\t:data-page="pageNum"\n\t\t\t\t>\n\t\t\t\t\t<canvas\n\t\t\t\t\t\t:ref="(el) => setCanvasRef(el, pageNum)"\n\t\t\t\t\t\tclass="pdf-viewer__page"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:ref="(el) => setTextLayerRef(el, pageNum)"\n\t\t\t\t\t\tclass="pdf-viewer__text-layer"\n\t\t\t\t\t\taria-hidden="true"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<SelectionToolbar\n\t\t\t:visible="toolbarVisible"\n\t\t\t:position="toolbarPosition"\n\t\t\t@add="onAddToDictionary"\n\t\t/>\n\t\t<div v-if="loading" class="pdf-viewer__loading">{{ t(\'ereader\', \'Loading…\') }}</div>\n\t\t<div v-else-if="error" class="pdf-viewer__error">{{ error }}</div>\n\t</div>\n</template>\n\n<script>\nimport { markRaw } from \'vue\'\nimport { translate as t } from \'@nextcloud/l10n\'\nimport { generateUrl } from \'@nextcloud/router\'\nimport * as pdfjsLib from \'pdfjs-dist\'\n\nif (typeof window !== \'undefined\' && !pdfjsLib.GlobalWorkerOptions.workerSrc) {\n\tpdfjsLib.GlobalWorkerOptions.workerSrc = generateUrl(\'/apps/ereader/js/pdf.worker.js\')\n}\n\nconst MIN_SCALE = 0.5\nconst MAX_SCALE = 3\nconst ZOOM_STEP = 0.25\nconst MIN_PAGES_PER_VIEW = 1\nconst MAX_PAGES_PER_VIEW = 6\n\nimport SelectionToolbar from \'./SelectionToolbar.vue\'\n\nexport default {\n\tname: \'PdfViewer\',\n\tcomponents: { SelectionToolbar },\n\temits: [\'add-to-dictionary\'],\n\tprops: {\n\t\tblob: {\n\t\t\ttype: Blob,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tloading: true,\n\t\t\terror: \'\',\n\t\t\tnumPages: 0,\n\t\t\tpdfDoc: null,\n\t\t\tcanvasRefs: {},\n\t\t\tpageWrapRefs: {},\n\t\t\tscaleFactor: 1,\n\t\t\tcurrentPage: 1,\n\t\t\tminScale: MIN_SCALE,\n\t\t\tmaxScale: MAX_SCALE,\n\t\t\tpixelRatio: typeof window !== \'undefined\' ? Math.min(window.devicePixelRatio || 1, 2) : 1,\n\t\t\tfitPageScale: 1,\n\t\t\tfitWidthScale: 1,\n\t\t\tpagesPerView: 1,\n\t\t\tpagesPerViewInput: \'1\',\n\t\t\tmaxPagesPerView: MAX_PAGES_PER_VIEW,\n\t\t\ttoolbarVisible: false,\n\t\t\ttoolbarPosition: { top: 0, left: 0 },\n\t\t\tselectedText: \'\',\n\t\t\ttextLayerRefs: {},\n\t\t\ttextLayers: {},\n\t\t\tresizeObserver: null,\n\t\t}\n\t},\n\tcomputed: {\n\t\tscalePercent() {\n\t\t\treturn Math.round(this.scaleFactor * 100)\n\t\t},\n\t},\n\twatch: {\n\t\tpagesPerView() {\n\t\t\tthis.$nextTick(async () => {\n\t\t\t\tawait this.computeFitPageScale()\n\t\t\t\tawait this.renderAllPages()\n\t\t\t})\n\t\t},\n\t},\n\tasync mounted() {\n\t\tawait this.loadPdf()\n\t},\n\tbeforeUnmount() {\n\t\tthis.canvasRefs = {}\n\t\tthis.pageWrapRefs = {}\n\t\tthis.textLayerRefs = {}\n\t\tObject.values(this.textLayers).forEach((tl) => { if (tl && tl.cancel) tl.cancel() })\n\t\tthis.textLayers = {}\n\t\tif (this.resizeObserver && this.$refs.scrollEl) {\n\t\t\tthis.resizeObserver.unobserve(this.$refs.scrollEl)\n\t\t\tthis.resizeObserver = null\n\t\t}\n\t\tif (this.$refs.scrollEl) {\n\t\t\tthis.$refs.scrollEl.removeEventListener(\'scroll\', this.onScroll)\n\t\t}\n\t\tif (this.pdfDoc && typeof this.pdfDoc.destroy === \'function\') {\n\t\t\ttry {\n\t\t\t\tthis.pdfDoc.destroy()\n\t\t\t} catch (_) {}\n\t\t\tthis.pdfDoc = null\n\t\t}\n\t},\n\tmethods: {\n\t\tt,\n\t\tsetCanvasRef(el, pageNum) {\n\t\t\tif (el) this.canvasRefs[pageNum] = el\n\t\t},\n\t\tsetPageWrapRef(el, pageNum) {\n\t\t\tif (el) this.pageWrapRefs[pageNum] = el\n\t\t},\n\t\tsetTextLayerRef(el, pageNum) {\n\t\t\tif (el) this.textLayerRefs[pageNum] = el\n\t\t},\n\t\tonMouseUp() {\n\t\t\tconst sel = window.getSelection()\n\t\t\tconst text = (sel && sel.toString ? sel.toString() : \'\').trim()\n\t\t\tthis.selectedText = text\n\t\t\tif (!text) {\n\t\t\t\tthis.toolbarVisible = false\n\t\t\t\treturn\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst range = sel.getRangeAt(0)\n\t\t\t\tconst rect = range.getBoundingClientRect()\n\t\t\t\tthis.toolbarPosition = {\n\t\t\t\t\ttop: rect.top + rect.height / 2,\n\t\t\t\t\tleft: rect.left + rect.width / 2,\n\t\t\t\t}\n\t\t\t\tthis.toolbarVisible = true\n\t\t\t} catch (_) {\n\t\t\t\tthis.toolbarVisible = false\n\t\t\t}\n\t\t},\n\t\tonAddToDictionary() {\n\t\t\tif (this.selectedText) {\n\t\t\t\tthis.$emit(\'add-to-dictionary\', this.selectedText)\n\t\t\t\tthis.toolbarVisible = false\n\t\t\t\tthis.selectedText = \'\'\n\t\t\t\tif (window.getSelection()) window.getSelection().removeAllRanges()\n\t\t\t}\n\t\t},\n\t\tsetPagesPerView(n) {\n\t\t\tconst clamped = Math.min(MAX_PAGES_PER_VIEW, Math.max(MIN_PAGES_PER_VIEW, Number(n)))\n\t\t\tthis.pagesPerViewInput = String(clamped)\n\t\t\tthis.pagesPerView = clamped\n\t\t},\n\t\tonPagesPerViewInput() {\n\t\t\tthis.applyPagesPerViewFromInput()\n\t\t},\n\t\tonPagesPerViewChange() {\n\t\t\tthis.applyPagesPerViewFromInput()\n\t\t},\n\t\tapplyPagesPerViewFromInput() {\n\t\t\tconst v = parseInt(this.pagesPerViewInput, 10)\n\t\t\tif (!Number.isFinite(v) || v < MIN_PAGES_PER_VIEW) {\n\t\t\t\tthis.pagesPerViewInput = String(this.pagesPerView)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconst clamped = Math.min(MAX_PAGES_PER_VIEW, Math.max(MIN_PAGES_PER_VIEW, v))\n\t\t\tthis.pagesPerViewInput = String(clamped)\n\t\t\tthis.pagesPerView = clamped\n\t\t},\n\t\tzoomIn() {\n\t\t\tthis.scaleFactor = Math.min(this.maxScale, this.scaleFactor + ZOOM_STEP)\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t\tzoomOut() {\n\t\t\tthis.scaleFactor = Math.max(this.minScale, this.scaleFactor - ZOOM_STEP)\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t\tfitWidth() {\n\t\t\tthis.scaleFactor = this.fitWidthScale\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t\tfitPage() {\n\t\t\tthis.scaleFactor = this.fitPageScale\n\t\t\tthis.$nextTick(() => this.renderAllPages())\n\t\t},\n\t\tgoToPage(pageNum) {\n\t\t\tconst n = Math.max(1, Math.min(this.numPages, pageNum))\n\t\t\tthis.currentPage = n\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tconst el = this.pageWrapRefs[n]\n\t\t\t\tif (el && this.$refs.scrollEl) {\n\t\t\t\t\tel.scrollIntoView({ behavior: \'smooth\', block: \'center\', inline: \'center\' })\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tonScroll() {\n\t\t\tconst scrollEl = this.$refs.scrollEl\n\t\t\tif (!scrollEl || this.numPages === 0) return\n\t\t\tconst scrollLeft = scrollEl.scrollLeft\n\t\t\tconst viewportCenter = scrollLeft + scrollEl.clientWidth / 2\n\t\t\tlet page = 1\n\t\t\tlet bestDist = Infinity\n\t\t\tfor (let n = 1; n <= this.numPages; n++) {\n\t\t\t\tconst wrap = this.pageWrapRefs[n]\n\t\t\t\tif (!wrap) continue\n\t\t\t\tconst wrapCenter = wrap.offsetLeft + wrap.offsetWidth / 2\n\t\t\t\tconst dist = Math.abs(viewportCenter - wrapCenter)\n\t\t\t\tif (dist < bestDist) {\n\t\t\t\t\tbestDist = dist\n\t\t\t\t\tpage = n\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.currentPage = page\n\t\t},\n\t\tasync loadPdf() {\n\t\t\tthis.loading = true\n\t\t\tthis.error = \'\'\n\t\t\ttry {\n\t\t\t\tconst data = await this.blob.arrayBuffer()\n\t\t\t\tconst doc = await pdfjsLib.getDocument({ data }).promise\n\t\t\t\tthis.pdfDoc = markRaw(doc)\n\t\t\t\tthis.numPages = this.pdfDoc.numPages\n\t\t\t\tthis.loading = false\n\t\t\t\tawait this.$nextTick()\n\t\t\t\tawait this.$nextTick()\n\t\t\t\tawait this.computeFitPageScale()\n\t\t\t\tthis.scaleFactor = this.fitPageScale\n\t\t\t\tawait this.renderAllPages()\n\t\t\t\tif (this.$refs.scrollEl) {\n\t\t\t\t\tthis.$refs.scrollEl.addEventListener(\'scroll\', this.onScroll, { passive: true })\n\t\t\t\t\tthis.resizeObserver = new ResizeObserver(() => {\n\t\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t\tthis.computeFitPageScale()\n\t\t\t\t\t\t\tthis.renderAllPages()\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t\tthis.resizeObserver.observe(this.$refs.scrollEl)\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthis.error = e.message || t(\'ereader\', \'Failed to load PDF\')\n\t\t\t\tthis.loading = false\n\t\t\t}\n\t\t},\n\t\tasync computeFitPageScale() {\n\t\t\tif (!this.pdfDoc || !this.$refs.scrollEl) return\n\t\t\tconst scrollEl = this.$refs.scrollEl\n\t\t\tconst perPage = Math.max(1, this.pagesPerView || 1)\n\t\t\tconst w = (scrollEl.clientWidth || 800) / perPage\n\t\t\tconst h = scrollEl.clientHeight || 600\n\t\t\tconst firstPage = await this.pdfDoc.getPage(1)\n\t\t\tconst vp = firstPage.getViewport({ scale: 1 })\n\t\t\tconst scaleW = w / vp.width\n\t\t\tconst scaleH = h / vp.height\n\t\t\tconst fitBoth = Math.min(scaleW, scaleH, this.maxScale)\n\t\t\tthis.fitPageScale = fitBoth\n\t\t\tthis.fitWidthScale = Math.min(scaleW, this.maxScale)\n\t\t},\n\t\tasync renderAllPages() {\n\t\t\tif (!this.pdfDoc || !this.$refs.containerEl || !this.$refs.scrollEl) return\n\t\t\tconst scrollEl = this.$refs.scrollEl\n\t\t\tconst viewWidth = Math.max(100, scrollEl.clientWidth || 800)\n\t\t\tconst viewHeight = Math.max(100, scrollEl.clientHeight || 600)\n\t\t\tconst perPage = Math.max(1, this.pagesPerView || 1)\n\t\t\tconst baseWidth = viewWidth / perPage\n\t\t\tconst baseHeight = viewHeight\n\t\t\tfor (let n = 1; n <= this.numPages; n++) {\n\t\t\t\tconst canvas = this.canvasRefs[n]\n\t\t\t\tif (!canvas) continue\n\t\t\t\tconst page = await this.pdfDoc.getPage(n)\n\t\t\t\tconst vp1 = page.getViewport({ scale: 1 })\n\t\t\t\tconst scaleByWidth = baseWidth / vp1.width\n\t\t\t\tconst scaleByHeight = baseHeight / vp1.height\n\t\t\t\t// Use scaleByWidth so each page takes exactly baseWidth (one slot = one page when pagesPerView=1)\n\t\t\t\tconst baseScale = scaleByWidth\n\t\t\t\tconst effectiveScale = baseScale * this.scaleFactor * this.pixelRatio\n\t\t\t\tconst viewport = page.getViewport({ scale: effectiveScale })\n\t\t\t\tcanvas.width = viewport.width\n\t\t\t\tcanvas.height = viewport.height\n\t\t\t\tconst displayW = viewport.width / this.pixelRatio\n\t\t\t\tconst displayH = viewport.height / this.pixelRatio\n\t\t\t\tcanvas.style.width = displayW + \'px\'\n\t\t\t\tcanvas.style.height = displayH + \'px\'\n\t\t\t\tconst ctx = canvas.getContext(\'2d\')\n\t\t\t\tawait page.render({\n\t\t\t\t\tcanvasContext: ctx,\n\t\t\t\t\tviewport,\n\t\t\t\t}).promise\n\t\t\t\tconst textLayerEl = this.textLayerRefs[n]\n\t\t\t\tif (textLayerEl && pdfjsLib.TextLayer) {\n\t\t\t\t\tif (this.textLayers[n] && this.textLayers[n].cancel) {\n\t\t\t\t\t\tthis.textLayers[n].cancel()\n\t\t\t\t\t}\n\t\t\t\t\ttextLayerEl.innerHTML = \'\'\n\t\t\t\t\t// Use exact same dimensions as canvas display (so text aligns with canvas)\n\t\t\t\t\tconst displayViewport = page.getViewport({ scale: baseScale * this.scaleFactor })\n\t\t\t\t\ttextLayerEl.style.cssText = [\n\t\t\t\t\t\t\'width:\' + displayW + \'px\',\n\t\t\t\t\t\t\'height:\' + displayH + \'px\',\n\t\t\t\t\t\t\'left:0\',\n\t\t\t\t\t\t\'top:0\',\n\t\t\t\t\t\t\'padding:0\',\n\t\t\t\t\t\t\'margin:0\',\n\t\t\t\t\t\t\'box-sizing:border-box\',\n\t\t\t\t\t].join(\';\')\n\t\t\t\t\tconst textContent = await page.getTextContent()\n\t\t\t\t\tconst textLayer = new pdfjsLib.TextLayer({\n\t\t\t\t\t\ttextContentSource: textContent,\n\t\t\t\t\t\tcontainer: textLayerEl,\n\t\t\t\t\t\tviewport: displayViewport,\n\t\t\t\t\t})\n\t\t\t\t\tthis.textLayers[n] = textLayer\n\t\t\t\t\tawait textLayer.render()\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.pdf-viewer {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: var(--ereader-surface);\n}\n\n.pdf-viewer__toolbar {\n\tflex-shrink: 0;\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\talign-items: center;\n\tgap: 0.5rem 1rem;\n\tpadding: 0.5rem 0.75rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n\n.pdf-viewer__toolbar-group {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 0.25rem;\n}\n\n.pdf-viewer__toolbar-group--page {\n\tmargin-left: auto;\n\tflex-shrink: 0;\n}\n\n.pdf-viewer__btn {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\tmin-width: 36px;\n\theight: 36px;\n\tpadding: 0 0.5rem;\n\tborder: none;\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: transparent;\n\tcolor: inherit;\n\tcursor: pointer;\n\ttransition: background 0.15s;\n}\n\n.pdf-viewer__btn:hover:not(:disabled) {\n\tbackground: rgba(255, 255, 255, 0.2);\n}\n\n.pdf-viewer__btn:disabled {\n\topacity: 0.5;\n\tcursor: not-allowed;\n}\n\n.pdf-viewer__btn--text {\n\tfont-size: 0.875rem;\n}\n\n.pdf-viewer__toolbar-group--pages {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 0.25rem;\n}\n\n.pdf-viewer__btn--pages {\n\tmin-width: 32px;\n\tfont-size: 0.875rem;\n\tfont-weight: 500;\n}\n\n.pdf-viewer__btn--pages-active {\n\tbackground: rgba(255, 255, 255, 0.3);\n}\n\n.pdf-viewer__icon {\n\twidth: 24px;\n\theight: 24px;\n}\n\n.pdf-viewer__scale {\n\tmin-width: 3.5em;\n\tfont-size: 0.875rem;\n\ttext-align: center;\n}\n\n.pdf-viewer__label {\n\tfont-size: 0.875rem;\n\twhite-space: nowrap;\n\tcolor: var(--ereader-primary-text);\n}\n\n.pdf-viewer__pages-input {\n\twidth: 2.5rem;\n\tpadding: 0.25rem 0.35rem;\n\tfont-size: 0.875rem;\n\ttext-align: center;\n\tborder: 1px solid var(--ereader-border);\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: var(--ereader-surface);\n\tcolor: var(--ereader-primary-text);\n}\n\n.pdf-viewer__pages-input:focus {\n\toutline: none;\n\tborder-color: var(--ereader-primary, #1976d2);\n}\n\n.pdf-viewer__page-indicator {\n\tfont-size: 0.875rem;\n\twhite-space: nowrap;\n}\n\n.pdf-viewer__scroll {\n\tflex: 1;\n\tmin-height: 0;\n\toverflow-x: auto;\n\toverflow-y: auto;\n\tscroll-behavior: smooth;\n\tscroll-snap-type: x mandatory;\n}\n\n.pdf-viewer__container {\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-wrap: nowrap;\n\talign-items: flex-start;\n\tjustify-content: flex-start;\n\tpadding: 1rem;\n\tgap: 1rem;\n\tmin-height: min-content;\n}\n\n.pdf-viewer__page-wrap {\n\tposition: relative;\n\tflex: 0 0 auto;\n\tscroll-snap-align: center;\n\tscroll-snap-stop: always;\n}\n\n.pdf-viewer__text-layer {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\toverflow: hidden;\n\tline-height: 1;\n\tuser-select: text;\n\tpointer-events: auto;\n}\n\n.pdf-viewer__text-layer span {\n\tcolor: transparent;\n\tposition: absolute;\n\twhite-space: pre;\n\ttransform-origin: 0 0;\n\tpointer-events: auto;\n}\n\n.pdf-viewer__page {\n\tdisplay: block;\n\tmax-width: 100%;\n\theight: auto;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n\n.pdf-viewer__loading,\n.pdf-viewer__error {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n\tbackground: var(--ereader-surface);\n}\n\n.pdf-viewer__error {\n\tcolor: var(--ereader-error);\n}\n</style>\n'],sourceRoot:""}]);const s=o},7042(t,e,n){n.d(e,{A:()=>s});var r=n(1354),i=n.n(r),a=n(6314),o=n.n(a)()(i());o.push([t.id,"\n.selection-toolbar[data-v-7caed96a] {\n\tposition: fixed;\n\tz-index: 1000;\n\ttransform: translate(-50%, -100%);\n\tmargin-top: -8px;\n\tpadding: 4px 8px;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-radius: var(--ereader-radius-sm);\n\tbox-shadow: var(--ereader-card-shadow);\n}\n.selection-toolbar__btn[data-v-7caed96a] {\n\tpadding: 0.35rem 0.75rem;\n\tfont-size: 0.875rem;\n\tborder: none;\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: rgba(255, 255, 255, 0.2);\n\tcolor: inherit;\n\tcursor: pointer;\n}\n.selection-toolbar__btn[data-v-7caed96a]:hover {\n\tbackground: rgba(255, 255, 255, 0.3);\n}\n","",{version:3,sources:["webpack://./src/components/SelectionToolbar.vue"],names:[],mappings:";AAmDA;CACC,eAAe;CACf,aAAa;CACb,iCAAiC;CACjC,gBAAgB;CAChB,gBAAgB;CAChB,qCAAqC;CACrC,kCAAkC;CAClC,uCAAuC;CACvC,sCAAsC;AACvC;AAEA;CACC,wBAAwB;CACxB,mBAAmB;CACnB,YAAY;CACZ,uCAAuC;CACvC,oCAAoC;CACpC,cAAc;CACd,eAAe;AAChB;AAEA;CACC,oCAAoC;AACrC",sourcesContent:['<template>\n\t<Teleport to="body">\n\t\t<div\n\t\t\tv-if="visible"\n\t\t\tclass="selection-toolbar"\n\t\t\t:style="toolbarStyle"\n\t\t\trole="toolbar"\n\t\t>\n\t\t\t<button\n\t\t\t\ttype="button"\n\t\t\t\tclass="selection-toolbar__btn"\n\t\t\t\t@click="onAdd"\n\t\t\t>\n\t\t\t\t{{ t(\'ereader\', \'Add to dictionary\') }}\n\t\t\t</button>\n\t\t</div>\n\t</Teleport>\n</template>\n\n<script>\nimport { translate as t } from \'@nextcloud/l10n\'\n\nexport default {\n\tname: \'SelectionToolbar\',\n\tprops: {\n\t\tvisible: { type: Boolean, default: false },\n\t\tposition: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({ top: 0, left: 0 }),\n\t\t},\n\t},\n\temits: [\'add\'],\n\tcomputed: {\n\t\ttoolbarStyle() {\n\t\t\tconst { top, left } = this.position\n\t\t\treturn {\n\t\t\t\ttop: `${top}px`,\n\t\t\t\tleft: `${left}px`,\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\tt,\n\t\tonAdd() {\n\t\t\tthis.$emit(\'add\')\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.selection-toolbar {\n\tposition: fixed;\n\tz-index: 1000;\n\ttransform: translate(-50%, -100%);\n\tmargin-top: -8px;\n\tpadding: 4px 8px;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-radius: var(--ereader-radius-sm);\n\tbox-shadow: var(--ereader-card-shadow);\n}\n\n.selection-toolbar__btn {\n\tpadding: 0.35rem 0.75rem;\n\tfont-size: 0.875rem;\n\tborder: none;\n\tborder-radius: var(--ereader-radius-sm);\n\tbackground: rgba(255, 255, 255, 0.2);\n\tcolor: inherit;\n\tcursor: pointer;\n}\n\n.selection-toolbar__btn:hover {\n\tbackground: rgba(255, 255, 255, 0.3);\n}\n</style>\n'],sourceRoot:""}]);const s=o},7711(t,e,n){n.d(e,{A:()=>s});var r=n(1354),i=n.n(r),a=n(6314),o=n.n(a)()(i());o.push([t.id,"\n.epub-viewer[data-v-01c9fc31] {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n}\n.epub-viewer__area[data-v-01c9fc31] {\n\twidth: 100%;\n\theight: 100%;\n\tbackground: var(--color-main-background, #fff);\n}\n.epub-viewer__loading[data-v-01c9fc31],\n.epub-viewer__error[data-v-01c9fc31] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n}\n.epub-viewer__error[data-v-01c9fc31] {\n\tcolor: var(--color-error, #c00);\n}\n","",{version:3,sources:["webpack://./src/components/EpubViewer.vue"],names:[],mappings:";AAiIA;CACC,kBAAkB;CAClB,WAAW;CACX,YAAY;AACb;AACA;CACC,WAAW;CACX,YAAY;CACZ,8CAA8C;AAC/C;AACA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;AACnB;AACA;CACC,+BAA+B;AAChC",sourcesContent:["<template>\n\t<div class=\"epub-viewer\" @mouseup=\"onMouseUp\">\n\t\t<div ref=\"viewerEl\" class=\"epub-viewer__area\"></div>\n\t\t<SelectionToolbar\n\t\t\t:visible=\"toolbarVisible\"\n\t\t\t:position=\"toolbarPosition\"\n\t\t\t@add=\"onAddToDictionary\"\n\t\t/>\n\t\t<div v-if=\"loading\" class=\"epub-viewer__loading\">{{ t('ereader', 'Loading…') }}</div>\n\t\t<div v-else-if=\"error\" class=\"epub-viewer__error\">{{ error }}</div>\n\t</div>\n</template>\n\n<script>\nimport { translate as t } from '@nextcloud/l10n'\nimport SelectionToolbar from './SelectionToolbar.vue'\n\nexport default {\n\tname: 'EpubViewer',\n\tcomponents: { SelectionToolbar },\n\tprops: {\n\t\turl: { type: String, required: true },\n\t},\n\temits: ['add-to-dictionary'],\n\tdata() {\n\t\treturn {\n\t\t\tloading: true,\n\t\t\terror: '',\n\t\t\trendition: null,\n\t\t\tbook: null,\n\t\t\ttoolbarVisible: false,\n\t\t\ttoolbarPosition: { top: 0, left: 0 },\n\t\t\tselectedText: '',\n\t\t}\n\t},\n\tasync mounted() {\n\t\ttry {\n\t\t\tconst { default: ePub } = await import('epubjs')\n\t\t\tthis.book = ePub(this.url)\n\t\t\tawait this.book.ready\n\t\t\tthis.rendition = this.book.renderTo(this.$refs.viewerEl, {\n\t\t\t\twidth: '100%',\n\t\t\t\theight: '100%',\n\t\t\t\tspread: 'none',\n\t\t\t})\n\t\t\tawait this.rendition.display()\n\t\t\tthis.loading = false\n\t\t\tthis.$nextTick(() => this.attachSelectionListener())\n\t\t} catch (e) {\n\t\t\tthis.error = e.message || this.t('ereader', 'Failed to load book')\n\t\t\tthis.loading = false\n\t\t}\n\t},\n\tbeforeUnmount() {\n\t\tthis.detachSelectionListener()\n\t\tif (this.rendition) {\n\t\t\tthis.rendition.destroy()\n\t\t}\n\t\tif (this.book) {\n\t\t\tthis.book.destroy()\n\t\t}\n\t},\n\tmethods: {\n\t\tt,\n\t\tattachSelectionListener() {\n\t\t\tconst iframe = this.$refs.viewerEl?.querySelector('iframe')\n\t\t\tconst doc = iframe ? iframe.contentDocument : document\n\t\t\tconst win = iframe ? iframe.contentWindow : window\n\t\t\tif (!doc || !win) return\n\t\t\tthis._selectionDoc = doc\n\t\t\tthis._selectionWin = win\n\t\t\tdoc.addEventListener('mouseup', this.onSelectionMouseUp)\n\t\t},\n\t\tdetachSelectionListener() {\n\t\t\tif (this._selectionDoc) {\n\t\t\t\tthis._selectionDoc.removeEventListener('mouseup', this.onSelectionMouseUp)\n\t\t\t\tthis._selectionDoc = null\n\t\t\t}\n\t\t\tthis._selectionWin = null\n\t\t},\n\t\tonMouseUp() {\n\t\t\tthis.updateToolbarFromSelection(document, window)\n\t\t},\n\t\tonSelectionMouseUp() {\n\t\t\tif (this._selectionWin) {\n\t\t\t\tthis.updateToolbarFromSelection(this._selectionDoc, this._selectionWin)\n\t\t\t}\n\t\t},\n\t\tupdateToolbarFromSelection(doc, win) {\n\t\t\tconst sel = win.getSelection()\n\t\t\tconst text = (sel && sel.toString ? sel.toString() : '').trim()\n\t\t\tthis.selectedText = text\n\t\t\tif (!text) {\n\t\t\t\tthis.toolbarVisible = false\n\t\t\t\treturn\n\t\t\t}\n\t\t\tlet top = 0\n\t\t\tlet left = 0\n\t\t\ttry {\n\t\t\t\tconst range = sel.getRangeAt(0)\n\t\t\t\tconst rect = range.getBoundingClientRect()\n\t\t\t\tconst iframe = this.$refs.viewerEl?.querySelector('iframe')\n\t\t\t\tif (iframe && doc !== document) {\n\t\t\t\t\tconst iframeRect = iframe.getBoundingClientRect()\n\t\t\t\t\ttop = iframeRect.top + rect.top + rect.height / 2\n\t\t\t\t\tleft = iframeRect.left + rect.left + rect.width / 2\n\t\t\t\t} else {\n\t\t\t\t\ttop = rect.top + rect.height / 2\n\t\t\t\t\tleft = rect.left + rect.width / 2\n\t\t\t\t}\n\t\t\t} catch (_) {}\n\t\t\tthis.toolbarPosition = { top, left }\n\t\t\tthis.toolbarVisible = true\n\t\t},\n\t\tonAddToDictionary() {\n\t\t\tif (this.selectedText) {\n\t\t\t\tthis.$emit('add-to-dictionary', this.selectedText)\n\t\t\t\tthis.toolbarVisible = false\n\t\t\t\tthis.selectedText = ''\n\t\t\t\tif (this._selectionWin && this._selectionWin.getSelection()) {\n\t\t\t\t\tthis._selectionWin.getSelection().removeAllRanges()\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.epub-viewer {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n}\n.epub-viewer__area {\n\twidth: 100%;\n\theight: 100%;\n\tbackground: var(--color-main-background, #fff);\n}\n.epub-viewer__loading,\n.epub-viewer__error {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n}\n.epub-viewer__error {\n\tcolor: var(--color-error, #c00);\n}\n</style>\n"],sourceRoot:""}]);const s=o},8909(t,e,n){n.d(e,{A:()=>s});var r=n(1354),i=n.n(r),a=n(6314),o=n.n(a)()(i());o.push([t.id,"\n.ereader-read[data-v-33b668b8] {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tmin-height: 0;\n\twidth: 100%;\n\tmax-width: 100vw;\n\tbox-sizing: border-box;\n\toverflow: hidden;\n}\n.ereader-read__header[data-v-33b668b8] {\n\tflex-shrink: 0;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n.ereader-read__back[data-v-33b668b8] {\n\tcolor: inherit;\n\ttext-decoration: none;\n\tfont-weight: 500;\n}\n.ereader-read__back[data-v-33b668b8]:hover {\n\ttext-decoration: underline;\n}\n.ereader-read__area[data-v-33b668b8] {\n\tflex: 1;\n\tposition: relative;\n\tmin-height: 0;\n\twidth: 100%;\n\toverflow: hidden;\n}\n.ereader-read__error[data-v-33b668b8],\n.ereader-read__loading[data-v-33b668b8] {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n}\n.ereader-read__error[data-v-33b668b8] {\n\tcolor: var(--ereader-error);\n}\n.ereader-read__toast[data-v-33b668b8] {\n\tposition: absolute;\n\ttop: 1rem;\n\tleft: 50%;\n\ttransform: translateX(-50%);\n\tz-index: 50;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-primary);\n\tcolor: var(--ereader-primary-text);\n\tborder-radius: var(--ereader-radius-sm);\n\tfont-size: 0.9rem;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n","",{version:3,sources:["webpack://./src/views/Read.vue"],names:[],mappings:";AAkFA;CACC,aAAa;CACb,sBAAsB;CACtB,YAAY;CACZ,aAAa;CACb,WAAW;CACX,gBAAgB;CAChB,sBAAsB;CACtB,gBAAgB;AACjB;AACA;CACC,cAAc;CACd,oBAAoB;CACpB,qCAAqC;CACrC,kCAAkC;CAClC,8CAA8C;AAC/C;AACA;CACC,cAAc;CACd,qBAAqB;CACrB,gBAAgB;AACjB;AACA;CACC,0BAA0B;AAC3B;AACA;CACC,OAAO;CACP,kBAAkB;CAClB,aAAa;CACb,WAAW;CACX,gBAAgB;AACjB;AACA;;CAEC,kBAAkB;CAClB,QAAQ;CACR,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,aAAa;CACb,kBAAkB;CAClB,oCAAoC;AACrC;AACA;CACC,2BAA2B;AAC5B;AACA;CACC,kBAAkB;CAClB,SAAS;CACT,SAAS;CACT,2BAA2B;CAC3B,WAAW;CACX,oBAAoB;CACpB,kCAAkC;CAClC,kCAAkC;CAClC,uCAAuC;CACvC,iBAAiB;CACjB,sCAAsC;AACvC",sourcesContent:["<template>\n\t<div class=\"ereader-read\">\n\t\t<header v-if=\"!isMobile\" class=\"ereader-read__header\">\n\t\t\t<router-link :to=\"{ name: 'Library' }\" class=\"ereader-read__back\">{{ t('ereader', 'Back to library') }}</router-link>\n\t\t</header>\n\t\t<div class=\"ereader-read__area\">\n\t\t\t<div v-if=\"dictMessage\" class=\"ereader-read__toast\">{{ dictMessage }}</div>\n\t\t\t<div v-if=\"error\" class=\"ereader-read__error\">{{ error }}</div>\n\t\t\t<div v-else-if=\"!isEpub && loadingPdf\" class=\"ereader-read__loading\">{{ t('ereader', 'Loading…') }}</div>\n\t\t\t<EpubViewer v-else-if=\"isEpub\" :url=\"streamUrl\" @add-to-dictionary=\"onAddToDictionary\" />\n\t\t\t<PdfViewer v-else-if=\"pdfBlob\" :blob=\"pdfBlob\" @add-to-dictionary=\"onAddToDictionary\" />\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { getStreamUrl, getStreamBlob } from '../router/api'\nimport { translate as t } from '@nextcloud/l10n'\nimport EpubViewer from '../components/EpubViewer.vue'\nimport PdfViewer from '../components/PdfViewer.vue'\n\nconst MIME_EPUB = 'application/epub+zip'\nconst MOBILE_BREAKPOINT = 768\n\nexport default {\n\tname: 'Read',\n\tcomponents: { EpubViewer, PdfViewer },\n\tprops: {\n\t\tfileId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\terror: '',\n\t\t\tloadingPdf: false,\n\t\t\tpdfBlob: null,\n\t\t\twindowWidth: typeof window !== 'undefined' ? window.innerWidth : 1024,\n\t\t\tdictMessage: '',\n\t\t}\n\t},\n\tcomputed: {\n\t\tstreamUrl() {\n\t\t\treturn getStreamUrl(Number(this.fileId))\n\t\t},\n\t\tisEpub() {\n\t\t\treturn this.$route.query?.mime === MIME_EPUB\n\t\t},\n\t\tisMobile() {\n\t\t\treturn this.windowWidth <= MOBILE_BREAKPOINT\n\t\t},\n\t},\n\tasync mounted() {\n\t\twindow.addEventListener('resize', this.onResize)\n\t\tif (this.isEpub) return\n\t\tthis.loadingPdf = true\n\t\tthis.error = ''\n\t\ttry {\n\t\t\tthis.pdfBlob = await getStreamBlob(Number(this.fileId))\n\t\t} catch (e) {\n\t\t\tthis.error = e.response?.status === 403\n\t\t\t\t? t('ereader', 'Access denied. Please refresh the page and try again.')\n\t\t\t\t: (e.message || t('ereader', 'Failed to load the file.'))\n\t\t} finally {\n\t\t\tthis.loadingPdf = false\n\t\t}\n\t},\n\tbeforeUnmount() {\n\t\twindow.removeEventListener('resize', this.onResize)\n\t\tthis.pdfBlob = null\n\t},\n\tmethods: {\n\t\tt,\n\t\tonResize() {\n\t\t\tthis.windowWidth = window.innerWidth\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.ereader-read {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tmin-height: 0;\n\twidth: 100%;\n\tmax-width: 100vw;\n\tbox-sizing: border-box;\n\toverflow: hidden;\n}\n.ereader-read__header {\n\tflex-shrink: 0;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-action-bar);\n\tcolor: var(--ereader-primary-text);\n\tborder-bottom: 1px solid var(--ereader-border);\n}\n.ereader-read__back {\n\tcolor: inherit;\n\ttext-decoration: none;\n\tfont-weight: 500;\n}\n.ereader-read__back:hover {\n\ttext-decoration: underline;\n}\n.ereader-read__area {\n\tflex: 1;\n\tposition: relative;\n\tmin-height: 0;\n\twidth: 100%;\n\toverflow: hidden;\n}\n.ereader-read__error,\n.ereader-read__loading {\n\tposition: absolute;\n\tinset: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 2rem;\n\ttext-align: center;\n\tcolor: var(--ereader-text-secondary);\n}\n.ereader-read__error {\n\tcolor: var(--ereader-error);\n}\n.ereader-read__toast {\n\tposition: absolute;\n\ttop: 1rem;\n\tleft: 50%;\n\ttransform: translateX(-50%);\n\tz-index: 50;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--ereader-primary);\n\tcolor: var(--ereader-primary-text);\n\tborder-radius: var(--ereader-radius-sm);\n\tfont-size: 0.9rem;\n\tbox-shadow: var(--ereader-card-shadow);\n}\n</style>\n"],sourceRoot:""}]);const s=o}}]);
//# sourceMappingURL=ereader-src_views_Read_vue.js.map?v=9f31349b2ca86f99a0da